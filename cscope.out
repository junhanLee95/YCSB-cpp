cscope 15 $HOME/YCSB-cpp               0000180021
	@core/acknowledged_counter_generator.cc

8 
	~"acknowËdged_couÁ”_g’”©Ü.h
"

9 
	~"uts.h
"

11 
Çme¥aû
 
	gycsbc
 {

12 
	gAcknowËdgedCouÁ”G’”©Ü
::
AcknowËdge
(
ušt64_t
 
v®ue
) {

13 
¡d
::
lock_gu¬d
<¡d::
mu‹x
> 
lock
(
mu‹x_
);

14 
size_t
 
	gcur_¦Ù
 = 
v®ue
 & 
kWšdowMask
;

15 ià(
	gack_wšdow_
[
cur_¦Ù
]) {

16 
throw
 
	guts
::
Exû±iÚ
("Notƒnough window size");

18 
	gack_wšdow_
[
cur_¦Ù
] = 
Œue
;

19 
ušt64_t
 
	glim™
 = 
lim™_
.
lßd
();

20 
size_t
 
	guÁ
 = 
lim™
 + 
kWšdowSize
;

21 
size_t
 
	gi
;

22 
	gi
 = 
lim™
 + 1; i < 
	guÁ
; i++) {

23 
size_t
 
	g¦Ù
 = 
i
 & 
kWšdowMask
;

24 ià(!
	gack_wšdow_
[
¦Ù
]) {

27 
	gack_wšdow_
[
¦Ù
] = 
çl£
;

29 
	glim™_
.
¡Üe
(
i
 - 1);

	@core/acknowledged_counter_generator.h

8 #iâdeà
YCSB_C_ACKNOWLEDGED_COUNTER_GENERATOR_H_


9 
	#YCSB_C_ACKNOWLEDGED_COUNTER_GENERATOR_H_


	)

11 
	~"couÁ”_g’”©Ü.h
"

13 
	~<©omic
>

14 
	~<veùÜ
>

15 
	~<mu‹x
>

17 
Çme¥aû
 
	gycsbc
 {

19 şas 
	cAcknowËdgedCouÁ”G’”©Ü
 : 
public
 
CouÁ”G’”©Ü
 {

20 
public
:

21 
AcknowËdgedCouÁ”G’”©Ü
(
ušt64_t
 
¡¬t
)

22 : 
CouÁ”G’”©Ü
(
¡¬t
), 
lim™_
(¡¬ˆ- 1), 
ack_wšdow_
(
kWšdowSize
, 
çl£
) {}

23 
ušt64_t
 
La¡
(è{  
	glim™_
.
lßd
(); }

24 
AcknowËdge
(
ušt64_t
 
v®ue
);

25 
	g´iv©e
:

26 cÚ¡ 
size_t
 
kWšdowSize
 = (1 << 16);

27 cÚ¡ 
size_t
 
	gkWšdowMask
 = 
kWšdowSize
 - 1;

28 
	g¡d
::
©omic
<
ušt64_t
> 
lim™_
;

29 
	g¡d
::
veùÜ
<
boŞ
> 
ack_wšdow_
;

30 
	g¡d
::
mu‹x
 
mu‹x_
;

	@core/basic_db.cc

9 
	~"basic_db.h
"

10 
	~"cÜe/db_çùÜy.h
"

12 
usšg
 
	g¡d
::
cout
;

13 
usšg
 
	g¡d
::
’dl
;

15 
Çme¥aû
 
	gycsbc
 {

17 
	g¡d
::
mu‹x
 
BasicDB
:: 
mu‹x_
;

19 
	gBasicDB
::
In™
() {

20 
¡d
::
lock_gu¬d
<¡d::
mu‹x
> 
lock
(
mu‹x_
);

23 
	gDB
::
Stus
 
BasicDB
::
R—d
(cÚ¡ 
¡d
::
¡ršg
 &
bË
, cÚ¡ std::¡ršg &
key
,

24 cÚ¡ 
¡d
::
veùÜ
<¡d::
¡ršg
> *
f›lds
, std::veùÜ<
F›ld
> &
»suÉ
) {

25 
¡d
::
lock_gu¬d
<¡d::
mu‹x
> 
lock
(
mu‹x_
);

26 
	gcout
 << "READ " << 
	gbË
 << ' ' << 
	gkey
;

27 ià(
	gf›lds
) {

28 
	gcout
 << " [ ";

29 autØ
	gf
 : *
f›lds
) {

30 
cout
 << 
f
 << ' ';

32 
	gcout
 << ']' << 
	g’dl
;

34 
	gcout
 << " <‡Î f›ld >" << 
	g’dl
;

36  
	gkOK
;

39 
	gDB
::
Stus
 
BasicDB
::
Sÿn
(cÚ¡ 
¡d
::
¡ršg
 &
bË
, cÚ¡ std::¡ršg &
key
, 
Ën
,

40 cÚ¡ 
¡d
::
veùÜ
<¡d::
¡ršg
> *
f›lds
,

41 
¡d
::
veùÜ
<¡d::veùÜ<
F›ld
>> &
»suÉ
) {

42 
¡d
::
lock_gu¬d
<¡d::
mu‹x
> 
lock
(
mu‹x_
);

43 
	gcout
 << "SCAN " << 
	gbË
 << ' ' << 
	gkey
 << " " << 
	gËn
;

44 ià(
	gf›lds
) {

45 
	gcout
 << " [ ";

46 autØ
	gf
 : *
f›lds
) {

47 
cout
 << 
f
 << ' ';

49 
	gcout
 << ']' << 
	g’dl
;

51 
	gcout
 << " <‡Î f›ld >" << 
	g’dl
;

53  
	gkOK
;

56 
	gDB
::
Stus
 
BasicDB
::
Upd©e
(cÚ¡ 
¡d
::
¡ršg
 &
bË
, cÚ¡ std::¡ršg &
key
,

57 
¡d
::
veùÜ
<
F›ld
> &
v®ues
) {

58 
¡d
::
lock_gu¬d
<¡d::
mu‹x
> 
lock
(
mu‹x_
);

59 
	gcout
 << "UPDATE " << 
	gbË
 << ' ' << 
	gkey
 << " [ ";

60 autØ
	gv
 : 
v®ues
) {

61 
cout
 << 
v
.
Çme
 << '=' << v.
v®ue
 << ' ';

63 
	gcout
 << ']' << 
	g’dl
;

64  
	gkOK
;

67 
	gDB
::
Stus
 
BasicDB
::
In£¹
(cÚ¡ 
¡d
::
¡ršg
 &
bË
, cÚ¡ std::¡ršg &
key
,

68 
¡d
::
veùÜ
<
F›ld
> &
v®ues
) {

69 
¡d
::
lock_gu¬d
<¡d::
mu‹x
> 
lock
(
mu‹x_
);

70 
	gcout
 << "INSERT " << 
	gbË
 << ' ' << 
	gkey
 << " [ ";

71 autØ
	gv
 : 
v®ues
) {

72 
cout
 << 
v
.
Çme
 << '=' << v.
v®ue
 << ' ';

74 
	gcout
 << ']' << 
	g’dl
;

75  
	gkOK
;

78 
	gDB
::
Stus
 
BasicDB
::
D–‘e
(cÚ¡ 
¡d
::
¡ršg
 &
bË
, cÚ¡ std::¡ršg &
key
) {

79 
¡d
::
lock_gu¬d
<¡d::
mu‹x
> 
lock
(
mu‹x_
);

80 
	gcout
 << "DELETE " << 
	gbË
 << ' ' << 
	gkey
 << 
	g’dl
;

81  
	gkOK
;

84 
DB
 *
NewBasicDB
() {

85  
Ãw
 
	gBasicDB
;

88 cÚ¡ 
boŞ
 
	g»gi¡”ed
 = 
DBFaùÜy
::
Regi¡”DB
("basic", 
NewBasicDB
);

	@core/basic_db.h

9 #iâdeà
YCSB_C_BASIC_DB_H_


10 
	#YCSB_C_BASIC_DB_H_


	)

12 
	~"db.h
"

13 
	~"´İ”t›s.h
"

15 
	~<io¡»am
>

16 
	~<¡ršg
>

17 
	~<mu‹x
>

19 
Çme¥aû
 
	gycsbc
 {

21 şas 
	cBasicDB
 : 
public
 
DB
 {

22 
public
:

23 
In™
();

25 
Stus
 
R—d
(cÚ¡ 
¡d
::
¡ršg
 &
bË
, cÚ¡ std::¡ršg &
key
,

26 cÚ¡ 
¡d
::
veùÜ
<¡d::
¡ršg
> *
f›lds
, std::veùÜ<
F›ld
> &
»suÉ
);

28 
Stus
 
Sÿn
(cÚ¡ 
¡d
::
¡ršg
 &
bË
, cÚ¡ std::¡ršg &
key
, 
Ën
,

29 cÚ¡ 
¡d
::
veùÜ
<¡d::
¡ršg
> *
f›lds
, std::veùÜ<¡d::veùÜ<
F›ld
>> &
»suÉ
);

31 
Stus
 
Upd©e
(cÚ¡ 
¡d
::
¡ršg
 &
bË
, cÚ¡ std::¡ršg &
key
, std::
veùÜ
<
F›ld
> &
v®ues
);

33 
Stus
 
In£¹
(cÚ¡ 
¡d
::
¡ršg
 &
bË
, cÚ¡ std::¡ršg &
key
, std::
veùÜ
<
F›ld
> &
v®ues
);

35 
Stus
 
D–‘e
(cÚ¡ 
¡d
::
¡ršg
 &
bË
, cÚ¡ std::¡ršg &
key
);

37 
	g´iv©e
:

38 
¡d
::
mu‹x
 
mu‹x_
;

41 
DB
 *
NewBasicDB
();

	@core/client.h

9 #iâdeà
YCSB_C_CLIENT_H_


10 
	#YCSB_C_CLIENT_H_


	)

12 
	~<¡ršg
>

13 
	~<m­
>

14 
	~<f¡»am
>

15 
	~"db.h
"

16 
	~"cÜe_wÜklßd.h
"

17 
	~"uts.h
"

18 
	~"couÁdown_Ïtch.h
"

20 
Çme¥aû
 
	gycsbc
 {

22 
šlše
 
Cl›ÁTh»ad
(
ycsbc
::
DB
 *
db
, ycsbc::
CÜeWÜklßd
 *
wl
, cÚ¡ 
num_İs
, 
boŞ
 
is_lßdšg
,

23 
boŞ
 
š™_db
, boŞ 
´št_key_¡©
, boŞ 
ş—nup_db
, 
CouÁDownL©ch
 *
Ïtch
) {

24 ià(
	gš™_db
) {

25 
	gdb
->
In™
();

28 
	goks
 = 0;

29 
	g¡d
::
m­
<
ušt64_t
, 
	gušt64_t
> 
	gkey_¡©s
;

30 
	gi
 = 0; i < 
	gnum_İs
; ++i) {

31 ià(
	gis_lßdšg
) {

32 
	goks
 +ğ
wl
->
DoIn£¹
(*
db
, 
´št_key_¡©
, 
key_¡©s
);

34 
	goks
 +ğ
wl
->
DoT¿n§ùiÚ
(*
db
, 
´št_key_¡©
, 
key_¡©s
);

38 if(
	g´št_key_¡©
) {

40 
	g¡d
::
of¡»am
 
ofe
;

41 
	gofe
.
İ’
("/home/ceph/YCSB-cpp/print_key_stats.txt");

42 autØ
	gk
: 
key_¡©s
) {

43 
ofe
 << 
k
.
fœ¡
 << "\t" << k.
£cÚd
 << "\n";

46 
	gofe
.
şo£
();

49 ià(
	gş—nup_db
) {

50 
	gdb
->
CËªup
();

53 
	gÏtch
->
CouÁDown
();

54  
	goks
;

	@core/const_generator.h

9 #iâdeà
YCSB_C_CONST_GENERATOR_H_


10 
	#YCSB_C_CONST_GENERATOR_H_


	)

12 
	~"g’”©Ü.h
"

13 
	~<c¡dšt
>

15 
Çme¥aû
 
	gycsbc
 {

17 
şass
 
	gCÚ¡G’”©Ü
 : 
public
 
G’”©Ü
<
ušt64_t
> {

18 
public
:

19 
CÚ¡G’”©Ü
(
cÚ¡ªt
è: 
cÚ¡ªt_
(constant) { }

20 
ušt64_t
 
Next
(è{  
cÚ¡ªt_
; }

21 
ušt64_t
 
La¡
(è{  
	gcÚ¡ªt_
; }

22 
	g´iv©e
:

23 
ušt64_t
 
cÚ¡ªt_
;

	@core/core_workload.cc

9 
	~"uts.h
"

10 
	~"unifÜm_g’”©Ü.h
"

11 
	~"zfŸn_g’”©Ü.h
"

12 
	~"zfŸn_comp_g’”©Ü.h
"

13 
	~"süambËd_zfŸn_g’”©Ü.h
"

14 
	~"skewed_Ï‹¡_g’”©Ü.h
"

15 
	~"cÚ¡_g’”©Ü.h
"

16 
	~"cÜe_wÜklßd.h
"

17 
	~"¿ndom_by‹_g’”©Ü.h
"

19 
	~<®gÜ™hm
>

20 
	~<¿ndom
>

21 
	~<¡ršg
>

22 
	~<io¡»am
>

23 
	~<¿ndom
>

24 
	~<ùime
>

26 
usšg
 
	gycsbc
::
CÜeWÜklßd
;

27 
usšg
 
	g¡d
::
¡ršg
;

29 cÚ¡ *
	gycsbc
::
kO³¿tiÚSŒšg
[
ycsbc
::
MAXOPTYPE
] = {

38 cÚ¡ 
¡ršg
 
	gCÜeWÜklßd
::
TABLENAME_PROPERTY
 = "table";

39 cÚ¡ 
¡ršg
 
	gCÜeWÜklßd
::
TABLENAME_DEFAULT
 = "usertable";

41 cÚ¡ 
¡ršg
 
	gCÜeWÜklßd
::
FIELD_COUNT_PROPERTY
 = "fieldcount";

42 cÚ¡ 
¡ršg
 
	gCÜeWÜklßd
::
FIELD_COUNT_DEFAULT
 = "10";

44 cÚ¡ 
¡ršg
 
	gCÜeWÜklßd
::
FIELD_LENGTH_DISTRIBUTION_PROPERTY
 = "field_len_dist";

45 cÚ¡ 
¡ršg
 
	gCÜeWÜklßd
::
FIELD_LENGTH_DISTRIBUTION_DEFAULT
 = "constant";

47 cÚ¡ 
¡ršg
 
	gCÜeWÜklßd
::
FIELD_LENGTH_PROPERTY
 = "fieldlength";

48 cÚ¡ 
¡ršg
 
	gCÜeWÜklßd
::
FIELD_LENGTH_DEFAULT
 = "100";

50 cÚ¡ 
¡ršg
 
	gCÜeWÜklßd
::
READ_ALL_FIELDS_PROPERTY
 = "readallfields";

51 cÚ¡ 
¡ršg
 
	gCÜeWÜklßd
::
READ_ALL_FIELDS_DEFAULT
 = "true";

53 cÚ¡ 
¡ršg
 
	gCÜeWÜklßd
::
WRITE_ALL_FIELDS_PROPERTY
 = "writeallfields";

54 cÚ¡ 
¡ršg
 
	gCÜeWÜklßd
::
WRITE_ALL_FIELDS_DEFAULT
 = "false";

56 cÚ¡ 
¡ršg
 
	gCÜeWÜklßd
::
READ_PROPORTION_PROPERTY
 = "readproportion";

57 cÚ¡ 
¡ršg
 
	gCÜeWÜklßd
::
READ_PROPORTION_DEFAULT
 = "0.95";

59 cÚ¡ 
¡ršg
 
	gCÜeWÜklßd
::
UPDATE_PROPORTION_PROPERTY
 = "updateproportion";

60 cÚ¡ 
¡ršg
 
	gCÜeWÜklßd
::
UPDATE_PROPORTION_DEFAULT
 = "0.05";

62 cÚ¡ 
¡ršg
 
	gCÜeWÜklßd
::
INSERT_PROPORTION_PROPERTY
 = "insertproportion";

63 cÚ¡ 
¡ršg
 
	gCÜeWÜklßd
::
INSERT_PROPORTION_DEFAULT
 = "0.0";

65 cÚ¡ 
¡ršg
 
	gCÜeWÜklßd
::
SCAN_PROPORTION_PROPERTY
 = "scanproportion";

66 cÚ¡ 
¡ršg
 
	gCÜeWÜklßd
::
SCAN_PROPORTION_DEFAULT
 = "0.0";

68 cÚ¡ 
¡ršg
 
	gCÜeWÜklßd
::
READMODIFYWRITE_PROPORTION_PROPERTY
 = "readmodifywriteproportion";

69 cÚ¡ 
¡ršg
 
	gCÜeWÜklßd
::
READMODIFYWRITE_PROPORTION_DEFAULT
 = "0.0";

71 cÚ¡ 
¡ršg
 
	gCÜeWÜklßd
::
REQUEST_DISTRIBUTION_PROPERTY
 = "requestdistribution";

72 cÚ¡ 
¡ršg
 
	gCÜeWÜklßd
::
REQUEST_DISTRIBUTION_DEFAULT
 = "uniform";

74 cÚ¡ 
¡ršg
 
	gCÜeWÜklßd
::
ZERO_PADDING_PROPERTY
 = "zeropadding";

75 cÚ¡ 
¡ršg
 
	gCÜeWÜklßd
::
ZERO_PADDING_DEFAULT
 = "1";

77 cÚ¡ 
¡ršg
 
	gCÜeWÜklßd
::
PREFIX_PADDING_PROPERTY
 = "prefixpadding";

78 cÚ¡ 
¡ršg
 
	gCÜeWÜklßd
::
PREFIX_PADDING_DEFAULT
 = "0";

80 cÚ¡ 
¡ršg
 
	gCÜeWÜklßd
::
MIN_SCAN_LENGTH_PROPERTY
 = "minscanlength";

81 cÚ¡ 
¡ršg
 
	gCÜeWÜklßd
::
MIN_SCAN_LENGTH_DEFAULT
 = "1";

83 cÚ¡ 
¡ršg
 
	gCÜeWÜklßd
::
MAX_SCAN_LENGTH_PROPERTY
 = "maxscanlength";

84 cÚ¡ 
¡ršg
 
	gCÜeWÜklßd
::
MAX_SCAN_LENGTH_DEFAULT
 = "1000";

86 cÚ¡ 
¡ršg
 
	gCÜeWÜklßd
::
SCAN_LENGTH_DISTRIBUTION_PROPERTY
 = "scanlengthdistribution";

87 cÚ¡ 
¡ršg
 
	gCÜeWÜklßd
::
SCAN_LENGTH_DISTRIBUTION_DEFAULT
 = "uniform";

89 cÚ¡ 
¡ršg
 
	gCÜeWÜklßd
::
INSERT_ORDER_PROPERTY
 = "insertorder";

90 cÚ¡ 
¡ršg
 
	gCÜeWÜklßd
::
INSERT_ORDER_DEFAULT
 = "hashed";

92 cÚ¡ 
¡ršg
 
	gCÜeWÜklßd
::
INSERT_START_PROPERTY
 = "insertstart";

93 cÚ¡ 
¡ršg
 
	gCÜeWÜklßd
::
INSERT_START_DEFAULT
 = "0";

95 cÚ¡ 
¡ršg
 
	gCÜeWÜklßd
::
RECORD_COUNT_PROPERTY
 = "recordcount";

96 cÚ¡ 
¡ršg
 
	gCÜeWÜklßd
::
OPERATION_COUNT_PROPERTY
 = "operationcount";

98 cÚ¡ 
	g¡d
::
¡ršg
 
CÜeWÜklßd
::
FIELD_NAME_PREFIX
 = "fieldnameprefix";

99 cÚ¡ 
	g¡d
::
¡ršg
 
CÜeWÜklßd
::
FIELD_NAME_PREFIX_DEFAULT
 = "field";

101 
	gCÜeWÜklßd
::
	$In™
(cÚ¡ 
uts
::
Prİ”t›s
 &
p
) {

102 
bË_Çme_
 = 
p
.
	`G‘Prİ”ty
(
TABLENAME_PROPERTY
,
TABLENAME_DEFAULT
);

104 
f›ld_couÁ_
 = 
¡d
::
	`¡oi
(
p
.
	`G‘Prİ”ty
(
FIELD_COUNT_PROPERTY
, 
FIELD_COUNT_DEFAULT
));

105 
f›ld_´efix_
 = 
p
.
	`G‘Prİ”ty
(
FIELD_NAME_PREFIX
, 
FIELD_NAME_PREFIX_DEFAULT
);

106 
f›ld_Ën_g’”©Ü_
 = 
	`G‘F›ldL’G’”©Ü
(
p
);

108 
»ad_´İÜtiÚ
 = 
¡d
::
	`¡od
(
p
.
	`G‘Prİ”ty
(
READ_PROPORTION_PROPERTY
,

109 
READ_PROPORTION_DEFAULT
));

110 
upd©e_´İÜtiÚ
 = 
¡d
::
	`¡od
(
p
.
	`G‘Prİ”ty
(
UPDATE_PROPORTION_PROPERTY
,

111 
UPDATE_PROPORTION_DEFAULT
));

112 
š£¹_´İÜtiÚ
 = 
¡d
::
	`¡od
(
p
.
	`G‘Prİ”ty
(
INSERT_PROPORTION_PROPERTY
,

113 
INSERT_PROPORTION_DEFAULT
));

114 
sÿn_´İÜtiÚ
 = 
¡d
::
	`¡od
(
p
.
	`G‘Prİ”ty
(
SCAN_PROPORTION_PROPERTY
,

115 
SCAN_PROPORTION_DEFAULT
));

116 
»admodifywr™e_´İÜtiÚ
 = 
¡d
::
	`¡od
(
p
.
	`G‘Prİ”ty
(

117 
READMODIFYWRITE_PROPORTION_PROPERTY
, 
READMODIFYWRITE_PROPORTION_DEFAULT
));

119 
»cÜd_couÁ_
 = 
¡d
::
	`¡oi
(
p
.
	`G‘Prİ”ty
(
RECORD_COUNT_PROPERTY
));

120 
¡d
::
¡ršg
 
»que¡_di¡
 = 
p
.
	`G‘Prİ”ty
(
REQUEST_DISTRIBUTION_PROPERTY
,

121 
REQUEST_DISTRIBUTION_DEFAULT
);

122 
mš_sÿn_Ën
 = 
¡d
::
	`¡oi
(
p
.
	`G‘Prİ”ty
(
MIN_SCAN_LENGTH_PROPERTY
, 
MIN_SCAN_LENGTH_DEFAULT
));

123 
max_sÿn_Ën
 = 
¡d
::
	`¡oi
(
p
.
	`G‘Prİ”ty
(
MAX_SCAN_LENGTH_PROPERTY
, 
MAX_SCAN_LENGTH_DEFAULT
));

124 
¡d
::
¡ršg
 
sÿn_Ën_di¡
 = 
p
.
	`G‘Prİ”ty
(
SCAN_LENGTH_DISTRIBUTION_PROPERTY
,

125 
SCAN_LENGTH_DISTRIBUTION_DEFAULT
);

126 
š£¹_¡¬t
 = 
¡d
::
	`¡oi
(
p
.
	`G‘Prİ”ty
(
INSERT_START_PROPERTY
, 
INSERT_START_DEFAULT
));

128 
z”o_·ddšg_
 = 
¡d
::
	`¡oi
(
p
.
	`G‘Prİ”ty
(
ZERO_PADDING_PROPERTY
, 
ZERO_PADDING_DEFAULT
));

130 
´efix_·ddšg_
 = 
¡d
::
	`¡oi
(
p
.
	`G‘Prİ”ty
(
PREFIX_PADDING_PROPERTY
, 
PREFIX_PADDING_DEFAULT
));

133 
»ad_®l_f›lds_
 = 
uts
::
	`SŒToBoŞ
(
p
.
	`G‘Prİ”ty
(
READ_ALL_FIELDS_PROPERTY
,

134 
READ_ALL_FIELDS_DEFAULT
));

135 
wr™e_®l_f›lds_
 = 
uts
::
	`SŒToBoŞ
(
p
.
	`G‘Prİ”ty
(
WRITE_ALL_FIELDS_PROPERTY
,

136 
WRITE_ALL_FIELDS_DEFAULT
));

138 ià(
p
.
	`G‘Prİ”ty
(
INSERT_ORDER_PROPERTY
, 
INSERT_ORDER_DEFAULT
) == "hashed") {

139 
Üd”ed_š£¹s_
 = 
çl£
;

141 
Üd”ed_š£¹s_
 = 
Œue
;

145 ià(
»ad_´İÜtiÚ
 > 0) {

146 
İ_choo£r_
.
	`AddV®ue
(
READ
, 
»ad_´İÜtiÚ
);

148 ià(
upd©e_´İÜtiÚ
 > 0) {

149 
İ_choo£r_
.
	`AddV®ue
(
UPDATE
, 
upd©e_´İÜtiÚ
);

151 ià(
š£¹_´İÜtiÚ
 > 0) {

152 
İ_choo£r_
.
	`AddV®ue
(
INSERT
, 
š£¹_´İÜtiÚ
);

154 ià(
sÿn_´İÜtiÚ
 > 0) {

155 
İ_choo£r_
.
	`AddV®ue
(
SCAN
, 
sÿn_´İÜtiÚ
);

157 ià(
»admodifywr™e_´İÜtiÚ
 > 0) {

158 
İ_choo£r_
.
	`AddV®ue
(
READMODIFYWRITE
, 
»admodifywr™e_´İÜtiÚ
);

161 
š£¹_key_£qu’û_
 = 
Ãw
 
	`CouÁ”G’”©Ü
(
š£¹_¡¬t
);

162 
Œª§ùiÚ_š£¹_key_£qu’û_
 = 
Ãw
 
	`AcknowËdgedCouÁ”G’”©Ü
(
»cÜd_couÁ_
);

164 ià(
»que¡_di¡
 == "uniform") {

165 
key_choo£r_
 = 
Ãw
 
	`UnifÜmG’”©Ü
(0, 
»cÜd_couÁ_
 - 1);

167 } ià(
»que¡_di¡
 == "zipfian") {

173 
İ_couÁ
 = 
¡d
::
	`¡oi
(
p
.
	`G‘Prİ”ty
(
OPERATION_COUNT_PROPERTY
));

174 
Ãw_keys
 = ()(
İ_couÁ
 * 
š£¹_´İÜtiÚ
 * 2);

175 
key_choo£r_
 = 
Ãw
 
	`SüambËdZfŸnG’”©Ü
(
»cÜd_couÁ_
 + 
Ãw_keys
);

176 } ià(
»que¡_di¡
 == "zipfiancomp") {

179 
İ_couÁ
 = 
¡d
::
	`¡oi
(
p
.
	`G‘Prİ”ty
(
OPERATION_COUNT_PROPERTY
));

180 
Ãw_keys
 = ()(
İ_couÁ
 * 
š£¹_´İÜtiÚ
 * 2);

181 
key_choo£r_
 = 
Ãw
 
	`ZfŸnCompG’”©Ü
(
»cÜd_couÁ_
 + 
Ãw_keys
);

182 } ià(
»que¡_di¡
 == "latest") {

183 
key_choo£r_
 = 
Ãw
 
	`SkewedL©e¡G’”©Ü
(*
Œª§ùiÚ_š£¹_key_£qu’û_
);

185 
throw
 
uts
::
	`Exû±iÚ
("UnknowÀ»que¡ di¡ributiÚ: " + 
»que¡_di¡
);

188 
f›ld_choo£r_
 = 
Ãw
 
	`UnifÜmG’”©Ü
(0, 
f›ld_couÁ_
 - 1);

190 ià(
sÿn_Ën_di¡
 == "uniform") {

191 
sÿn_Ën_choo£r_
 = 
Ãw
 
	`UnifÜmG’”©Ü
(
mš_sÿn_Ën
, 
max_sÿn_Ën
);

192 } ià(
sÿn_Ën_di¡
 == "zipfian") {

193 
sÿn_Ën_choo£r_
 = 
Ãw
 
	`ZfŸnG’”©Ü
(
mš_sÿn_Ën
, 
max_sÿn_Ën
);

195 
throw
 
uts
::
	`Exû±iÚ
("Di¡ributiÚ‚Ù‡Îowed fÜ sÿÀËngth: " + 
sÿn_Ën_di¡
);

197 
	}
}

199 
	gycsbc
::
G’”©Ü
<
ušt64_t
> *
CÜeWÜklßd
::
	$G‘F›ldL’G’”©Ü
(

200 cÚ¡ 
uts
::
Prİ”t›s
 &
p
) {

201 
¡ršg
 
f›ld_Ën_di¡
 = 
p
.
	`G‘Prİ”ty
(
FIELD_LENGTH_DISTRIBUTION_PROPERTY
,

202 
FIELD_LENGTH_DISTRIBUTION_DEFAULT
);

203 
f›ld_Ën
 = 
¡d
::
	`¡oi
(
p
.
	`G‘Prİ”ty
(
FIELD_LENGTH_PROPERTY
, 
FIELD_LENGTH_DEFAULT
));

204 if(
f›ld_Ën_di¡
 == "constant") {

205  
Ãw
 
	`CÚ¡G’”©Ü
(
f›ld_Ën
);

206 } if(
f›ld_Ën_di¡
 == "uniform") {

207  
Ãw
 
	`UnifÜmG’”©Ü
(1, 
f›ld_Ën
);

208 } if(
f›ld_Ën_di¡
 == "zipfian") {

209  
Ãw
 
	`ZfŸnG’”©Ü
(1, 
f›ld_Ën
);

211 
throw
 
uts
::
	`Exû±iÚ
("UnknowÀf›ld†’gth di¡ributiÚ: " + 
f›ld_Ën_di¡
);

213 
	}
}

215 
	g¡d
::
¡ršg
 
CÜeWÜklßd
::
	$BudKeyName
(
ušt64_t
 
key_num
) {

216 ià(!
Üd”ed_š£¹s_
) {

217 
key_num
 = 
uts
::
	`Hash
(key_num);

219 
¡d
::
¡ršg
 
´ekey
 = "user";

220 
¡d
::
¡ršg
 
v®ue
 = std::
	`to_¡ršg
(
key_num
);

221 
fl
 = 
¡d
::
	`max
(0, 
z”o_·ddšg_
 - 
¡©ic_ÿ¡
<>(
v®ue
.
	`size
()));

223 if(
´efix_·ddšg_
 > 0){

224 
¡d
::
¡ršg
 
´ekey2
;

225 
diû
 = 
	`mt_
() % 1000;

226 ià(0 <ğ
diû
 && dice < 500) {

227 
´ekey2
 = "00";

229 ià(500 <ğ
diû
 && dice < 750) {

230 
´ekey2
 = "01";

232 ià(750 <ğ
diû
 && dice < 875) {

233 
´ekey2
 = "10";

236 
´ekey2
 = "11";

238  
´ekey
.
	`­³nd
(
´ekey2
).­³nd(
fl
, '0').­³nd(
v®ue
);

240  
´ekey
.
	`­³nd
(
fl
, '0').­³nd(
v®ue
);

241 
	}
}

243 
	gCÜeWÜklßd
::
BudV®ues
(
¡d
::
veùÜ
<
ycsbc
::
DB
::
F›ld
> &
v®ues
) {

244 
i
 = 0; 
	gi
 < 
	gf›ld_couÁ_
; ++i) {

245 
	gv®ues
.
push_back
(
DB
::
F›ld
());

246 
	gycsbc
::
DB
::
F›ld
 &
f›ld
 = 
v®ues
.
back
();

247 
	gf›ld
.
	gÇme
.
­³nd
(
f›ld_´efix_
).­³nd(
¡d
::
to_¡ršg
(
i
));

248 
ušt64_t
 
	gËn
 = 
f›ld_Ën_g’”©Ü_
->
Next
();

249 
	gf›ld
.
	gv®ue
.
»£rve
(
Ën
);

250 
RªdomBy‹G’”©Ü
 
	gby‹_g’”©Ü
;

251 
	g¡d
::
g’”©e_n
(
¡d
::
back_š£¹”
(
f›ld
.
v®ue
), 
Ën
, [&](è{  
by‹_g’”©Ü
.
Next
(); } );

255 
	gCÜeWÜklßd
::
BudSšgËV®ue
(
¡d
::
veùÜ
<
ycsbc
::
DB
::
F›ld
> &
v®ues
) {

256 
v®ues
.
push_back
(
DB
::
F›ld
());

257 
	gycsbc
::
DB
::
F›ld
 &
f›ld
 = 
v®ues
.
back
();

258 
	gf›ld
.
	gÇme
.
­³nd
(
NextF›ldName
());

259 
ušt64_t
 
	gËn
 = 
f›ld_Ën_g’”©Ü_
->
Next
();

260 
	gf›ld
.
	gv®ue
.
»£rve
(
Ën
);

261 
RªdomBy‹G’”©Ü
 
	gby‹_g’”©Ü
;

262 
	g¡d
::
g’”©e_n
(
¡d
::
back_š£¹”
(
f›ld
.
v®ue
), 
Ën
, [&](è{  
by‹_g’”©Ü
.
Next
(); } );

	@core/core_workload.h

9 #iâdeà
YCSB_C_CORE_WORKLOAD_H_


10 
	#YCSB_C_CORE_WORKLOAD_H_


	)

12 
	~<veùÜ
>

13 
	~<¡ršg
>

14 
	~<m­
>

15 
	~"db.h
"

16 
	~"´İ”t›s.h
"

17 
	~"g’”©Ü.h
"

18 
	~"disü‘e_g’”©Ü.h
"

19 
	~"couÁ”_g’”©Ü.h
"

20 
	~"acknowËdged_couÁ”_g’”©Ü.h
"

21 
	~"uts.h
"

22 
	~<io¡»am
>

23 
Çme¥aû
 
	gycsbc
 {

25 
	eO³¿tiÚ
 {

26 
	gINSERT
,

27 
	gREAD
,

28 
	gUPDATE
,

29 
	gSCAN
,

30 
	gREADMODIFYWRITE
,

31 
	gDELETE
,

32 
	gMAXOPTYPE


35 cÚ¡ *
kO³¿tiÚSŒšg
[
MAXOPTYPE
];

37 şas 
	cCÜeWÜklßd
 {

38 
	gpublic
:

42 cÚ¡ 
¡d
::
¡ršg
 
TABLENAME_PROPERTY
;

43 cÚ¡ 
	g¡d
::
¡ršg
 
TABLENAME_DEFAULT
;

48 cÚ¡ 
	g¡d
::
¡ršg
 
FIELD_COUNT_PROPERTY
;

49 cÚ¡ 
	g¡d
::
¡ršg
 
FIELD_COUNT_DEFAULT
;

55 cÚ¡ 
	g¡d
::
¡ršg
 
FIELD_LENGTH_DISTRIBUTION_PROPERTY
;

56 cÚ¡ 
	g¡d
::
¡ršg
 
FIELD_LENGTH_DISTRIBUTION_DEFAULT
;

61 cÚ¡ 
	g¡d
::
¡ršg
 
FIELD_LENGTH_PROPERTY
;

62 cÚ¡ 
	g¡d
::
¡ršg
 
FIELD_LENGTH_DEFAULT
;

68 cÚ¡ 
	g¡d
::
¡ršg
 
READ_ALL_FIELDS_PROPERTY
;

69 cÚ¡ 
	g¡d
::
¡ršg
 
READ_ALL_FIELDS_DEFAULT
;

75 cÚ¡ 
	g¡d
::
¡ršg
 
WRITE_ALL_FIELDS_PROPERTY
;

76 cÚ¡ 
	g¡d
::
¡ršg
 
WRITE_ALL_FIELDS_DEFAULT
;

81 cÚ¡ 
	g¡d
::
¡ršg
 
READ_PROPORTION_PROPERTY
;

82 cÚ¡ 
	g¡d
::
¡ršg
 
READ_PROPORTION_DEFAULT
;

87 cÚ¡ 
	g¡d
::
¡ršg
 
UPDATE_PROPORTION_PROPERTY
;

88 cÚ¡ 
	g¡d
::
¡ršg
 
UPDATE_PROPORTION_DEFAULT
;

93 cÚ¡ 
	g¡d
::
¡ršg
 
INSERT_PROPORTION_PROPERTY
;

94 cÚ¡ 
	g¡d
::
¡ršg
 
INSERT_PROPORTION_DEFAULT
;

99 cÚ¡ 
	g¡d
::
¡ršg
 
SCAN_PROPORTION_PROPERTY
;

100 cÚ¡ 
	g¡d
::
¡ršg
 
SCAN_PROPORTION_DEFAULT
;

106 cÚ¡ 
	g¡d
::
¡ršg
 
READMODIFYWRITE_PROPORTION_PROPERTY
;

107 cÚ¡ 
	g¡d
::
¡ršg
 
READMODIFYWRITE_PROPORTION_DEFAULT
;

113 cÚ¡ 
	g¡d
::
¡ršg
 
REQUEST_DISTRIBUTION_PROPERTY
;

114 cÚ¡ 
	g¡d
::
¡ršg
 
REQUEST_DISTRIBUTION_DEFAULT
;

119 cÚ¡ 
	g¡d
::
¡ršg
 
ZERO_PADDING_PROPERTY
;

120 cÚ¡ 
	g¡d
::
¡ršg
 
ZERO_PADDING_DEFAULT
;

125 cÚ¡ 
	g¡d
::
¡ršg
 
PREFIX_PADDING_PROPERTY
;

126 cÚ¡ 
	g¡d
::
¡ršg
 
PREFIX_PADDING_DEFAULT
;

131 cÚ¡ 
	g¡d
::
¡ršg
 
MIN_SCAN_LENGTH_PROPERTY
;

132 cÚ¡ 
	g¡d
::
¡ršg
 
MIN_SCAN_LENGTH_DEFAULT
;

137 cÚ¡ 
	g¡d
::
¡ršg
 
MAX_SCAN_LENGTH_PROPERTY
;

138 cÚ¡ 
	g¡d
::
¡ršg
 
MAX_SCAN_LENGTH_DEFAULT
;

144 cÚ¡ 
	g¡d
::
¡ršg
 
SCAN_LENGTH_DISTRIBUTION_PROPERTY
;

145 cÚ¡ 
	g¡d
::
¡ršg
 
SCAN_LENGTH_DISTRIBUTION_DEFAULT
;

151 cÚ¡ 
	g¡d
::
¡ršg
 
INSERT_ORDER_PROPERTY
;

152 cÚ¡ 
	g¡d
::
¡ršg
 
INSERT_ORDER_DEFAULT
;

154 cÚ¡ 
	g¡d
::
¡ršg
 
INSERT_START_PROPERTY
;

155 cÚ¡ 
	g¡d
::
¡ršg
 
INSERT_START_DEFAULT
;

157 cÚ¡ 
	g¡d
::
¡ršg
 
RECORD_COUNT_PROPERTY
;

158 cÚ¡ 
	g¡d
::
¡ršg
 
OPERATION_COUNT_PROPERTY
;

163 cÚ¡ 
	g¡d
::
¡ršg
 
FIELD_NAME_PREFIX
;

164 cÚ¡ 
	g¡d
::
¡ršg
 
FIELD_NAME_PREFIX_DEFAULT
;

170 
vœtu®
 
In™
(cÚ¡ 
uts
::
Prİ”t›s
 &
p
);

172 
vœtu®
 
boŞ
 
DoIn£¹
(
DB
 &
db
, boŞ 
´št_key_¡©
, 
¡d
::
m­
<
ušt64_t
, ušt64_t>& 
key_¡©s
);

173 
vœtu®
 
boŞ
 
DoT¿n§ùiÚ
(
DB
 &
db
, boŞ 
´št_key_¡©
, 
¡d
::
m­
<
ušt64_t
, ušt64_t>& 
key_¡©s
);

175 
boŞ
 
»ad_®l_f›lds
(ècÚ¡ {  
	g»ad_®l_f›lds_
; }

176 
boŞ
 
wr™e_®l_f›lds
(ècÚ¡ {  
	gwr™e_®l_f›lds_
; }

178 
CÜeWÜklßd
() :

179 
f›ld_couÁ_
(0), 
»ad_®l_f›lds_
(
çl£
), 
wr™e_®l_f›lds_
(false),

180 
f›ld_Ën_g’”©Ü_
(
nuÎ±r
), 
key_choo£r_
ÒuÎ±r), 
f›ld_choo£r_
(nullptr),

181 
sÿn_Ën_choo£r_
(
nuÎ±r
), 
š£¹_key_£qu’û_
(nullptr),

182 
Œª§ùiÚ_š£¹_key_£qu’û_
(
nuÎ±r
), 
Üd”ed_š£¹s_
(
Œue
), 
»cÜd_couÁ_
(0) {

185 
	gvœtu®
 ~
CÜeWÜklßd
() {

186 
d–‘e
 
	gf›ld_Ën_g’”©Ü_
;

187 
d–‘e
 
	gkey_choo£r_
;

188 
d–‘e
 
	gf›ld_choo£r_
;

189 
d–‘e
 
	gsÿn_Ën_choo£r_
;

190 
d–‘e
 
	gš£¹_key_£qu’û_
;

191 
d–‘e
 
	gŒª§ùiÚ_š£¹_key_£qu’û_
;

194 
	g´Ùeùed
:

195 
G’”©Ü
<
ušt64_t
> *
G‘F›ldL’G’”©Ü
(cÚ¡ 
uts
::
Prİ”t›s
 &
p
);

196 
	g¡d
::
¡ršg
 
BudKeyName
(
ušt64_t
 
key_num
);

197 
BudV®ues
(
¡d
::
veùÜ
<
DB
::
F›ld
> &
v®ues
);

198 
BudSšgËV®ue
(
¡d
::
veùÜ
<
DB
::
F›ld
> &
upd©e
);

200 
ušt64_t
 
NextT¿n§ùiÚKeyNum
();

201 
	g¡d
::
¡ršg
 
NextF›ldName
();

203 
T¿n§ùiÚR—d
(
DB
 &
db
, 
boŞ
 
´št_key_¡©
, 
¡d
::
m­
<
ušt64_t
, ušt64_t>& 
key_¡©s
);

204 
T¿n§ùiÚR—dModifyWr™e
(
DB
 &
db
, 
boŞ
 
´št_key_¡©
, 
¡d
::
m­
<
ušt64_t
, ušt64_t>& 
key_¡©s
);

205 
T¿n§ùiÚSÿn
(
DB
 &
db
, 
boŞ
 
´št_key_¡©
, 
¡d
::
m­
<
ušt64_t
, ušt64_t>& 
key_¡©s
);

206 
T¿n§ùiÚUpd©e
(
DB
 &
db
, 
boŞ
 
´št_key_¡©
, 
¡d
::
m­
<
ušt64_t
, ušt64_t>& 
key_¡©s
);

207 
T¿n§ùiÚIn£¹
(
DB
 &
db
, 
boŞ
 
´št_key_¡©
, 
¡d
::
m­
<
ušt64_t
, ušt64_t>& 
key_¡©s
);

209 
	g¡d
::
¡ršg
 
bË_Çme_
;

210 
	gf›ld_couÁ_
;

211 
	g¡d
::
¡ršg
 
f›ld_´efix_
;

212 
boŞ
 
	g»ad_®l_f›lds_
;

213 
boŞ
 
	gwr™e_®l_f›lds_
;

214 
	gG’”©Ü
<
	gušt64_t
> *
	gf›ld_Ën_g’”©Ü_
;

215 
	gDisü‘eG’”©Ü
<
	gO³¿tiÚ
> 
	gİ_choo£r_
;

216 
	gG’”©Ü
<
	gušt64_t
> *
	gkey_choo£r_
;

217 
	gG’”©Ü
<
	gušt64_t
> *
	gf›ld_choo£r_
;

218 
	gG’”©Ü
<
	gušt64_t
> *
	gsÿn_Ën_choo£r_
;

219 
CouÁ”G’”©Ü
 *
	gš£¹_key_£qu’û_
;

220 
AcknowËdgedCouÁ”G’”©Ü
 *
	gŒª§ùiÚ_š£¹_key_£qu’û_
;

221 
boŞ
 
	gÜd”ed_š£¹s_
;

222 
size_t
 
	g»cÜd_couÁ_
;

223 
	gz”o_·ddšg_
;

224 
	g´efix_·ddšg_
;

225 
	g¡d
::
m­
<
ušt64_t
, 
	gušt64_t
> 
	gkey_¡©_m­_
;

226 
	g¡d
::
mt19937
 
mt_
;

229 
šlše
 
ušt64_t
 
	gCÜeWÜklßd
::
	$NextT¿n§ùiÚKeyNum
() {

230 
ušt64_t
 
key_num
;

232 
key_num
 = 
key_choo£r_
->
	`Next
();

233 } 
key_num
 > 
Œª§ùiÚ_š£¹_key_£qu’û_
->
	`La¡
());

234  
key_num
;

235 
	}
}

237 
šlše
 
	g¡d
::
¡ršg
 
CÜeWÜklßd
::
	$NextF›ldName
() {

238  
¡d
::
	`¡ršg
(
f›ld_´efix_
).
	`­³nd
(¡d::
	`to_¡ršg
(
f›ld_choo£r_
->
	`Next
()));

239 
	}
}

241 
šlše
 
boŞ
 
	gCÜeWÜklßd
::
DoIn£¹
(
DB
 &
db
, boŞ 
´št_key_¡©
, 
¡d
::
m­
<
ušt64_t
, ušt64_t>& 
key_¡©s
) {

242 
ušt64_t
 
	gÃxt_£qu’û
 = 
š£¹_key_£qu’û_
->
Next
();

243 cÚ¡ 
	g¡d
::
¡ršg
 
key
 = 
BudKeyName
(
Ãxt_£qu’û
);

244 
	g¡d
::
veùÜ
<
DB
::
F›ld
> 
f›lds
;

245 
BudV®ues
(
f›lds
);

247 if(
	g´št_key_¡©
) {

248 
	gkey_¡©s
[
Ãxt_£qu’û
]++;

252  
	gdb
.
In£¹
(
bË_Çme_
, 
key
, 
f›lds
è=ğ
DB
::
kOK
;

255 
šlše
 
boŞ
 
	gCÜeWÜklßd
::
DoT¿n§ùiÚ
(
DB
 &
db
, boŞ 
´št_key_¡©
, 
¡d
::
m­
<
ušt64_t
, ušt64_t>& 
key_¡©s
) {

256 
	g¡©us
 = -1;

257 
	gİ_choo£r_
.
Next
()) {

258 
	gREAD
:

259 
¡©us
 = 
T¿n§ùiÚR—d
(
db
, 
´št_key_¡©
, 
key_¡©s
);

261 
	gUPDATE
:

262 
¡©us
 = 
T¿n§ùiÚUpd©e
(
db
, 
´št_key_¡©
, 
key_¡©s
);

264 
	gINSERT
:

265 
¡©us
 = 
T¿n§ùiÚIn£¹
(
db
, 
´št_key_¡©
, 
key_¡©s
);

267 
	gSCAN
:

268 
¡©us
 = 
T¿n§ùiÚSÿn
(
db
, 
´št_key_¡©
, 
key_¡©s
);

270 
	gREADMODIFYWRITE
:

271 
¡©us
 = 
T¿n§ùiÚR—dModifyWr™e
(
db
, 
´št_key_¡©
, 
key_¡©s
);

274 
throw
 
uts
::
Exû±iÚ
("Operation„equest is‚ot„ecognized!");

276 
as£¹
(
¡©us
 >= 0);

277  (
	g¡©us
 =ğ
DB
::
kOK
);

280 
šlše
 
	gCÜeWÜklßd
::
T¿n§ùiÚR—d
(
DB
 &
db
, 
boŞ
 
´št_key_¡©
, 
¡d
::
m­
<
ušt64_t
, ušt64_t>& 
key_¡©s
) {

281 
ušt64_t
 
	gkey_num
 = 
NextT¿n§ùiÚKeyNum
();

282 cÚ¡ 
	g¡d
::
¡ršg
 
key
 = 
BudKeyName
(
key_num
);

283 
	g¡d
::
veùÜ
<
DB
::
F›ld
> 
»suÉ
;

285 if(
	g´št_key_¡©
) {

286 
	gkey_¡©s
[
key_num
]++;

290 ià(!
»ad_®l_f›lds
()) {

291 
	g¡d
::
veùÜ
<
¡d
::
¡ršg
> 
f›lds
;

292 
	gf›lds
.
push_back
(
NextF›ldName
());

293  
	gdb
.
R—d
(
bË_Çme_
, 
key
, &
f›lds
, 
»suÉ
);

295  
	gdb
.
R—d
(
bË_Çme_
, 
key
, 
NULL
, 
»suÉ
);

299 
šlše
 
	gCÜeWÜklßd
::
T¿n§ùiÚR—dModifyWr™e
(
DB
 &
db
, 
boŞ
 
´št_key_¡©
, 
¡d
::
m­
<
ušt64_t
, ušt64_t>& 
key_¡©s
) {

300 
ušt64_t
 
	gkey_num
 = 
NextT¿n§ùiÚKeyNum
();

301 cÚ¡ 
	g¡d
::
¡ršg
 
key
 = 
BudKeyName
(
key_num
);

302 
	g¡d
::
veùÜ
<
DB
::
F›ld
> 
»suÉ
;

304 if(
	g´št_key_¡©
) {

305 
	gkey_¡©s
[
key_num
]++;

309 ià(!
»ad_®l_f›lds
()) {

310 
	g¡d
::
veùÜ
<
¡d
::
¡ršg
> 
f›lds
;

311 
	gf›lds
.
push_back
(
NextF›ldName
());

312 
	gdb
.
R—d
(
bË_Çme_
, 
key
, &
f›lds
, 
»suÉ
);

314 
	gdb
.
R—d
(
bË_Çme_
, 
key
, 
NULL
, 
»suÉ
);

317 
	g¡d
::
veùÜ
<
DB
::
F›ld
> 
v®ues
;

318 ià(
wr™e_®l_f›lds
()) {

319 
BudV®ues
(
v®ues
);

321 
BudSšgËV®ue
(
v®ues
);

323  
	gdb
.
Upd©e
(
bË_Çme_
, 
key
, 
v®ues
);

326 
šlše
 
	gCÜeWÜklßd
::
T¿n§ùiÚSÿn
(
DB
 &
db
, 
boŞ
 
´št_key_¡©
, 
¡d
::
m­
<
ušt64_t
, ušt64_t>& 
key_¡©s
) {

327 
ušt64_t
 
	gkey_num
 = 
NextT¿n§ùiÚKeyNum
();

328 cÚ¡ 
	g¡d
::
¡ršg
 
key
 = 
BudKeyName
(
key_num
);

329 
	gËn
 = 
sÿn_Ën_choo£r_
->
Next
();

330 
	g¡d
::
veùÜ
<
¡d
::veùÜ<
DB
::
F›ld
>> 
»suÉ
;

332 if(
	g´št_key_¡©
) {

333 
	gkey_¡©s
[
key_num
]++;

337 ià(!
»ad_®l_f›lds
()) {

338 
	g¡d
::
veùÜ
<
¡d
::
¡ršg
> 
f›lds
;

339 
	gf›lds
.
push_back
(
NextF›ldName
());

340  
	gdb
.
Sÿn
(
bË_Çme_
, 
key
, 
Ën
, &
f›lds
, 
»suÉ
);

342  
	gdb
.
Sÿn
(
bË_Çme_
, 
key
, 
Ën
, 
NULL
, 
»suÉ
);

346 
šlše
 
	gCÜeWÜklßd
::
T¿n§ùiÚUpd©e
(
DB
 &
db
, 
boŞ
 
´št_key_¡©
, 
¡d
::
m­
<
ušt64_t
, ušt64_t>& 
key_¡©s
) {

347 
ušt64_t
 
	gkey_num
 = 
NextT¿n§ùiÚKeyNum
();

348 cÚ¡ 
	g¡d
::
¡ršg
 
key
 = 
BudKeyName
(
key_num
);

349 
	g¡d
::
veùÜ
<
DB
::
F›ld
> 
v®ues
;

351 if(
	g´št_key_¡©
) {

352 
	gkey_¡©s
[
key_num
]++;

356 ià(
wr™e_®l_f›lds
()) {

357 
BudV®ues
(
v®ues
);

359 
BudSšgËV®ue
(
v®ues
);

361  
	gdb
.
Upd©e
(
bË_Çme_
, 
key
, 
v®ues
);

364 
šlše
 
	gCÜeWÜklßd
::
T¿n§ùiÚIn£¹
(
DB
 &
db
, 
boŞ
 
´št_key_¡©
, 
¡d
::
m­
<
ušt64_t
, ušt64_t>& 
key_¡©s
) {

366 
ušt64_t
 
	gkey_num
 = 
NextT¿n§ùiÚKeyNum
();

367 cÚ¡ 
	g¡d
::
¡ršg
 
key
 = 
BudKeyName
(
key_num
);

368 
	g¡d
::
veùÜ
<
DB
::
F›ld
> 
v®ues
;

369 
BudV®ues
(
v®ues
);

371 if(
	g´št_key_¡©
) {

372 
	gkey_¡©s
[
key_num
]++;

376 
	gs
 = 
db
.
In£¹
(
bË_Çme_
, 
key
, 
v®ues
);

378  
	gs
;

	@core/countdown_latch.h

8 #iâdeà
YCSB_C_COUNTDOWN_LATCH_H_


9 
	#YCSB_C_COUNTDOWN_LATCH_H_


	)

11 
	~<mu‹x
>

12 
	~<cÚd™iÚ_v¬ŸbË
>

14 şas 
	cCouÁDownL©ch
 {

15 
	mpublic
:

16 
	$CouÁDownL©ch
(
couÁ
è: 
	$couÁ_
(
couÁ
) {}

17 
	$Awa™
() {

18 
¡d
::
unique_lock
<¡d::
mu‹x
> 
	`lock
(
mu_
);

19 ià(
couÁ_
 > 0) {

20 
cv_
.
	`wa™
(
lock
);

22 
	}
}

23 
boŞ
 
	$Awa™FÜ
(
timeout_£c
) {

24 
¡d
::
unique_lock
<¡d::
mu‹x
> 
	`lock
(
mu_
);

25 ià(
couÁ_
 > 0) {

26  
cv_
.
	`wa™_fÜ
(
lock
, 
¡d
::
chrÚo
::
	`£cÚds
(
timeout_£c
)è=ğ¡d::
cv_¡©us
::
no_timeout
;

28  
Œue
;

29 
	}
}

30 
	$CouÁDown
() {

31 
¡d
::
unique_lock
<¡d::
mu‹x
> 
	`lock
(
mu_
);

32 ià(--
couÁ_
 <= 0) {

33 
cv_
.
	`nÙify_®l
();

35 
	}
}

36 
	g´iv©e
:

37 
couÁ_
;

38 
	g¡d
::
mu‹x
 
mu_
;

39 
	g¡d
::
cÚd™iÚ_v¬ŸbË
 
cv_
;

	@core/counter_generator.h

9 #iâdeà
YCSB_C_COUNTER_GENERATOR_H_


10 
	#YCSB_C_COUNTER_GENERATOR_H_


	)

12 
	~"g’”©Ü.h
"

14 
	~<©omic
>

16 
Çme¥aû
 
	gycsbc
 {

18 
şass
 
	gCouÁ”G’”©Ü
 : 
public
 
G’”©Ü
<
ušt64_t
> {

19 
public
:

20 
CouÁ”G’”©Ü
(
ušt64_t
 
¡¬t
è: 
couÁ”_
(start) { }

21 
ušt64_t
 
Next
(è{  
couÁ”_
.
ãtch_add
(1); }

22 
ušt64_t
 
La¡
(è{  
	gcouÁ”_
.
lßd
() - 1; }

23 
	g´iv©e
:

24 
¡d
::
©omic
<
ušt64_t
> 
couÁ”_
;

	@core/db.h

9 #iâdeà
YCSB_C_DB_H_


10 
	#YCSB_C_DB_H_


	)

12 
	~"´İ”t›s.h
"

14 
	~<veùÜ
>

15 
	~<¡ršg
>

17 
Çme¥aû
 
	gycsbc
 {

23 şas 
	cDB
 {

24 
	gpublic
:

25 
	sF›ld
 {

26 
¡d
::
¡ršg
 
Çme
;

27 
	g¡d
::
¡ršg
 
v®ue
;

29 
	eStus
 {

30 
	gkOK
 = 0,

31 
	gkE¼Ü
,

32 
	gkNÙFound
,

33 
	gkNÙIm¶em’‹d


38 
vœtu®
 
In™
() { }

42 
vœtu®
 
CËªup
() { }

53 
vœtu®
 
Stus
 
R—d
(cÚ¡ 
¡d
::
¡ršg
 &
bË
, cÚ¡ std::¡ršg &
key
,

54 cÚ¡ 
¡d
::
veùÜ
<¡d::
¡ršg
> *
f›lds
,

55 
¡d
::
veùÜ
<
F›ld
> &
»suÉ
) = 0;

68 
vœtu®
 
Stus
 
Sÿn
(cÚ¡ 
¡d
::
¡ršg
 &
bË
, cÚ¡ std::¡ršg &
key
,

69 
»cÜd_couÁ
, cÚ¡ 
¡d
::
veùÜ
<¡d::
¡ršg
> *
f›lds
,

70 
¡d
::
veùÜ
<¡d::veùÜ<
F›ld
>> &
»suÉ
) = 0;

81 
vœtu®
 
Stus
 
Upd©e
(cÚ¡ 
¡d
::
¡ršg
 &
bË
, cÚ¡ std::¡ršg &
key
,

82 
¡d
::
veùÜ
<
F›ld
> &
v®ues
) = 0;

92 
vœtu®
 
Stus
 
In£¹
(cÚ¡ 
¡d
::
¡ršg
 &
bË
, cÚ¡ std::¡ršg &
key
,

93 
¡d
::
veùÜ
<
F›ld
> &
v®ues
) = 0;

101 
vœtu®
 
Stus
 
D–‘e
(cÚ¡ 
¡d
::
¡ršg
 &
bË
, cÚ¡ std::¡ršg &
key
) = 0;

103 
	gvœtu®
 ~
DB
() { }

105 
S‘Prİs
(
uts
::
Prİ”t›s
 *
´İs
) {

106 
´İs_
 = 
´İs
;

108 
	g´Ùeùed
:

109 
uts
::
Prİ”t›s
 *
´İs_
;

	@core/db_factory.cc

9 
	~"db_çùÜy.h
"

10 
	~"basic_db.h
"

11 
	~"db_w¿µ”.h
"

13 
Çme¥aû
 
	gycsbc
 {

16 
	g¡d
::
m­
<
¡d
::
¡ršg
, 
	gDBFaùÜy
::
DBC»©Ü
> &
DBFaùÜy
::
Regi¡ry
() {

17 
¡d
::
m­
<¡d::
¡ršg
, 
	gDBC»©Ü
> 
	g»gi¡ry
;

18  
	g»gi¡ry
;

21 
boŞ
 
	gDBFaùÜy
::
Regi¡”DB
(
¡d
::
¡ršg
 
db_Çme
, 
DBC»©Ü
 
db_ü—tÜ
) {

22 
Regi¡ry
()[
db_Çme
] = 
db_ü—tÜ
;

23  
	gŒue
;

26 
DB
 *
	gDBFaùÜy
::
C»©eDB
(
uts
::
Prİ”t›s
 *
´İs
, 
M—su»m’ts
 *
m—su»m’ts
) {

27 
	g¡d
::
¡ršg
 
db_Çme
 = 
´İs
->
G‘Prİ”ty
("dbname", "basic");

28 
DB
 *
	gdb
 = 
nuÎ±r
;

29 
	g¡d
::
m­
<
¡d
::
¡ršg
, 
	gDBC»©Ü
> &
	g»gi¡ry
 = 
Regi¡ry
();

30 ià(
	g»gi¡ry
.
fšd
(
db_Çme
è!ğ
»gi¡ry
.
’d
()) {

31 
DB
 *
Ãw_db
 = (*
»gi¡ry
[
db_Çme
])();

32 
	gÃw_db
->
S‘Prİs
(
´İs
);

33 
	gdb
 = 
Ãw
 
DBW¿µ”
(
Ãw_db
, 
m—su»m’ts
);

35  
	gdb
;

	@core/db_factory.h

9 #iâdeà
YCSB_C_DB_FACTORY_H_


10 
	#YCSB_C_DB_FACTORY_H_


	)

12 
	~"db.h
"

13 
	~"m—su»m’ts.h
"

14 
	~"´İ”t›s.h
"

16 
	~<¡ršg
>

17 
	~<m­
>

19 
Çme¥aû
 
	gycsbc
 {

21 şas 
	cDBFaùÜy
 {

22 
	gpublic
:

23 
usšg
 
DBC»©Ü
 = 
DB
 *(*)();

24 
boŞ
 
Regi¡”DB
(
¡d
::
¡ršg
 
db_Çme
, 
DBC»©Ü
 
db_ü—tÜ
);

25 
DB
 *
C»©eDB
(
uts
::
Prİ”t›s
 *
´İs
, 
M—su»m’ts
 *
m—su»m’ts
);

26 
	g´iv©e
:

27 
¡d
::
m­
<¡d::
¡ršg
, 
	gDBC»©Ü
> &
Regi¡ry
();

	@core/db_wrapper.h

8 #iâdeà
YCSB_C_DB_WRAPPER_H_


9 
	#YCSB_C_DB_WRAPPER_H_


	)

11 
	~<¡ršg
>

12 
	~<veùÜ
>

14 
	~"db.h
"

15 
	~"m—su»m’ts.h
"

16 
	~"tim”.h
"

17 
	~"uts.h
"

19 
Çme¥aû
 
	gycsbc
 {

21 şas 
	cDBW¿µ”
 : 
public
 
DB
 {

22 
public
:

23 
DBW¿µ”
(
DB
 *
db
, 
M—su»m’ts
 *
m—su»m’ts
è: 
db_
(db), 
m—su»m’ts_
(measurements) {}

24 ~
DBW¿µ”
() {

25 
d–‘e
 
	gdb_
;

27 
In™
() {

28 
	gdb_
->
In™
();

30 
CËªup
() {

31 
	gdb_
->
CËªup
();

33 
Stus
 
R—d
(cÚ¡ 
¡d
::
¡ršg
 &
bË
, cÚ¡ std::¡ršg &
key
,

34 cÚ¡ 
¡d
::
veùÜ
<¡d::
¡ršg
> *
f›lds
, std::veùÜ<
F›ld
> &
»suÉ
) {

35 
tim”_
.
S¹
();

36 
Stus
 
	gs
 = 
db_
->
R—d
(
bË
, 
key
, 
f›lds
, 
»suÉ
);

37 
ušt64_t
 
	g–­£d
 = 
tim”_
.
End
();

38 
	gm—su»m’ts_
->
R•Üt
(
READ
, 
–­£d
);

39  
	gs
;

41 
Stus
 
Sÿn
(cÚ¡ 
¡d
::
¡ršg
 &
bË
, cÚ¡ std::¡ršg &
key
, 
»cÜd_couÁ
,

42 cÚ¡ 
¡d
::
veùÜ
<¡d::
¡ršg
> *
f›lds
, std::veùÜ<¡d::veùÜ<
F›ld
>> &
»suÉ
) {

43 
tim”_
.
S¹
();

44 
Stus
 
	gs
 = 
db_
->
Sÿn
(
bË
, 
key
, 
»cÜd_couÁ
, 
f›lds
, 
»suÉ
);

45 
ušt64_t
 
	g–­£d
 = 
tim”_
.
End
();

46 
	gm—su»m’ts_
->
R•Üt
(
SCAN
, 
–­£d
);

47  
	gs
;

49 
Stus
 
Upd©e
(cÚ¡ 
¡d
::
¡ršg
 &
bË
, cÚ¡ std::¡ršg &
key
, std::
veùÜ
<
F›ld
> &
v®ues
) {

50 
tim”_
.
S¹
();

51 
Stus
 
	gs
 = 
db_
->
Upd©e
(
bË
, 
key
, 
v®ues
);

52 
ušt64_t
 
	g–­£d
 = 
tim”_
.
End
();

53 
	gm—su»m’ts_
->
R•Üt
(
UPDATE
, 
–­£d
);

54  
	gs
;

56 
Stus
 
In£¹
(cÚ¡ 
¡d
::
¡ršg
 &
bË
, cÚ¡ std::¡ršg &
key
, std::
veùÜ
<
F›ld
> &
v®ues
) {

57 
tim”_
.
S¹
();

58 
Stus
 
	gs
 = 
db_
->
In£¹
(
bË
, 
key
, 
v®ues
);

59 
ušt64_t
 
	g–­£d
 = 
tim”_
.
End
();

60 
	gm—su»m’ts_
->
R•Üt
(
INSERT
, 
–­£d
);

61  
	gs
;

63 
Stus
 
D–‘e
(cÚ¡ 
¡d
::
¡ršg
 &
bË
, cÚ¡ std::¡ršg &
key
) {

64 
tim”_
.
S¹
();

65 
Stus
 
	gs
 = 
db_
->
D–‘e
(
bË
, 
key
);

66 
ušt64_t
 
	g–­£d
 = 
tim”_
.
End
();

67 
	gm—su»m’ts_
->
R•Üt
(
DELETE
, 
–­£d
);

68  
	gs
;

70 
	g´iv©e
:

71 
DB
 *
db_
;

72 
M—su»m’ts
 *
	gm—su»m’ts_
;

73 
	guts
::
Tim”
<
ušt64_t
, 
	g¡d
::
Çno
> 
tim”_
;

	@core/discrete_generator.h

9 #iâdeà
YCSB_C_DISCRETE_GENERATOR_H_


10 
	#YCSB_C_DISCRETE_GENERATOR_H_


	)

12 
	~"g’”©Ü.h
"

14 
	~<©omic
>

15 
	~<ÿs£¹
>

16 
	~<veùÜ
>

17 
	~"uts.h
"

19 
Çme¥aû
 
	gycsbc
 {

21 
	g‹m¶©e
 <
ty³Çme
 
	gV®ue
>

22 
şass
 
	gDisü‘eG’”©Ü
 : 
public
 
G’”©Ü
<
V®ue
> {

23 
public
:

24 
Disü‘eG’”©Ü
(è: 
sum_
(0) { }

25 
AddV®ue
(
V®ue
 
v®ue
, 
weight
);

27 
V®ue
 
Next
();

28 
V®ue
 
La¡
(è{  
	gÏ¡_
; }

30 
	g´iv©e
:

31 
¡d
::
veùÜ
<¡d::
·œ
<
V®ue
, >> 
	gv®ues_
;

32 
	gsum_
;

33 
	g¡d
::
©omic
<
V®ue
> 
Ï¡_
;

36 
	g‹m¶©e
 <
ty³Çme
 
	gV®ue
>

37 
šlše
 
	gDisü‘eG’”©Ü
<
	gV®ue
>::
AddV®ue
(
V®ue
 
v®ue
, 
weight
) {

38 ià(
	gv®ues_
.
em±y
()) {

39 
	gÏ¡_
 = 
v®ue
;

41 
	gv®ues_
.
push_back
(
¡d
::
make_·œ
(
v®ue
, 
weight
));

42 
	gsum_
 +ğ
weight
;

45 
	g‹m¶©e
 <
ty³Çme
 
	gV®ue
>

46 
šlše
 
V®ue
 
	gDisü‘eG’”©Ü
<
	gV®ue
>::
Next
() {

47 
choo£r
 = 
uts
::
Th»adLoÿlRªdomDoubË
();

49 autØ
	gp
 = 
v®ues_
.
cbegš
();… !ğv®ues_.
ûnd
(); ++p) {

50 ià(
	gchoo£r
 < 
	gp
->
	g£cÚd
 / 
	gsum_
) {

51  
	gÏ¡_
 = 
p
->
fœ¡
;

53 
	gchoo£r
 -ğ
p
->
£cÚd
 / 
sum_
;

56 
as£¹
(
çl£
);

57  
	gÏ¡_
;

	@core/generator.h

9 #iâdeà
YCSB_C_GENERATOR_H_


10 
	#YCSB_C_GENERATOR_H_


	)

12 
	~<c¡dšt
>

14 
Çme¥aû
 
	gycsbc
 {

16 
	g‹m¶©e
 <
ty³Çme
 
	gV®ue
>

17 şas 
	cG’”©Ü
 {

18 
	gpublic
:

19 
vœtu®
 
V®ue
 
Next
() = 0;

20 
vœtu®
 
V®ue
 
La¡
() = 0;

21 
	gvœtu®
 ~
G’”©Ü
() { }

	@core/measurements.cc

8 
	~"m—su»m’ts.h
"

10 
	~<©omic
>

11 
	~<lim™s
>

12 
	~<num”ic
>

13 
	~<s¡»am
>

15 
Çme¥aû
 
	gycsbc
 {

17 
	gM—su»m’ts
::
M—su»m’ts
(è: 
couÁ_
{}, 
	gÏ‹ncy_sum_
{}, 
	gÏ‹ncy_max_
{} {

18 
	g¡d
::
fl
(
¡d
::
begš
(
Ï‹ncy_mš_
), std::
’d
Ö©’cy_mš_), std::
num”ic_lim™s
<
ušt64_t
>::
max
());

21 
	gM—su»m’ts
::
R•Üt
(
O³¿tiÚ
 
İ
, 
ušt64_t
 
Ï‹ncy
) {

22 
	gcouÁ_
[
İ
].
ãtch_add
(1, 
¡d
::
memÜy_Üd”_»Ïxed
);

23 
	gÏ‹ncy_sum_
[
İ
].
ãtch_add
(
Ï‹ncy
, 
¡d
::
memÜy_Üd”_»Ïxed
);

24 
ušt64_t
 
	g´ev_mš
 = 
Ï‹ncy_mš_
[
İ
].
lßd
(
¡d
::
memÜy_Üd”_»Ïxed
);

25 
	g´ev_mš
 > 
	gÏ‹ncy


26 && !
	gÏ‹ncy_mš_
[
İ
].
com·»_exchªge_w—k
(
´ev_mš
, 
Ï‹ncy
, 
¡d
::
memÜy_Üd”_»Ïxed
));

27 
ušt64_t
 
	g´ev_max
 = 
Ï‹ncy_max_
[
İ
].
lßd
(
¡d
::
memÜy_Üd”_»Ïxed
);

28 
	g´ev_max
 < 
	gÏ‹ncy


29 && !
	gÏ‹ncy_max_
[
İ
].
com·»_exchªge_w—k
(
´ev_max
, 
Ï‹ncy
, 
¡d
::
memÜy_Üd”_»Ïxed
));

32 
	g¡d
::
¡ršg
 
M—su»m’ts
::
G‘StusMsg
() {

33 
¡d
::
o¡ršg¡»am
 
msg_¡»am
;

34 
	gmsg_¡»am
.
´ecisiÚ
(2);

35 
ušt64_t
 
	gtÙ®_út
 = 0;

36 
	gmsg_¡»am
 << 
	g¡d
::
fixed
 << " operations;";

37 
	gi
 = 0; i < 
	gMAXOPTYPE
; i++) {

38 
O³¿tiÚ
 
	gİ
 = 
¡©ic_ÿ¡
<O³¿tiÚ>(
i
);

39 
ušt64_t
 
	gút
 = 
G‘CouÁ
(
İ
);

40 ià(
	gút
 == 0)

42 
	gmsg_¡»am
 << " [" << 
	gkO³¿tiÚSŒšg
[
İ
] << ":"

43 << " CouÁ=" << 
	gút


44 << " Max=" << 
	gÏ‹ncy_max_
[
İ
].
lßd
(
¡d
::
memÜy_Üd”_»Ïxed
) / 1000.0

45 << " Mš=" << 
Ï‹ncy_mš_
[
İ
].
lßd
(
¡d
::
memÜy_Üd”_»Ïxed
) / 1000.0

47 << ((
út
 > 0)

48 ? 
¡©ic_ÿ¡
<>(
Ï‹ncy_sum_
[
İ
].
lßd
(
¡d
::
memÜy_Üd”_»Ïxed
)è/ 
út


51 
	gtÙ®_út
 +ğ
út
;

53  
	g¡d
::
to_¡ršg
(
tÙ®_út
è+ 
msg_¡»am
.
¡r
();

56 
	gM—su»m’ts
::
Re£t
() {

57 
¡d
::
fl
(¡d::
begš
(
couÁ_
), std::
’d
(count_), 0);

58 
	g¡d
::
fl
(
¡d
::
begš
(
Ï‹ncy_sum_
), std::
’d
(latency_sum_), 0);

59 
	g¡d
::
fl
(
¡d
::
begš
(
Ï‹ncy_mš_
), std::
’d
Ö©’cy_mš_), std::
num”ic_lim™s
<
ušt64_t
>::
max
());

60 
	g¡d
::
fl
(
¡d
::
begš
(
Ï‹ncy_max_
), std::
’d
(latency_max_), 0);

	@core/measurements.h

8 #iâdeà
YCSB_C_MEASUREMENTS_H_


9 
	#YCSB_C_MEASUREMENTS_H_


	)

11 
	~"cÜe_wÜklßd.h
"

13 
	~<©omic
>

15 
Çme¥aû
 
	gycsbc
 {

17 şas 
	cM—su»m’ts
 {

18 
	gpublic
:

19 
M—su»m’ts
();

20 
R•Üt
(
O³¿tiÚ
 
İ
, 
ušt64_t
 
Ï‹ncy
);

21 
ušt64_t
 
G‘CouÁ
(
O³¿tiÚ
 
İ
) {

22  
	gcouÁ_
[
İ
].
lßd
(
¡d
::
memÜy_Üd”_»Ïxed
);

24 
G‘L©’cy
(
O³¿tiÚ
 
İ
) {

25 
ušt64_t
 
	gút
 = 
G‘CouÁ
(
İ
);

26  
	gút
 > 0

27 ? 
	g¡©ic_ÿ¡
<>(
	gÏ‹ncy_sum_
[
İ
].
lßd
(
¡d
::
memÜy_Üd”_»Ïxed
)è/ 
út


30 
	g¡d
::
¡ršg
 
G‘StusMsg
();

31 
Re£t
();

32 
	g´iv©e
:

33 
¡d
::
©omic
<
ušt
> 
couÁ_
[
MAXOPTYPE
];

34 
	g¡d
::
©omic
<
ušt64_t
> 
Ï‹ncy_sum_
[
MAXOPTYPE
];

35 
	g¡d
::
©omic
<
ušt64_t
> 
Ï‹ncy_mš_
[
MAXOPTYPE
];

36 
	g¡d
::
©omic
<
ušt64_t
> 
Ï‹ncy_max_
[
MAXOPTYPE
];

	@core/properties.h

9 #iâdeà
YCSB_C_PROPERTIES_H_


10 
	#YCSB_C_PROPERTIES_H_


	)

12 
	~<¡ršg
>

13 
	~<m­
>

14 
	~<f¡»am
>

15 
	~<ÿs£¹
>

17 
	~"uts.h
"

19 
Çme¥aû
 
	gycsbc
 {

21 
Çme¥aû
 
	guts
 {

23 şas 
	cPrİ”t›s
 {

24 
	gpublic
:

25 
¡d
::
¡ršg
 
G‘Prİ”ty
(cÚ¡ std::¡ršg &
key
,

26 cÚ¡ 
¡d
::
¡ršg
 &
deçuÉ_v®ue
 = std::string()) const;

27 cÚ¡ 
	g¡d
::
¡ršg
 &
İ”©Ü
[](cÚ¡ 
¡d
::¡ršg &
key
) const;

28 
S‘Prİ”ty
(cÚ¡ 
¡d
::
¡ršg
 &
key
, cÚ¡ std::¡ršg &
v®ue
);

29 
boŞ
 
CÚšsKey
(cÚ¡ 
¡d
::
¡ršg
 &
key
) const;

30 
Lßd
(
¡d
::
if¡»am
 &
šput
);

31 
	g´iv©e
:

32 
¡d
::
m­
<¡d::
¡ršg
, 
	g¡d
::¡ršg> 
´İ”t›s_
;

35 
šlše
 
	g¡d
::
¡ršg
 
Prİ”t›s
::
G‘Prİ”ty
(cÚ¡ 
¡d
::¡ršg &
key
,

36 cÚ¡ 
¡d
::
¡ršg
 &
deçuÉ_v®ue
) const {

37 
¡d
::
m­
<¡d::
¡ršg
, 
	g¡d
::¡ršg>::
cÚ¡_™”©Ü
 
™
 = 
´İ”t›s_
.
fšd
(
key
);

38 ià(
	g´İ”t›s_
.
’d
(è=ğ
™
) {

39  
deçuÉ_v®ue
;

41  
	g™
->
	g£cÚd
;

45 
šlše
 cÚ¡ 
	g¡d
::
¡ršg
 &
Prİ”t›s
::
İ”©Ü
[](cÚ¡ 
¡d
::¡ršg &
key
) const {

46  
´İ”t›s_
.
©
(
key
);

49 
šlše
 
	gPrİ”t›s
::
S‘Prİ”ty
(cÚ¡ 
¡d
::
¡ršg
 &
key
, cÚ¡ std::¡ršg &
v®ue
) {

50 
´İ”t›s_
[
key
] = 
v®ue
;

53 
šlše
 
boŞ
 
	gPrİ”t›s
::
CÚšsKey
(cÚ¡ 
¡d
::
¡ršg
 &
key
) const {

54  
´İ”t›s_
.
fšd
(
key
è!ğ´İ”t›s_.
’d
();

57 
šlše
 
	gPrİ”t›s
::
Lßd
(
¡d
::
if¡»am
 &
šput
) {

58 ià(!
šput
.
is_İ’
()) {

59 
throw
 
uts
::
Exû±iÚ
("File‚ot open!");

62 !
	gšput
.
eof
(è&& !šput.
bad
()) {

63 
	g¡d
::
¡ršg
 
lše
;

64 
	g¡d
::
g‘lše
(
šput
, 
lše
);

65 ià(
	glše
[0] == '#') ;

66 
size_t
 
	gpos
 = 
lše
.
fšd_fœ¡_of
('=');

67 ià(
	gpos
 =ğ
¡d
::
¡ršg
::
Åos
) ;

68 
S‘Prİ”ty
(
Trim
(
lše
.
sub¡r
(0, 
pos
)), Trim(line.substr(pos + 1)));

	@core/random_byte_generator.h

8 #iâdeà
YCSB_C_RANDOM_BYTE_GENERATOR_H_


9 
	#YCSB_C_RANDOM_BYTE_GENERATOR_H_


	)

11 
	~"g’”©Ü.h
"

12 
	~"uts.h
"

14 
	~<¿ndom
>

16 
Çme¥aû
 
	gycsbc
 {

18 
şass
 
	gRªdomBy‹G’”©Ü
 : 
public
 
G’”©Ü
<> {

19 
public
:

20 
RªdomBy‹G’”©Ü
(è: 
off_
(6) {}

22 
Next
();

23 
La¡
();

25 
	g´iv©e
:

26 
buf_
[6];

27 
	goff_
;

30 
šlše
 
	gRªdomBy‹G’”©Ü
::
Next
() {

31 ià(
off_
 == 6) {

32 
by‹s
 = 
uts
::
Th»adLoÿlRªdomIÁ
();

33 
	gbuf_
[0] = 
¡©ic_ÿ¡
<>((
by‹s
 & 31) + ' ');

34 
	gbuf_
[1] = 
¡©ic_ÿ¡
<>(((
by‹s
 >> 5) & 63) + ' ');

35 
	gbuf_
[2] = 
¡©ic_ÿ¡
<>(((
by‹s
 >> 10) & 95)+ ' ');

36 
	gbuf_
[3] = 
¡©ic_ÿ¡
<>(((
by‹s
 >> 15) & 31)+ ' ');

37 
	gbuf_
[4] = 
¡©ic_ÿ¡
<>(((
by‹s
 >> 20) & 63)+ ' ');

38 
	gbuf_
[5] = 
¡©ic_ÿ¡
<>(((
by‹s
 >> 25) & 95)+ ' ');

39 
	goff_
 = 0;

41  
	gbuf_
[
off_
++];

44 
šlše
 
	gRªdomBy‹G’”©Ü
::
La¡
() {

45  
buf_
[(
off_
 - 1 + 6) % 6];

	@core/scrambled_zipfian_generator.h

9 #iâdeà
YCSB_C_SCRAMBLED_ZIPFIAN_GENERATOR_H_


10 
	#YCSB_C_SCRAMBLED_ZIPFIAN_GENERATOR_H_


	)

12 
	~"g’”©Ü.h
"

14 
	~<c¡dšt
>

15 
	~"uts.h
"

16 
	~"zfŸn_g’”©Ü.h
"

18 
Çme¥aû
 
	gycsbc
 {

20 
şass
 
	gSüambËdZfŸnG’”©Ü
 : 
public
 
G’”©Ü
<
ušt64_t
> {

21 
public
:

22 
SüambËdZfŸnG’”©Ü
(
ušt64_t
 
mš
, ušt64_ˆ
max
, 
zfŸn_cÚ¡
) :

23 
ba£_
(
mš
), 
num_™ems_
(
max
 - mš + 1), 
g’”©Ü_
(0, 10000000000LL, 
zfŸn_cÚ¡
) { }

25 
SüambËdZfŸnG’”©Ü
(
ušt64_t
 
mš
, ušt64_ˆ
max
) :

26 
ba£_
(
mš
), 
num_™ems_
(
max
 - min + 1),

27 
g’”©Ü_
(0, 10000000000LL, 
ZfŸnG’”©Ü
::
kZfŸnCÚ¡
, 
kZ‘ª
) { }

29 
SüambËdZfŸnG’”©Ü
(
ušt64_t
 
num_™ems
) :

30 
SüambËdZfŸnG’”©Ü
(0, 
num_™ems
 - 1) { }

32 
ušt64_t
 
Next
();

33 
ušt64_t
 
La¡
();

35 
	g´iv©e
:

36 
cÚ¡ex´
 
kZ‘ª
 = 26.46902820178302;

37 cÚ¡ 
ušt64_t
 
	gba£_
;

38 cÚ¡ 
ušt64_t
 
	gnum_™ems_
;

39 
ZfŸnG’”©Ü
 
	gg’”©Ü_
;

41 
ušt64_t
 
SüambË
(ušt64_ˆ
v®ue
) const;

44 
šlše
 
ušt64_t
 
	gSüambËdZfŸnG’”©Ü
::
SüambË
(ušt64_ˆ
v®ue
) const {

45  
ba£_
 + 
uts
::
FNVHash64
(
v®ue
è% 
num_™ems_
;

48 
šlše
 
ušt64_t
 
	gSüambËdZfŸnG’”©Ü
::
Next
() {

49  
SüambË
(
g’”©Ü_
.
Next
());

52 
šlše
 
ušt64_t
 
	gSüambËdZfŸnG’”©Ü
::
La¡
() {

53  
SüambË
(
g’”©Ü_
.
La¡
());

	@core/skewed_latest_generator.h

9 #iâdeà
YCSB_C_SKEWED_LATEST_GENERATOR_H_


10 
	#YCSB_C_SKEWED_LATEST_GENERATOR_H_


	)

12 
	~"g’”©Ü.h
"

14 
	~<©omic
>

15 
	~<c¡dšt
>

16 
	~"couÁ”_g’”©Ü.h
"

17 
	~"zfŸn_g’”©Ü.h
"

19 
Çme¥aû
 
	gycsbc
 {

21 
şass
 
	gSkewedL©e¡G’”©Ü
 : 
public
 
G’”©Ü
<
ušt64_t
> {

22 
public
:

23 
SkewedL©e¡G’”©Ü
(
CouÁ”G’”©Ü
 &
couÁ”
) :

24 
basis_
(
couÁ”
), 
zfŸn_
(basis_.
La¡
()) {

25 
Next
();

28 
ušt64_t
 
Next
();

29 
ušt64_t
 
La¡
(è{  
	gÏ¡_
; }

30 
	g´iv©e
:

31 
CouÁ”G’”©Ü
 &
basis_
;

32 
ZfŸnG’”©Ü
 
	gzfŸn_
;

33 
	g¡d
::
©omic
<
ušt64_t
> 
Ï¡_
;

36 
šlše
 
ušt64_t
 
	gSkewedL©e¡G’”©Ü
::
Next
() {

37 
ušt64_t
 
max
 = 
basis_
.
La¡
();

38  
	gÏ¡_
 = 
max
 - 
zfŸn_
.
Next
(max);

	@core/timer.h

9 #iâdeà
YCSB_C_TIMER_H_


10 
	#YCSB_C_TIMER_H_


	)

12 
	~<chrÚo
>

14 
Çme¥aû
 
	gycsbc
 {

16 
Çme¥aû
 
	guts
 {

18 
	g‹m¶©e
 <
ty³Çme
 
	gR
,y³Çm
	gP
 = 
¡d
::
¿tio
<1>>

19 şas 
	cTim”
 {

20 
public
:

21 
S¹
() {

22 
time_
 = 
Clock
::
now
();

25 
R
 
End
() {

26 
Du¿tiÚ
 
	g¥ª
;

27 
	gClock
::
time_pošt
 
t
 = 
Clock
::
now
();

28 
	g¥ª
 = 
¡d
::
chrÚo
::
du¿tiÚ_ÿ¡
<
Du¿tiÚ
>(
t
 - 
time_
);

29  
	g¥ª
.
couÁ
();

32 
	g´iv©e
:

33 
usšg
 
Du¿tiÚ
 = 
¡d
::
chrÚo
::
du¿tiÚ
<
R
, 
	gP
>;

34 
usšg
 
	gClock
 = 
¡d
::
chrÚo
::
high_»sŞutiÚ_şock
;

36 
	gClock
::
time_pošt
 
time_
;

	@core/uniform_generator.h

9 #iâdeà
YCSB_C_UNIFORM_GENERATOR_H_


10 
	#YCSB_C_UNIFORM_GENERATOR_H_


	)

12 
	~"g’”©Ü.h
"

14 
	~<©omic
>

15 
	~<¿ndom
>

17 
Çme¥aû
 
	gycsbc
 {

19 
şass
 
	gUnifÜmG’”©Ü
 : 
public
 
G’”©Ü
<
ušt64_t
> {

20 
public
:

22 
UnifÜmG’”©Ü
(
ušt64_t
 
mš
, ušt64_ˆ
max
è: 
di¡_
(mš, maxè{ 
Next
(); }

24 
ušt64_t
 
Next
();

25 
ušt64_t
 
La¡
();

27 
	g´iv©e
:

28 
¡d
::
mt19937_64
 
g’”©Ü_
;

29 
	g¡d
::
unifÜm_št_di¡ributiÚ
<
ušt64_t
> 
di¡_
;

30 
ušt64_t
 
	gÏ¡_št_
;

33 
šlše
 
ušt64_t
 
	gUnifÜmG’”©Ü
::
Next
() {

34  
Ï¡_št_
 = 
di¡_
(
g’”©Ü_
);

37 
šlše
 
ušt64_t
 
	gUnifÜmG’”©Ü
::
La¡
() {

38  
Ï¡_št_
;

	@core/utils.h

9 #iâdeà
YCSB_C_UTILS_H_


10 
	#YCSB_C_UTILS_H_


	)

12 
	~<®gÜ™hm
>

13 
	~<c¡dšt
>

14 
	~<exû±iÚ
>

15 
	~<¿ndom
>

17 
Çme¥aû
 
	gycsbc
 {

19 
Çme¥aû
 
	guts
 {

21 cÚ¡ 
ušt64_t
 
	gkFNVOff£tBasis64
 = 0xCBF29CE484222325ull;

22 cÚ¡ 
ušt64_t
 
	gkFNVPrime64
 = 1099511628211ull;

24 
šlše
 
ušt64_t
 
FNVHash64
(ušt64_ˆ
v®
) {

25 
ušt64_t
 
	ghash
 = 
kFNVOff£tBasis64
;

27 
	gi
 = 0; i < 8; i++) {

28 
ušt64_t
 
	goù‘
 = 
v®
 & 0x00ff;

29 
	gv®
 = 
v®
 >> 8;

31 
	ghash
 = 
hash
 ^ 
où‘
;

32 
	ghash
 = 
hash
 * 
kFNVPrime64
;

34  
	ghash
;

37 
šlše
 
ušt64_t
 
Hash
(ušt64_ˆ
v®
è{  
FNVHash64
(val); }

39 
šlše
 
ušt32_t
 
Th»adLoÿlRªdomIÁ
() {

40 
th»ad_loÿl
 
	g¡d
::
¿ndom_deviû
 
rd
;

41 
th»ad_loÿl
 
	g¡d
::
mš¡d_¿nd
 
º
(
rd
());

42  
º
();

45 
šlše
 
Th»adLoÿlRªdomDoubË
(
mš
 = 0.0, 
max
 = 1.0) {

46 
th»ad_loÿl
 
¡d
::
¿ndom_deviû
 
rd
;

47 
th»ad_loÿl
 
	g¡d
::
mš¡d_¿nd
 
º
(
rd
());

48 
th»ad_loÿl
 
	g¡d
::
unifÜm_»®_di¡ributiÚ
<> 
unifÜm
(
mš
, 
max
);

49  
unifÜm
(
º
);

55 
šlše
 
RªdomPrštCh¬
() {

56  
¿nd
() % 94 + 33;

59 şas 
	cExû±iÚ
 : 
public
 
¡d
::
exû±iÚ
 {

60 
public
:

61 
Exû±iÚ
(cÚ¡ 
¡d
::
¡ršg
 &
mes§ge
è: 
mes§ge_
(message) { }

62 cÚ¡ * 
wh©
(ècÚ¡ 
nÛxû±
 {

63  
mes§ge_
.
c_¡r
();

65 
	g´iv©e
:

66 
¡d
::
¡ršg
 
mes§ge_
;

69 
šlše
 
boŞ
 
SŒToBoŞ
(
¡d
::
¡ršg
 
¡r
) {

70 
¡d
::
ŒªsfÜm
(
¡r
.
begš
(), sŒ.
’d
(), sŒ.begš(), ::
tŞow”
);

71 ià(
	g¡r
 =ğ"Œue" || 
¡r
 == "1") {

72  
Œue
;

73 } ià(
	g¡r
 =ğ"çl£" || 
¡r
 == "0") {

74  
çl£
;

76 
throw
 
Exû±iÚ
("Inv®id boŞ sŒšg: " + 
¡r
);

80 
šlše
 
	g¡d
::
¡ršg
 
Trim
(cÚ¡ 
¡d
::¡ršg &
¡r
) {

81 autØ
äÚt
 = 
¡d
::
fšd_if_nÙ
(
¡r
.
begš
(), sŒ.
’d
(), [](
c
){  std::
is¥aû
(c); });

82  
	g¡d
::
¡ršg
(
äÚt
, 
¡d
::
fšd_if_nÙ
(
¡r
.
rbegš
(), std::¡ršg::
cÚ¡_»v”£_™”©Ü
(front),

83 [](
c
){  
¡d
::
is¥aû
(c); }).
ba£
());

	@core/ycsbc.cc

9 
	~<c¡ršg
>

10 
	~<ùime
>

12 
	~<¡ršg
>

13 
	~<io¡»am
>

14 
	~<veùÜ
>

15 
	~<th»ad
>

16 
	~<futu»
>

17 
	~<chrÚo
>

18 
	~<iomª
>

20 
	~"uts.h
"

21 
	~"tim”.h
"

22 
	~"ş›Á.h
"

23 
	~"m—su»m’ts.h
"

24 
	~"cÜe_wÜklßd.h
"

25 
	~"couÁdown_Ïtch.h
"

26 
	~"db_çùÜy.h
"

28 
U§geMes§ge
(cÚ¡ *
commªd
);

29 
boŞ
 
SŒS¹W™h
(cÚ¡ *
¡r
, cÚ¡ *
´e
);

30 
P¬£CommªdLše
(
¬gc
, cÚ¡ *
¬gv
[], 
ycsbc
::
uts
::
Prİ”t›s
 &
´İs
);

32 
	$StusTh»ad
(
ycsbc
::
M—su»m’ts
 *
m—su»m’ts
, 
CouÁDownL©ch
 *
Ïtch
, 
š‹rv®
) {

33 
usšg
 
Çme¥aû
 
¡d
::
chrÚo
;

34 
time_pošt
<
sy¡em_şock
> 
¡¬t
 = sy¡em_şock::
	`now
();

35 
boŞ
 
dÚe
 = 
çl£
;

37 
time_pošt
<
sy¡em_şock
> 
now
 = sy¡em_şock::
	`now
();

38 
¡d
::
time_t
 
now_c
 = 
sy¡em_şock
::
	`to_time_t
(
now
);

39 
du¿tiÚ
<> 
–­£d_time
 = 
now
 - 
¡¬t
;

41 
¡d
::
cout
 << std::
	`put_time
(¡d::
	`loÿÉime
(&
now_c
), "%F %T") << ' '

42 << 
¡©ic_ÿ¡
<>(
–­£d_time
.
	`couÁ
()) << " sec: ";

44 
¡d
::
cout
 << 
m—su»m’ts
->
	`G‘StusMsg
(è<< std::
’dl
;

46 ià(
dÚe
) {

49 
dÚe
 = 
Ïtch
->
	`Awa™FÜ
(
š‹rv®
);

51 
	}
}

53 
	$maš
(cÚ¡ 
¬gc
, cÚ¡ *
¬gv
[]) {

54 
ycsbc
::
uts
::
Prİ”t›s
 
´İs
;

55 
	`P¬£CommªdLše
(
¬gc
, 
¬gv
, 
´İs
);

57 cÚ¡ 
boŞ
 
do_lßd
 = (
´İs
.
	`G‘Prİ”ty
("doload", "false") == "true");

58 cÚ¡ 
boŞ
 
´št_key_¡©
 = (
´İs
.
	`G‘Prİ”ty
("printkeystat", "false") == "true");

59 cÚ¡ 
boŞ
 
do_Œª§ùiÚ
 = (
´İs
.
	`G‘Prİ”ty
("dotransaction", "false") == "true");

60 ià(!
do_lßd
 && !
do_Œª§ùiÚ
) {

61 
¡d
::
û¼
 << "NØİ”©iÚØdo" << std::
’dl
;

62 
	`ex™
(1);

65 cÚ¡ 
num_th»ads
 = 
	`¡oi
(
´İs
.
	`G‘Prİ”ty
("threadcount", "1"));

67 
ycsbc
::
M—su»m’ts
 
m—su»m’ts
;

68 
¡d
::
veùÜ
<
ycsbc
::
DB
 *> 
dbs
;

69 
i
 = 0; i < 
num_th»ads
; i++) {

70 
ycsbc
::
DB
 *
db
 = ycsbc::
DBFaùÜy
::
	`C»©eDB
(&
´İs
, &
m—su»m’ts
);

71 ià(
db
 =ğ
nuÎ±r
) {

72 
¡d
::
û¼
 << "UnknowÀd©aba£‚am" << 
´İs
["dbÇme"] << std::
’dl
;

73 
	`ex™
(1);

75 
dbs
.
	`push_back
(
db
);

78 
ycsbc
::
CÜeWÜklßd
 
wl
;

79 
wl
.
	`In™
(
´İs
);

81 cÚ¡ 
boŞ
 
show_¡©us
 = (
´İs
.
	`G‘Prİ”ty
("status", "false") == "true");

82 cÚ¡ 
¡©us_š‹rv®
 = 
¡d
::
	`¡oi
(
´İs
.
	`G‘Prİ”ty
("status.interval", "10"));

85 ià(
do_lßd
) {

86 cÚ¡ 
tÙ®_İs
 = 
	`¡oi
(
´İs
[
ycsbc
::
CÜeWÜklßd
::
RECORD_COUNT_PROPERTY
]);

88 
CouÁDownL©ch
 
	`Ïtch
(
num_th»ads
);

89 
ycsbc
::
uts
::
Tim”
<> 
tim”
;

91 
tim”
.
	`S¹
();

92 
¡d
::
futu»
<> 
¡©us_futu»
;

93 ià(
show_¡©us
) {

94 
¡©us_futu»
 = 
¡d
::
	`async
(¡d::
Ïunch
::
async
, 
StusTh»ad
,

95 &
m—su»m’ts
, &
Ïtch
, 
¡©us_š‹rv®
);

97 
¡d
::
veùÜ
<¡d::
futu»
<>> 
ş›Á_th»ads
;

98 
i
 = 0; i < 
num_th»ads
; ++i) {

99 
th»ad_İs
 = 
tÙ®_İs
 / 
num_th»ads
;

100 ià(
i
 < 
tÙ®_İs
 % 
num_th»ads
) {

101 
th»ad_İs
++;

103 
ş›Á_th»ads
.
	`em¶aû_back
(
¡d
::
	`async
(¡d::
Ïunch
::
async
, 
ycsbc
::
Cl›ÁTh»ad
, 
dbs
[
i
], &
wl
,

104 
th»ad_İs
, 
Œue
,rue, 
´št_key_¡©
, !
do_Œª§ùiÚ
, &
Ïtch
));

106 
	`as£¹
(()
ş›Á_th»ads
.
	`size
(è=ğ
num_th»ads
);

108 
sum
 = 0;

109 autØ&
n
 : 
ş›Á_th»ads
) {

110 
	`as£¹
(
n
.
	`v®id
());

111 
sum
 +ğ
n
.
	`g‘
();

113 
ruÁime
 = 
tim”
.
	`End
();

115 ià(
show_¡©us
) {

116 
¡©us_futu»
.
	`wa™
();

119 
¡d
::
cout
 << "Lßd„uÁime(£c): " << 
ruÁime
 << std::
’dl
;

120 
¡d
::
cout
 << "Lßd o³¿tiÚs(İs): " << 
sum
 << std::
’dl
;

121 
¡d
::
cout
 << "Lßdhroughput(İs/£c): " << 
sum
 / 
ruÁime
 << std::
’dl
;

124 
m—su»m’ts
.
	`Re£t
();

125 
¡d
::
this_th»ad
::
	`¦“p_fÜ
(¡d::
chrÚo
::
	`£cÚds
(
	`¡oi
(
´İs
.
	`G‘Prİ”ty
("sleepafterload", "0"))));

128 ià(
do_Œª§ùiÚ
) {

129 cÚ¡ 
tÙ®_İs
 = 
	`¡oi
(
´İs
[
ycsbc
::
CÜeWÜklßd
::
OPERATION_COUNT_PROPERTY
]);

131 
CouÁDownL©ch
 
	`Ïtch
(
num_th»ads
);

132 
ycsbc
::
uts
::
Tim”
<> 
tim”
;

134 
tim”
.
	`S¹
();

135 
¡d
::
futu»
<> 
¡©us_futu»
;

136 ià(
show_¡©us
) {

137 
¡©us_futu»
 = 
¡d
::
	`async
(¡d::
Ïunch
::
async
, 
StusTh»ad
,

138 &
m—su»m’ts
, &
Ïtch
, 
¡©us_š‹rv®
);

140 
¡d
::
veùÜ
<¡d::
futu»
<>> 
ş›Á_th»ads
;

141 
i
 = 0; i < 
num_th»ads
; ++i) {

142 
th»ad_İs
 = 
tÙ®_İs
 / 
num_th»ads
;

143 ià(
i
 < 
tÙ®_İs
 % 
num_th»ads
) {

144 
th»ad_İs
++;

146 
ş›Á_th»ads
.
	`em¶aû_back
(
¡d
::
	`async
(¡d::
Ïunch
::
async
, 
ycsbc
::
Cl›ÁTh»ad
, 
dbs
[
i
], &
wl
,

147 
th»ad_İs
, 
çl£
, !
do_lßd
, 
´št_key_¡©
, 
Œue
, &
Ïtch
));

149 
	`as£¹
(()
ş›Á_th»ads
.
	`size
(è=ğ
num_th»ads
);

151 
sum
 = 0;

152 autØ&
n
 : 
ş›Á_th»ads
) {

153 
	`as£¹
(
n
.
	`v®id
());

154 
sum
 +ğ
n
.
	`g‘
();

156 
ruÁime
 = 
tim”
.
	`End
();

158 ià(
show_¡©us
) {

159 
¡©us_futu»
.
	`wa™
();

162 
¡d
::
cout
 << "RuÀruÁime(£c): " << 
ruÁime
 << std::
’dl
;

163 
¡d
::
cout
 << "RuÀİ”©iÚs(İs): " << 
sum
 << std::
’dl
;

164 
¡d
::
cout
 << "RuÀthroughput(İs/£c): " << 
sum
 / 
ruÁime
 << std::
’dl
;

167 
i
 = 0; i < 
num_th»ads
; i++) {

168 
d–‘e
 
dbs
[
i
];

170 
	}
}

172 
	$P¬£CommªdLše
(
¬gc
, cÚ¡ *
¬gv
[], 
ycsbc
::
uts
::
Prİ”t›s
 &
´İs
) {

173 
¬gšdex
 = 1;

174 
¬gšdex
 < 
¬gc
 && 
	`SŒS¹W™h
(
¬gv
[argindex], "-")) {

175 ià(
	`¡rcmp
(
¬gv
[
¬gšdex
], "-load") == 0) {

176 
´İs
.
	`S‘Prİ”ty
("doload", "true");

177 
¬gšdex
++;

178 } ià(
	`¡rcmp
(
¬gv
[
¬gšdex
], "-run") == 0 || strcmp(argv[argindex], "-t") == 0) {

179 
´İs
.
	`S‘Prİ”ty
("dotransaction", "true");

180 
¬gšdex
++;

181 } ià(
	`¡rcmp
(
¬gv
[
¬gšdex
], "-print_key_stat") == 0) {

182 
´İs
.
	`S‘Prİ”ty
("printkeystat", "true");

183 
¬gšdex
++;

185 ià(
	`¡rcmp
(
¬gv
[
¬gšdex
], "-threads") == 0) {

186 
¬gšdex
++;

187 ià(
¬gšdex
 >ğ
¬gc
) {

188 
	`U§geMes§ge
(
¬gv
[0]);

189 
¡d
::
û¼
 << "Missšg‡rgum’ˆv®ufÜ -th»ads" << std::
’dl
;

190 
	`ex™
(0);

192 
´İs
.
	`S‘Prİ”ty
("th»adcouÁ", 
¬gv
[
¬gšdex
]);

193 
¬gšdex
++;

194 } ià(
	`¡rcmp
(
¬gv
[
¬gšdex
], "-db") == 0) {

195 
¬gšdex
++;

196 ià(
¬gšdex
 >ğ
¬gc
) {

197 
	`U§geMes§ge
(
¬gv
[0]);

198 
¡d
::
û¼
 << "Missšg‡rgum’ˆv®ufÜ -db" << std::
’dl
;

199 
	`ex™
(0);

201 
´İs
.
	`S‘Prİ”ty
("dbÇme", 
¬gv
[
¬gšdex
]);

202 
¬gšdex
++;

203 } ià(
	`¡rcmp
(
¬gv
[
¬gšdex
], "-P") == 0) {

204 
¬gšdex
++;

205 ià(
¬gšdex
 >ğ
¬gc
) {

206 
	`U§geMes§ge
(
¬gv
[0]);

207 
¡d
::
û¼
 << "Missšg‡rgum’ˆv®ufÜ -P" << std::
’dl
;

208 
	`ex™
(0);

210 
¡d
::
¡ršg
 
	`f’ame
(
¬gv
[
¬gšdex
]);

211 
¡d
::
if¡»am
 
	`šput
(
¬gv
[
¬gšdex
]);

212 
Œy
 {

213 
´İs
.
	`Lßd
(
šput
);

214 } 
	`ÿtch
 (cÚ¡ 
¡d
::
¡ršg
 &
mes§ge
) {

215 
¡d
::
û¼
 << 
mes§ge
 << std::
’dl
;

216 
	`ex™
(0);

218 
šput
.
	`şo£
();

219 
¬gšdex
++;

220 } ià(
	`¡rcmp
(
¬gv
[
¬gšdex
], "-p") == 0) {

221 
¬gšdex
++;

222 ià(
¬gšdex
 >ğ
¬gc
) {

223 
	`U§geMes§ge
(
¬gv
[0]);

224 
¡d
::
û¼
 << "Missšg‡rgum’ˆv®ufÜ -p" << std::
’dl
;

225 
	`ex™
(0);

227 
¡d
::
¡ršg
 
	`´İ
(
¬gv
[
¬gšdex
]);

228 
size_t
 
eq
 = 
´İ
.
	`fšd
('=');

229 ià(
eq
 =ğ
¡d
::
¡ršg
::
Åos
) {

230 
¡d
::
û¼
 << "Argument '-p'ƒxpectedo be in key=value format "

231 "Ó.g., -°İ”©iÚcouÁ=99999)" << 
¡d
::
’dl
;

232 
	`ex™
(0);

234 
´İs
.
	`S‘Prİ”ty
(
ycsbc
::
uts
::
	`Trim
(
´İ
.
	`sub¡r
(0, 
eq
)),

235 
ycsbc
::
uts
::
	`Trim
(
´İ
.
	`sub¡r
(
eq
 + 1)));

236 
¬gšdex
++;

237 } ià(
	`¡rcmp
(
¬gv
[
¬gšdex
], "-s") == 0) {

238 
´İs
.
	`S‘Prİ”ty
("status", "true");

239 
¬gšdex
++;

241 
	`U§geMes§ge
(
¬gv
[0]);

242 
¡d
::
û¼
 << "UnknowÀİtiÚ '" << 
¬gv
[
¬gšdex
] << "'" << std::
’dl
;

243 
	`ex™
(0);

247 ià(
¬gšdex
 =ğ1 ||‡rgšdex !ğ
¬gc
) {

248 
	`U§geMes§ge
(
¬gv
[0]);

249 
	`ex™
(0);

251 
	}
}

253 
	$U§geMes§ge
(cÚ¡ *
commªd
) {

254 
¡d
::
cout
 <<

255 "U§ge: " << 
commªd
 << " [options]\n"

268 << 
¡d
::
’dl
;

269 
	}
}

271 
šlše
 
boŞ
 
	$SŒS¹W™h
(cÚ¡ *
¡r
, cÚ¡ *
´e
) {

272  
	`¡ºcmp
(
¡r
, 
´e
, 
	`¡¾’
(pre)) == 0;

273 
	}
}

	@core/zipfian_comp_generator.h

9 #iâdeà
YCSB_C_ZIPFIAN_COMP_GENERATOR_H_


10 
	#YCSB_C_ZIPFIAN_COMP_GENERATOR_H_


	)

12 
	~"g’”©Ü.h
"

14 
	~<©omic
>

15 
	~<¿ndom
>

16 
	~<c¡dšt
>

17 
	~"uts.h
"

18 
	~"zfŸn_g’”©Ü.h
"

19 
	~"couÁ”_g’”©Ü.h
"

21 
Çme¥aû
 
	gycsbc
 {

23 
şass
 
	gZfŸnCompG’”©Ü
 : 
public
 
G’”©Ü
<
ušt64_t
> {

24 
public
:

25 
ZfŸnCompG’”©Ü
(
ušt64_t
 
mš
, ušt64_ˆ
max
, 
zfŸn_cÚ¡
) :

26 
ba£_
(
mš
), 
num_™ems_
(
max
 - mš + 1), 
g’”©Ü_
(0, 10000000000LL, 
zfŸn_cÚ¡
), 
di¡_
(0, 
unifÜm_b™_
) { }

28 
ZfŸnCompG’”©Ü
(
ušt64_t
 
mš
, ušt64_ˆ
max
) :

29 
ba£_
(
mš
), 
num_™ems_
(
max
 - min + 1),

30 
g’”©Ü_
(0, 10000000000LL, 
ZfŸnG’”©Ü
::
kZfŸnCÚ¡
, 
kZ‘ª
), 
di¡_
(0, 
unifÜm_b™_
) { }

32 
ZfŸnCompG’”©Ü
(
ušt64_t
 
num_™ems
) :

33 
ZfŸnCompG’”©Ü
(0, 
num_™ems
 - 1) { }

35 
ušt64_t
 
Next
();

36 
ušt64_t
 
La¡
();

38 
	g´iv©e
:

39 
cÚ¡ex´
 
kZ‘ª
 = 26.46902820178302;

40 cÚ¡ 
ušt64_t
 
	gba£_
;

41 cÚ¡ 
ušt64_t
 
	gnum_™ems_
;

42 cÚ¡ 
ušt64_t
 
	gzf_b™_
 = 1<<14;

43 cÚ¡ 
ušt64_t
 
	gunifÜm_b™_
 = 1<<18;

44 
ZfŸnG’”©Ü
 
	gg’”©Ü_
;

45 
	g¡d
::
mt19937_64
 
mt_
;

46 
	g¡d
::
unifÜm_št_di¡ributiÚ
<
ušt64_t
> 
di¡_
;

47 
ušt64_t
 
	gÏ¡_št_
;

49 
ušt64_t
 
SüambË
(ušt64_ˆ
u_v®ue
, ušt64_ˆ
z_v®ue
) const;

52 
šlše
 
ušt64_t
 
	gZfŸnCompG’”©Ü
::
SüambË
(ušt64_ˆ
u_v®ue
, ušt64_ˆ
z_v®ue
) const {

53  
	gba£_
 + (
	guts
::
FNVHash64
(
z_v®ue
è% 
zf_b™_
 * 
unifÜm_b™_
 + 
u_v®ue
 % unifÜm_b™_è% 
num_™ems_
 ;

56 
šlše
 
ušt64_t
 
	gZfŸnCompG’”©Ü
::
Next
() {

57  
Ï¡_št_
 = 
SüambË
(
di¡_
(
mt_
), 
g’”©Ü_
.
Next
());

60 
šlše
 
ušt64_t
 
	gZfŸnCompG’”©Ü
::
La¡
() {

61  
Ï¡_št_
;

	@core/zipfian_generator.h

9 #iâdeà
YCSB_C_ZIPFIAN_GENERATOR_H_


10 
	#YCSB_C_ZIPFIAN_GENERATOR_H_


	)

12 
	~<ÿs£¹
>

13 
	~<cm©h
>

14 
	~<c¡dšt
>

15 
	~<mu‹x
>

17 
	~"g’”©Ü.h
"

18 
	~"uts.h
"

20 
Çme¥aû
 
	gycsbc
 {

22 
şass
 
	gZfŸnG’”©Ü
 : 
public
 
G’”©Ü
<
ušt64_t
> {

23 
public
:

24 
cÚ¡ex´
 
kZfŸnCÚ¡
 = 0.99;

25 
cÚ¡ex´
 
ušt64_t
 
	gkMaxNumI‹ms
 = (
UINT64_MAX
 >> 24);

27 
ZfŸnG’”©Ü
(
ušt64_t
 
num_™ems
) :

28 
ZfŸnG’”©Ü
(0, 
num_™ems
 - 1) {}

30 
ZfŸnG’”©Ü
(
ušt64_t
 
mš
, ušt64_ˆ
max
, 
zfŸn_cÚ¡
 = 
kZfŸnCÚ¡
) :

31 
ZfŸnG’”©Ü
(
mš
, 
max
, 
zfŸn_cÚ¡
, 
Z‘a
(max - min + 1, zipfian_const)) {}

33 
ZfŸnG’”©Ü
(
ušt64_t
 
mš
, ušt64_ˆ
max
, 
zfŸn_cÚ¡
, 
z‘a_n
) :

34 
™ems_
(
max
 - 
mš
 + 1), 
ba£_
(mš), 
th‘a_
(
zfŸn_cÚ¡
), 
®low_couÁ_deü—£_
(
çl£
) {

35 
as£¹
(
™ems_
 >ğ2 && i‹ms_ < 
kMaxNumI‹ms
);

37 
	gz‘a_2_
 = 
Z‘a
(2, 
th‘a_
);

39 
	g®pha_
 = 1.0 / (1.0 - 
th‘a_
);

40 
	gz‘a_n_
 = 
z‘a_n
;

41 
	gcouÁ_fÜ_z‘a_
 = 
™ems_
;

42 
	g‘a_
 = 
E
();

44 
Next
();

47 
ušt64_t
 
Next
(ušt64_ˆ
num_™ems
);

49 
ušt64_t
 
Next
(è{  Next(
™ems_
); }

51 
ušt64_t
 
La¡
();

53 
	g´iv©e
:

54 
E
() {

55  (1 - 
¡d
::
pow
(2.0 / 
™ems_
, 1 - 
th‘a_
)è/ (1 - 
	gz‘a_2_
 / 
	gz‘a_n_
);

64 
Z‘a
(
ušt64_t
 
Ï¡_num
, ušt64_ˆ
cur_num
, 
th‘a
, 
Ï¡_z‘a
) {

65 
	gz‘a
 = 
Ï¡_z‘a
;

66 
ušt64_t
 
	gi
 = 
Ï¡_num
 + 1; i <ğ
cur_num
; ++i) {

67 
	gz‘a
 +ğ1 / 
¡d
::
pow
(
i
, 
th‘a
);

69  
	gz‘a
;

72 
Z‘a
(
ušt64_t
 
num
, 
th‘a
) {

73  
Z‘a
(0, 
num
, 
th‘a
, 0);

76 
ušt64_t
 
	g™ems_
;

77 
ušt64_t
 
	gba£_
;

80 
	gth‘a_
, 
	gz‘a_n_
, 
	g‘a_
, 
	g®pha_
, 
	gz‘a_2_
;

81 
ušt64_t
 
	gcouÁ_fÜ_z‘a_
;

82 
ušt64_t
 
	gÏ¡_v®ue_
;

83 
	g¡d
::
mu‹x
 
mu‹x_
;

84 
boŞ
 
	g®low_couÁ_deü—£_
;

87 
šlše
 
ušt64_t
 
	gZfŸnG’”©Ü
::
Next
(ušt64_ˆ
num
) {

88 
as£¹
(
num
 >ğ2 &&‚um < 
kMaxNumI‹ms
);

89 ià(
	gnum
 !ğ
couÁ_fÜ_z‘a_
) {

91 
¡d
::
lock_gu¬d
<¡d::
mu‹x
> 
lock
(
mu‹x_
);

92 ià(
	gnum
 > 
	gcouÁ_fÜ_z‘a_
) {

93 
	gz‘a_n_
 = 
Z‘a
(
couÁ_fÜ_z‘a_
, 
num
, 
th‘a_
, 
z‘a_n_
);

94 
	gcouÁ_fÜ_z‘a_
 = 
num
;

95 
	g‘a_
 = 
E
();

96 } ià(
	gnum
 < 
	gcouÁ_fÜ_z‘a_
 && 
	g®low_couÁ_deü—£_
) {

101 
	gu
 = 
uts
::
Th»adLoÿlRªdomDoubË
();

102 
	guz
 = 
u
 * 
z‘a_n_
;

104 ià(
	guz
 < 1.0) {

105  
	gÏ¡_v®ue_
 = 
ba£_
;

108 ià(
	guz
 < 1.0 + 
	g¡d
::
pow
(0.5, 
th‘a_
)) {

109  
	gÏ¡_v®ue_
 = 
ba£_
 + 1;

112  
	gÏ¡_v®ue_
 = 
ba£_
 + 
num
 * 
¡d
::
pow
(
‘a_
 * 
u
 -ƒ_ + 1, 
®pha_
);

115 
šlše
 
ušt64_t
 
	gZfŸnG’”©Ü
::
La¡
() {

116  
Ï¡_v®ue_
;

	@lcfdb/rocksdb_db.cc

8 
	~"rocksdb_db.h
"

11 
	~"cÜe/cÜe_wÜklßd.h
"

12 
	~"cÜe/db_çùÜy.h
"

13 
	~"cÜe/´İ”t›s.h
"

14 
	~"cÜe/uts.h
"

16 
	~<rocksdb/ÿche.h
>

17 
	~<rocksdb/m”ge_İ”©Ü.h
>

18 
	~<rocksdb/¡©us.h
>

19 
	~<rocksdb/ut™›s/İtiÚs_ut.h
>

20 
	~<rocksdb/wr™e_b©ch.h
>

21 
	~<io¡»am
>

28 
	gÇme¥aû
 {

29 cÚ¡ 
	g¡d
::
¡ršg
 
PROP_NAME
 = "rocksdb.dbname";

30 cÚ¡ 
	g¡d
::
¡ršg
 
PROP_NAME_DEFAULT
 = "";

32 cÚ¡ 
	g¡d
::
¡ršg
 
PROP_BLUEFS_ENABLED
 = "bluefs.enabled";

33 cÚ¡ 
	g¡d
::
¡ršg
 
PROP_BLUEFS_ENABLED_DEFAULT
 = "false";

35 cÚ¡ 
	g¡d
::
¡ršg
 
PROP_FORMAT
 = "rocksdb.format";

36 cÚ¡ 
	g¡d
::
¡ršg
 
PROP_FORMAT_DEFAULT
 = "single";

38 cÚ¡ 
	g¡d
::
¡ršg
 
PROP_MERGEUPDATE
 = "rocksdb.mergeupdate";

39 cÚ¡ 
	g¡d
::
¡ršg
 
PROP_MERGEUPDATE_DEFAULT
 = "false";

41 cÚ¡ 
	g¡d
::
¡ršg
 
PROP_DESTROY
 = "rocksdb.destroy";

42 cÚ¡ 
	g¡d
::
¡ršg
 
PROP_DESTROY_DEFAULT
 = "false";

44 cÚ¡ 
	g¡d
::
¡ršg
 
PROP_COMPRESSION
 = "rocksdb.compression";

45 cÚ¡ 
	g¡d
::
¡ršg
 
PROP_COMPRESSION_DEFAULT
 = "no";

47 cÚ¡ 
	g¡d
::
¡ršg
 
PROP_MAX_BG_JOBS
 = "rocksdb.max_background_jobs";

48 cÚ¡ 
	g¡d
::
¡ršg
 
PROP_MAX_BG_JOBS_DEFAULT
 = "0";

50 cÚ¡ 
	g¡d
::
¡ršg
 
PROP_TARGET_FILE_SIZE_BASE
 = "rocksdb.target_file_size_base";

51 cÚ¡ 
	g¡d
::
¡ršg
 
PROP_TARGET_FILE_SIZE_BASE_DEFAULT
 = "0";

53 cÚ¡ 
	g¡d
::
¡ršg
 
PROP_TARGET_FILE_SIZE_MULT
 = "rocksdb.target_file_size_multiplier";

54 cÚ¡ 
	g¡d
::
¡ršg
 
PROP_TARGET_FILE_SIZE_MULT_DEFAULT
 = "0";

56 cÚ¡ 
	g¡d
::
¡ršg
 
PROP_MAX_BYTES_FOR_LEVEL_BASE
 = "rocksdb.max_bytes_for_level_base";

57 cÚ¡ 
	g¡d
::
¡ršg
 
PROP_MAX_BYTES_FOR_LEVEL_BASE_DEFAULT
 = "0";

59 cÚ¡ 
	g¡d
::
¡ršg
 
PROP_WRITE_BUFFER_SIZE
 = "rocksdb.write_buffer_size";

60 cÚ¡ 
	g¡d
::
¡ršg
 
PROP_WRITE_BUFFER_SIZE_DEFAULT
 = "0";

62 cÚ¡ 
	g¡d
::
¡ršg
 
PROP_MAX_WRITE_BUFFER
 = "rocksdb.max_write_buffer_number";

63 cÚ¡ 
	g¡d
::
¡ršg
 
PROP_MAX_WRITE_BUFFER_DEFAULT
 = "0";

65 cÚ¡ 
	g¡d
::
¡ršg
 
PROP_COMPACTION_PRI
 = "rocksdb.compaction_pri";

66 cÚ¡ 
	g¡d
::
¡ršg
 
PROP_COMPACTION_PRI_DEFAULT
 = "-1";

68 cÚ¡ 
	g¡d
::
¡ršg
 
PROP_CACHE_SIZE
 = "rocksdb.cache_size";

69 cÚ¡ 
	g¡d
::
¡ršg
 
PROP_CACHE_SIZE_DEFAULT
 = "0";

71 cÚ¡ 
	g¡d
::
¡ršg
 
PROP_INCREASE_PARALLELISM
 = "rocksdb.increase_parallelism";

72 cÚ¡ 
	g¡d
::
¡ršg
 
PROP_INCREASE_PARALLELISM_DEFAULT
 = "false";

74 cÚ¡ 
	g¡d
::
¡ršg
 
PROP_OPTIMIZE_LEVELCOMP
 = "rocksdb.optimize_level_style_compaction";

75 cÚ¡ 
	g¡d
::
¡ršg
 
PROP_OPTIMIZE_LEVELCOMP_DEFAULT
 = "false";

77 cÚ¡ 
	g¡d
::
¡ršg
 
PROP_OPTIONS_FILE
 = "rocksdb.optionsfile";

78 cÚ¡ 
	g¡d
::
¡ršg
 
PROP_OPTIONS_FILE_DEFAULT
 = "";

80 cÚ¡ 
	g¡d
::
¡ršg
 
PROP_ENV_URI
 = "rocksdb.env_uri";

81 cÚ¡ 
	g¡d
::
¡ršg
 
PROP_ENV_URI_DEFAULT
 = "";

83 cÚ¡ 
	g¡d
::
¡ršg
 
PROP_FS_URI
 = "rocksdb.fs_uri";

84 cÚ¡ 
	g¡d
::
¡ršg
 
PROP_FS_URI_DEFAULT
 = "";

86 
	g¡d
::
sh¬ed_±r
<
rocksdb
::
Env
> 
’v_gu¬d
;

87 
	g¡d
::
sh¬ed_±r
<
rocksdb
::
Cache
> 
block_ÿche
;

90 
Çme¥aû
 
	gycsbc
 {

92 
	grocksdb
::
DB
 *
RocksdbDB
::
db_
 = 
nuÎ±r
;

93 
	gRocksdbDB
::
»f_út_
 = 0;

94 
	g¡d
::
mu‹x
 
RocksdbDB
::
mu_
;

96 
boŞ
 
	gcf_’abËd
 = 
Œue
;

97 
	g¡d
::
unÜd”ed_m­
<
¡d
::
¡ršg
, *> 
	gcf_hªdËs
;

98 
	grocksdb
::
CŞumnFamyHªdË
 *
deçuÉ_cf_hªdË
;

100 
add_cŞumn_çmy
(cÚ¡ 
¡d
::
¡ršg
& 
cf_Çme
, *
hªdË
) {

101 
	gcf_hªdËs
.
š£¹
(
¡d
::
make_·œ
(
cf_Çme
, 
hªdË
));

104 
	grocksdb
::
CŞumnFamyHªdË
 *
g‘_cf_hªdË
(cÚ¡ 
¡d
::
¡ršg
& 
key
) {

105 
¡d
::
¡ršg
 
cf_Çme
(1, 
key
[0]);

107 autØ
	g™”
 = 
cf_hªdËs
.
fšd
(
cf_Çme
);

108 ià(
	g™”
 =ğ
cf_hªdËs
.
’d
())

109  
deçuÉ_cf_hªdË
;

111  
	g¡©ic_ÿ¡
<
	grocksdb
::
CŞumnFamyHªdË
*>(
™”
->
£cÚd
);

114 
	gRocksdbDB
::
In™
() {

116 #ifdeà
USE_MERGEUPDATE


117 şas 
	cYCSBUpd©eM”ge
 : 
public
 
rocksdb
::
AssocŸtiveM”geO³¿tÜ
 {

118 
public
:

119 
vœtu®
 
boŞ
 
M”ge
(cÚ¡ 
rocksdb
::
Sliû
 &
key
, cÚ¡„ocksdb::Sliû *
exi¡šg_v®ue
,

120 cÚ¡ 
rocksdb
::
Sliû
 &
v®ue
, 
¡d
::
¡ršg
 *
Ãw_v®ue
,

121 
rocksdb
::
Logg”
 *
logg”
ècÚ¡ 
ov”ride
 {

122 
as£¹
(
exi¡šg_v®ue
);

124 
	g¡d
::
veùÜ
<
F›ld
> 
v®ues
;

125 cÚ¡ *
	gp
 = 
exi¡šg_v®ue
->
d©a
();

126 cÚ¡ *
	glim
 = 
p
 + 
exi¡šg_v®ue
->
size
();

127 
De£rŸlizeRow
(
v®ues
, 
p
, 
lim
);

129 
	g¡d
::
veùÜ
<
F›ld
> 
Ãw_v®ues
;

130 
	gp
 = 
v®ue
.
d©a
();

131 
	glim
 = 
p
 + 
v®ue
.
size
();

132 
De£rŸlizeRow
(
Ãw_v®ues
, 
p
, 
lim
);

134 
	gF›ld
 &
	gÃw_f›ld
 : 
Ãw_v®ues
) {

135 
boŞ
 
found
 = 
çl£
;

136 
	gF›ld
 &
	gf›ld
 : 
v®ues
) {

137 ià(
f›ld
.
Çme
 =ğ
Ãw_f›ld
.name) {

138 
found
 = 
Œue
;

139 
	gf›ld
.
	gv®ue
 = 
Ãw_f›ld
.
v®ue
;

143 ià(!
	gfound
) {

144 
	gv®ues
.
push_back
(
Ãw_f›ld
);

148 
S”ŸlizeRow
(
v®ues
, *
Ãw_v®ue
);

149  
	gŒue
;

152 
vœtu®
 cÚ¡ *
Name
(ècÚ¡ 
	gov”ride
 {

157 cÚ¡ 
	g¡d
::
lock_gu¬d
<
¡d
::
mu‹x
> 
lock
(
mu_
);

159 cÚ¡ 
	guts
::
Prİ”t›s
 &
´İs
 = *
´İs_
;

160 cÚ¡ 
	g¡d
::
¡ršg
 
fÜm©
 = 
´İs
.
G‘Prİ”ty
(
PROP_FORMAT
, 
PROP_FORMAT_DEFAULT
);

161 ià(
	gfÜm©
 == "single") {

162 
fÜm©_
 = 
kSšgËRow
;

163 
	gm‘hod_»ad_
 = &
RocksdbDB
::
R—dSšgË
;

164 
	gm‘hod_sÿn_
 = &
RocksdbDB
::
SÿnSšgË
;

165 
	gm‘hod_upd©e_
 = &
RocksdbDB
::
Upd©eSšgË
;

166 
	gm‘hod_š£¹_
 = &
RocksdbDB
::
In£¹SšgË
;

167 
	gm‘hod_d–‘e_
 = &
RocksdbDB
::
D–‘eSšgË
;

168 #ifdeà
USE_MERGEUPDATE


169 ià(
	g´İs
.
G‘Prİ”ty
(
PROP_MERGEUPDATE
, 
PROP_MERGEUPDATE_DEFAULT
) == "true") {

170 
m‘hod_upd©e_
 = &
RocksdbDB
::
M”geSšgË
;

174 
throw
 
	guts
::
Exû±iÚ
("unknown format");

176 
	gf›ldcouÁ_
 = 
¡d
::
¡oi
(
´İs
.
G‘Prİ”ty
(
CÜeWÜklßd
::
FIELD_COUNT_PROPERTY
,

177 
CÜeWÜklßd
::
FIELD_COUNT_DEFAULT
));

179 
	g»f_út_
++;

180 ià(
	gdb_
) {

184 cÚ¡ 
	g¡d
::
¡ršg
 &
db_·th
 = 
´İs
.
G‘Prİ”ty
(
PROP_NAME
, 
PROP_NAME_DEFAULT
);

185 ià(
	gdb_·th
 == "") {

186 
throw
 
uts
::
Exû±iÚ
("RocksDB db…ath is missing");

189 
	grocksdb
::
O±iÚs
 
İt
;

190 
	gİt
.
	gü—‹_if_missšg
 = 
Œue
;

191 
	g¡d
::
veùÜ
<
rocksdb
::
CŞumnFamyDesütÜ
> 
cf_descs
;

192 
	g¡d
::
veùÜ
<
rocksdb
::
CŞumnFamyHªdË
 *> 
cf_hªdËs
;

193 
G‘O±iÚs
(
´İs
, &
İt
, &
cf_descs
);

194 #ifdeà
USE_MERGEUPDATE


195 
	gİt
.
	gm”ge_İ”©Ü
.
»£t
(
Ãw
 
YCSBUpd©eM”ge
);

198 
	grocksdb
::
Stus
 
s
;

199 ià(
	g´İs
.
G‘Prİ”ty
(
PROP_DESTROY
, 
PROP_DESTROY_DEFAULT
) == "true") {

200 
s
 = 
rocksdb
::
De¡royDB
(
db_·th
, 
İt
);

201 ià(!
	gs
.
ok
()) {

202 
throw
 
	guts
::
Exû±iÚ
(
¡d
::
¡ršg
("RocksDB De¡royDB: "è+ 
s
.
ToSŒšg
());

205 ià(
	gcf_descs
.
em±y
()) {

206 
	gs
 = 
rocksdb
::
DB
::
O³n
(
İt
, 
db_·th
, &
db_
);

208 
	gs
 = 
rocksdb
::
DB
::
O³n
(
İt
, 
db_·th
, 
cf_descs
, &
cf_hªdËs
, &
db_
);

211 ià(!
	gs
.
ok
()) {

212 
throw
 
	guts
::
Exû±iÚ
(
¡d
::
¡ršg
("RocksDB O³n: "è+ 
s
.
ToSŒšg
());

215 ià(
	gcf_descs
.
size
() == 1) {

217 
¡d
::
veùÜ
<¡d::
¡ršg
> 
cfs
 = {"M","P","L"};

219 auto& 
	gp
 : 
cfs
) {

220 
¡d
::
cout
 << "C»©CŞumÀFamy(" << 
p
 << ")" << std::
’dl
;

221 
	grocksdb
::
CŞumnFamyO±iÚs
 
cf_İt
(
İt
);

222 
	grocksdb
::
CŞumnFamyHªdË
 *
cf
;

224 
	gs
 = 
db_
->
C»©eCŞumnFamy
(
cf_İt
, 
p
, &
cf
);

225 ià(!
	gs
.
ok
()) {

226 
throw
 
	guts
::
Exû±iÚ
(
¡d
::
¡ršg
("RocksDB O³n: "è+ 
s
.
ToSŒšg
());

228 
add_cŞumn_çmy
(
p
, 
cf
);

231 auto& 
	gp
 : 
cf_hªdËs
) {

232 
¡d
::
cout
 << "Lßd CŞumÀFamy(" << 
p
->
G‘Name
(è<< ")" << std::
’dl
;

233 
add_cŞumn_çmy
(
p
->
G‘Name
(),…);

237 
	gdeçuÉ_cf_hªdË
 = 
db_
->
DeçuÉCŞumnFamy
();

238 ià(!
	gdeçuÉ_cf_hªdË
) {

239 
throw
 
	guts
::
Exû±iÚ
(
¡d
::
¡ršg
("RocksDB Open: ") + "No Defautl CF");

243 
	gRocksdbDB
::
	$CËªup
() {

244 cÚ¡ 
¡d
::
lock_gu¬d
<¡d::
mu‹x
> 
	`lock
(
mu_
);

245 ià(--
»f_út_
) {

248 
d–‘e
 
db_
;

249 
	}
}

251 
	gRocksdbDB
::
G‘O±iÚs
(cÚ¡ 
uts
::
Prİ”t›s
 &
´İs
, 
rocksdb
::
O±iÚs
 *
İt
,

252 
¡d
::
veùÜ
<
rocksdb
::
CŞumnFamyDesütÜ
> *
cf_descs
) {

253 
¡d
::
¡ršg
 
’v_uri
 = 
´İs
.
G‘Prİ”ty
(
PROP_ENV_URI
, 
PROP_ENV_URI_DEFAULT
);

254 
	g¡d
::
¡ršg
 
fs_uri
 = 
´İs
.
G‘Prİ”ty
(
PROP_FS_URI
, 
PROP_FS_URI_DEFAULT
);

255 
	grocksdb
::
Env
* 
’v
;

256 
	g’v
 = 
rocksdb
::
Env
::
DeçuÉ
();

258 cÚ¡ 
	g¡d
::
¡ršg
 
db_·th
 = 
´İs
.
G‘Prİ”ty
(
PROP_NAME
, 
PROP_NAME_DEFAULT
);

259 cÚ¡ 
	g¡d
::
¡ršg
 
İtiÚs_fe
 = 
´İs
.
G‘Prİ”ty
(
PROP_OPTIONS_FILE
, 
PROP_OPTIONS_FILE_DEFAULT
);

260 
	g¡d
::
¡ršg
 
Ï‹¡_İtiÚs_fe
;

262 
	grocksdb
::
Stus
 
s
 = 
G‘L©e¡O±iÚsFeName
(
db_·th
, 
’v
, &
Ï‹¡_İtiÚs_fe
);

265 ià(
	gİtiÚs_fe
 != "") {

266 
rocksdb
::
Stus
 
s
 =„ocksdb::
LßdO±iÚsFromFe
(
İtiÚs_fe
, 
’v
, 
İt
, 
cf_descs
);

267 ià(!
	gs
.
ok
()) {

268 
throw
 
	guts
::
Exû±iÚ
(
¡d
::
¡ršg
("RocksDB LßdO±iÚsFromFe: "è+ 
s
.
ToSŒšg
());

272 ià(
	gÏ‹¡_İtiÚs_fe
 != "") {

273 
Ï‹¡_İtiÚs_fe
 = 
db_·th
 + "/" +†atest_options_file;

274 
	grocksdb
::
Stus
 
s
 = 
rocksdb
::
LßdO±iÚsFromFe
(
Ï‹¡_İtiÚs_fe
, 
’v
, 
İt
, 
cf_descs
);

275 ià(!
	gs
.
ok
()) {

276 
throw
 
	guts
::
Exû±iÚ
(
¡d
::
¡ršg
("RocksDB LßdO±iÚsFromFe: "è+ 
s
.
ToSŒšg
());

279 cÚ¡ 
	g¡d
::
¡ršg
 
com´essiÚ_ty³
 = 
´İs
.
G‘Prİ”ty
(
PROP_COMPRESSION
,

280 
PROP_COMPRESSION_DEFAULT
);

281 ià(
	gcom´essiÚ_ty³
 == "no") {

282 
İt
->
com´essiÚ
 = 
rocksdb
::
kNoCom´essiÚ
;

283 } ià(
	gcom´essiÚ_ty³
 == "snappy") {

284 
İt
->
com´essiÚ
 = 
rocksdb
::
kSÇµyCom´essiÚ
;

285 } ià(
	gcom´essiÚ_ty³
 == "zlib") {

286 
İt
->
com´essiÚ
 = 
rocksdb
::
kZlibCom´essiÚ
;

287 } ià(
	gcom´essiÚ_ty³
 == "bzip2") {

288 
İt
->
com´essiÚ
 = 
rocksdb
::
kBZ2Com´essiÚ
;

289 } ià(
	gcom´essiÚ_ty³
 == "lz4") {

290 
İt
->
com´essiÚ
 = 
rocksdb
::
kLZ4Com´essiÚ
;

291 } ià(
	gcom´essiÚ_ty³
 == "lz4hc") {

292 
İt
->
com´essiÚ
 = 
rocksdb
::
kLZ4HCCom´essiÚ
;

293 } ià(
	gcom´essiÚ_ty³
 == "xpress") {

294 
İt
->
com´essiÚ
 = 
rocksdb
::
kX´essCom´essiÚ
;

295 } ià(
	gcom´essiÚ_ty³
 == "zstd") {

296 
İt
->
com´essiÚ
 = 
rocksdb
::
kZSTD
;

298 
throw
 
	guts
::
Exû±iÚ
("Unknown compressionype");

301 
	gv®
 = 
¡d
::
¡oi
(
´İs
.
G‘Prİ”ty
(
PROP_MAX_BG_JOBS
, 
PROP_MAX_BG_JOBS_DEFAULT
));

302 ià(
	gv®
 != 0) {

303 
İt
->
max_background_jobs
 = 
v®
;

305 
	gv®
 = 
¡d
::
¡oi
(
´İs
.
G‘Prİ”ty
(
PROP_TARGET_FILE_SIZE_BASE
, 
PROP_TARGET_FILE_SIZE_BASE_DEFAULT
));

306 ià(
	gv®
 != 0) {

307 
İt
->
rg‘_fe_size_ba£
 = 
v®
;

309 
	gv®
 = 
¡d
::
¡oi
(
´İs
.
G‘Prİ”ty
(
PROP_TARGET_FILE_SIZE_MULT
, 
PROP_TARGET_FILE_SIZE_MULT_DEFAULT
));

310 ià(
	gv®
 != 0) {

311 
İt
->
rg‘_fe_size_muÉl›r
 = 
v®
;

313 
	gv®
 = 
¡d
::
¡oi
(
´İs
.
G‘Prİ”ty
(
PROP_MAX_BYTES_FOR_LEVEL_BASE
, 
PROP_MAX_BYTES_FOR_LEVEL_BASE_DEFAULT
));

314 ià(
	gv®
 != 0) {

315 
İt
->
max_by‹s_fÜ_Ëv–_ba£
 = 
v®
;

317 
	gv®
 = 
¡d
::
¡oi
(
´İs
.
G‘Prİ”ty
(
PROP_WRITE_BUFFER_SIZE
, 
PROP_WRITE_BUFFER_SIZE_DEFAULT
));

318 ià(
	gv®
 != 0) {

319 
İt
->
wr™e_bufãr_size
 = 
v®
;

321 
	gv®
 = 
¡d
::
¡oi
(
´İs
.
G‘Prİ”ty
(
PROP_MAX_WRITE_BUFFER
, 
PROP_MAX_WRITE_BUFFER_DEFAULT
));

322 ià(
	gv®
 != 0) {

323 
İt
->
max_wr™e_bufãr_numb”
 = 
v®
;

325 
	gv®
 = 
¡d
::
¡oi
(
´İs
.
G‘Prİ”ty
(
PROP_COMPACTION_PRI
, 
PROP_COMPACTION_PRI_DEFAULT
));

326 ià(
	gv®
 != -1) {

327 
İt
->
com·ùiÚ_´i
 = 
¡©ic_ÿ¡
<
rocksdb
::
Com·ùiÚPri
>(
v®
);

330 
size_t
 
	gÿche_size
 = 
¡d
::
¡oul
(
´İs
.
G‘Prİ”ty
(
PROP_CACHE_SIZE
, 
PROP_CACHE_SIZE_DEFAULT
));

331 ià(
	gÿche_size
 > 0) {

332 
	gblock_ÿche
 = 
rocksdb
::
NewLRUCache
(
ÿche_size
);

333 
	grocksdb
::
BlockBa£dTabËO±iÚs
 
bË_İtiÚs
;

334 
	gbË_İtiÚs
.
	gblock_ÿche
 = 
block_ÿche
;

335 
	gİt
->
	gbË_çùÜy
.
»£t
(
rocksdb
::
NewBlockBa£dTabËFaùÜy
(
bË_İtiÚs
));

338 ià(
	g´İs
.
G‘Prİ”ty
(
PROP_INCREASE_PARALLELISM
, 
PROP_INCREASE_PARALLELISM_DEFAULT
) == "true") {

339 
İt
->
Inü—£P¬®Ëlism
();

341 ià(
	g´İs
.
G‘Prİ”ty
(
PROP_OPTIMIZE_LEVELCOMP
, 
PROP_OPTIMIZE_LEVELCOMP_DEFAULT
) == "true") {

342 
İt
->
O±imizeLev–StyËCom·ùiÚ
();

347 
	gRocksdbDB
::
S”ŸlizeRow
(cÚ¡ 
¡d
::
veùÜ
<
F›ld
> &
v®ues
, std::
¡ršg
 &
d©a
) {

348 cÚ¡ 
F›ld
 &
f›ld
 : 
v®ues
) {

349 
ušt32_t
 
Ën
 = 
f›ld
.
Çme
.
size
();

350 
	gd©a
.
­³nd
(
»š‹½»t_ÿ¡
<*>(&
Ën
), (
ušt32_t
));

351 
	gd©a
.
­³nd
(
f›ld
.
Çme
.
d©a
(), f›ld.Çme.
size
());

352 
	gËn
 = 
f›ld
.
v®ue
.
size
();

353 
	gd©a
.
­³nd
(
»š‹½»t_ÿ¡
<*>(&
Ën
), (
ušt32_t
));

354 
	gd©a
.
­³nd
(
f›ld
.
v®ue
.
d©a
(), f›ld.v®ue.
size
());

358 
	gRocksdbDB
::
De£rŸlizeRowF‹r
(
¡d
::
veùÜ
<
F›ld
> &
v®ues
, cÚ¡ *
p
, cÚ¡ *
lim
,

359 cÚ¡ 
¡d
::
veùÜ
<¡d::
¡ršg
> &
f›lds
) {

360 
¡d
::
veùÜ
<¡d::
¡ršg
>::
cÚ¡_™”©Ü
 
f‹r_™”
 = 
f›lds
.
begš
();

361 
	gp
 !ğ
lim
 && 
f‹r_™”
 !ğ
f›lds
.
’d
()) {

362 
as£¹
(
p
 < 
lim
);

363 
ušt32_t
 
	gËn
 = *
»š‹½»t_ÿ¡
<cÚ¡ ušt32_ˆ*>(
p
);

364 
	gp
 +ğ(
ušt32_t
);

365 
	g¡d
::
¡ršg
 
f›ld
(
p
, 
¡©ic_ÿ¡
<cÚ¡ 
size_t
>(
Ën
));

366 
	gp
 +ğ
Ën
;

367 
	gËn
 = *
»š‹½»t_ÿ¡
<cÚ¡ 
ušt32_t
 *>(
p
);

368 
	gp
 +ğ(
ušt32_t
);

369 
	g¡d
::
¡ršg
 
v®ue
(
p
, 
¡©ic_ÿ¡
<cÚ¡ 
size_t
>(
Ën
));

370 
	gp
 +ğ
Ën
;

371 ià(*
	gf‹r_™”
 =ğ
f›ld
) {

372 
v®ues
.
push_back
({
f›ld
, 
v®ue
});

373 
	gf‹r_™”
++;

376 
as£¹
(
v®ues
.
size
(è=ğ
f›lds
.size());

379 
	gRocksdbDB
::
De£rŸlizeRowF‹r
(
¡d
::
veùÜ
<
F›ld
> &
v®ues
, cÚ¡ std::
¡ršg
 &
d©a
,

380 cÚ¡ 
¡d
::
veùÜ
<¡d::
¡ršg
> &
f›lds
) {

381 cÚ¡ *
p
 = 
d©a
.data();

382 cÚ¡ *
	glim
 = 
p
 + 
d©a
.
size
();

383 
De£rŸlizeRowF‹r
(
v®ues
, 
p
, 
lim
, 
f›lds
);

386 
	gRocksdbDB
::
De£rŸlizeRow
(
¡d
::
veùÜ
<
F›ld
> &
v®ues
, cÚ¡ *
p
, cÚ¡ *
lim
) {

387 
	gp
 !ğ
lim
) {

388 
as£¹
(
p
 < 
lim
);

389 
ušt32_t
 
	gËn
 = *
»š‹½»t_ÿ¡
<cÚ¡ ušt32_ˆ*>(
p
);

390 
	gp
 +ğ(
ušt32_t
);

391 
	g¡d
::
¡ršg
 
f›ld
(
p
, 
¡©ic_ÿ¡
<cÚ¡ 
size_t
>(
Ën
));

392 
	gp
 +ğ
Ën
;

393 
	gËn
 = *
»š‹½»t_ÿ¡
<cÚ¡ 
ušt32_t
 *>(
p
);

394 
	gp
 +ğ(
ušt32_t
);

395 
	g¡d
::
¡ršg
 
v®ue
(
p
, 
¡©ic_ÿ¡
<cÚ¡ 
size_t
>(
Ën
));

396 
	gp
 +ğ
Ën
;

397 
	gv®ues
.
push_back
({
f›ld
, 
v®ue
});

401 
	gRocksdbDB
::
De£rŸlizeRow
(
¡d
::
veùÜ
<
F›ld
> &
v®ues
, cÚ¡ std::
¡ršg
 &
d©a
) {

402 cÚ¡ *
p
 = 
d©a
.data();

403 cÚ¡ *
	glim
 = 
p
 + 
d©a
.
size
();

404 
De£rŸlizeRow
(
v®ues
, 
p
, 
lim
);

407 
	gDB
::
Stus
 
RocksdbDB
::
R—dSšgË
(cÚ¡ 
¡d
::
¡ršg
 &
bË
, cÚ¡ std::¡ršg &
key
,

408 cÚ¡ 
¡d
::
veùÜ
<¡d::
¡ršg
> *
f›lds
,

409 
¡d
::
veùÜ
<
F›ld
> &
»suÉ
) {

410 
¡d
::
¡ršg
 
d©a
;

411 autØ
	gcf
 = 
g‘_cf_hªdË
(
key
);

412 
	grocksdb
::
Stus
 
s
 = 
db_
->
G‘
(
rocksdb
::
R—dO±iÚs
(), 
cf
, 
key
, &
d©a
);

413 ià(
	gs
.
IsNÙFound
()) {

414  
	gkNÙFound
;

415 } ià(!
	gs
.
ok
()) {

416 
throw
 
	guts
::
Exû±iÚ
(
¡d
::
¡ršg
("RocksDB G‘: "è+ 
s
.
ToSŒšg
());

418 ià(
	gf›lds
 !ğ
nuÎ±r
) {

419 
De£rŸlizeRowF‹r
(
»suÉ
, 
d©a
, *
f›lds
);

421 
De£rŸlizeRow
(
»suÉ
, 
d©a
);

422 
as£¹
(
»suÉ
.
size
(è=ğ
¡©ic_ÿ¡
<
size_t
>(
f›ldcouÁ_
));

424  
	gkOK
;

427 
	gDB
::
Stus
 
RocksdbDB
::
SÿnSšgË
(cÚ¡ 
¡d
::
¡ršg
 &
bË
, cÚ¡ std::¡ršg &
key
, 
Ën
,

428 cÚ¡ 
¡d
::
veùÜ
<¡d::
¡ršg
> *
f›lds
,

429 
¡d
::
veùÜ
<¡d::veùÜ<
F›ld
>> &
»suÉ
) {

430 autØ
cf
 = 
g‘_cf_hªdË
(
key
);

431 
	grocksdb
::
I‹¿tÜ
 *
db_™”
 = 
db_
->
NewI‹¿tÜ
(
rocksdb
::
R—dO±iÚs
(),
cf
);

432 
	gdb_™”
->
S“k
(
key
);

433 
	gi
 = 0; 
	gdb_™”
->
V®id
(è&& i < 
	gËn
; i++) {

434 
	g¡d
::
¡ršg
 
d©a
 = 
db_™”
->
v®ue
().
ToSŒšg
();

435 
	g»suÉ
.
push_back
(
¡d
::
veùÜ
<
F›ld
>());

436 
	g¡d
::
veùÜ
<
F›ld
> &
v®ues
 = 
»suÉ
.
back
();

437 ià(
	gf›lds
 !ğ
nuÎ±r
) {

438 
De£rŸlizeRowF‹r
(
v®ues
, 
d©a
, *
f›lds
);

440 
De£rŸlizeRow
(
v®ues
, 
d©a
);

441 
as£¹
(
v®ues
.
size
(è=ğ
¡©ic_ÿ¡
<
size_t
>(
f›ldcouÁ_
));

443 
	gdb_™”
->
Next
();

445 
d–‘e
 
	gdb_™”
;

446  
	gkOK
;

449 
	gDB
::
Stus
 
RocksdbDB
::
Upd©eSšgË
(cÚ¡ 
¡d
::
¡ršg
 &
bË
, cÚ¡ std::¡ršg &
key
,

450 
¡d
::
veùÜ
<
F›ld
> &
v®ues
) {

451 
¡d
::
¡ršg
 
d©a
;

452 autØ
	gcf
 = 
g‘_cf_hªdË
(
key
);

453 
	grocksdb
::
Stus
 
s
 = 
db_
->
G‘
(
rocksdb
::
R—dO±iÚs
(), 
cf
, 
key
, &
d©a
);

454 ià(
	gs
.
IsNÙFound
()) {

455  
	gkNÙFound
;

456 } ià(!
	gs
.
ok
()) {

457 
throw
 
	guts
::
Exû±iÚ
(
¡d
::
¡ršg
("RocksDB G‘: "è+ 
s
.
ToSŒšg
());

459 
	g¡d
::
veùÜ
<
F›ld
> 
cu¼’t_v®ues
;

460 
De£rŸlizeRow
(
cu¼’t_v®ues
, 
d©a
);

461 
as£¹
(
cu¼’t_v®ues
.
size
(è=ğ
¡©ic_ÿ¡
<
size_t
>(
f›ldcouÁ_
));

462 
	gF›ld
 &
	gÃw_f›ld
 : 
v®ues
) {

463 
boŞ
 
found
 
__©Œibu‹__
((
unu£d
)èğ
çl£
;

464 
	gF›ld
 &
	gcur_f›ld
 : 
cu¼’t_v®ues
) {

465 ià(
cur_f›ld
.
Çme
 =ğ
Ãw_f›ld
.name) {

466 
found
 = 
Œue
;

467 
	gcur_f›ld
.
	gv®ue
 = 
Ãw_f›ld
.
v®ue
;

471 
as£¹
(
found
);

473 
	grocksdb
::
Wr™eO±iÚs
 
wİt
;

475 
	gd©a
.
ş—r
();

476 
S”ŸlizeRow
(
cu¼’t_v®ues
, 
d©a
);

477 
	gs
 = 
db_
->
Put
(
wİt
, 
cf
, 
key
, 
d©a
);

478 ià(!
	gs
.
ok
()) {

479 
throw
 
	guts
::
Exû±iÚ
(
¡d
::
¡ršg
("RocksDB Put: "è+ 
s
.
ToSŒšg
());

481  
	gkOK
;

484 
	gDB
::
Stus
 
RocksdbDB
::
M”geSšgË
(cÚ¡ 
¡d
::
¡ršg
 &
bË
, cÚ¡ std::¡ršg &
key
,

485 
¡d
::
veùÜ
<
F›ld
> &
v®ues
) {

486 
¡d
::
¡ršg
 
d©a
;

487 
S”ŸlizeRow
(
v®ues
, 
d©a
);

488 
	grocksdb
::
Wr™eO±iÚs
 
wİt
;

489 autØ
	gcf
 = 
g‘_cf_hªdË
(
key
);

490 
	grocksdb
::
Stus
 
s
 = 
db_
->
M”ge
(
wİt
, 
cf
, 
key
, 
d©a
);

491 ià(!
	gs
.
ok
()) {

492 
throw
 
	guts
::
Exû±iÚ
(
¡d
::
¡ršg
("RocksDB M”ge: "è+ 
s
.
ToSŒšg
());

494  
	gkOK
;

497 
	gDB
::
Stus
 
RocksdbDB
::
In£¹SšgË
(cÚ¡ 
¡d
::
¡ršg
 &
bË
, cÚ¡ std::¡ršg &
key
,

498 
¡d
::
veùÜ
<
F›ld
> &
v®ues
) {

499 
¡d
::
¡ršg
 
d©a
;

500 
S”ŸlizeRow
(
v®ues
, 
d©a
);

501 
	grocksdb
::
Wr™eO±iÚs
 
wİt
;

502 
	grocksdb
::
Stus
 
s
;

504 autØ
	gcf
 = 
g‘_cf_hªdË
(
key
);

505 
	gs
 = 
db_
->
Put
(
wİt
, 
cf
, 
key
, 
d©a
);

507 ià(!
	gs
.
ok
()) {

508 
throw
 
	guts
::
Exû±iÚ
(
¡d
::
¡ršg
("RocksDB Put: "è+ 
s
.
ToSŒšg
());

510  
	gkOK
;

513 
	gDB
::
Stus
 
RocksdbDB
::
	$D–‘eSšgË
(cÚ¡ 
¡d
::
¡ršg
 &
bË
, cÚ¡ std::¡ršg &
key
) {

514 
rocksdb
::
Wr™eO±iÚs
 
wİt
;

515 autØ
cf
 = 
	`g‘_cf_hªdË
(
key
);

516 
rocksdb
::
Stus
 
s
 = 
db_
->
	`D–‘e
(
wİt
, 
cf
, 
key
);

517 ià(!
s
.
	`ok
()) {

518 
throw
 
uts
::
	`Exû±iÚ
(
¡d
::
	`¡ršg
("RocksDB D–‘e: "è+ 
s
.
	`ToSŒšg
());

520  
kOK
;

521 
	}
}

523 
DB
 *
	$NewRocksdbDB
() {

524  
Ãw
 
RocksdbDB
;

525 
	}
}

527 cÚ¡ 
boŞ
 
	g»gi¡”ed
 = 
DBFaùÜy
::
Regi¡”DB
("lcfdb", 
NewRocksdbDB
);

	@lcfdb/rocksdb_db.h

8 #iâdeà
YCSB_C_ROCKSDB_DB_H_


9 
	#YCSB_C_ROCKSDB_DB_H_


	)

11 
	~<¡ršg
>

12 
	~<mu‹x
>

14 
	~"cÜe/db.h
"

15 
	~"cÜe/´İ”t›s.h
"

17 
	~<rocksdb/db.h
>

18 
	~<rocksdb/bË.h
>

19 
	~<rocksdb/İtiÚs.h
>

27 
Çme¥aû
 
	gycsbc
 {

29 şas 
	cRocksdbDB
 : 
public
 
DB
 {

30 
public
:

31 
RocksdbDB
() {}

32 ~
RocksdbDB
() {}

34 
In™
();

36 
CËªup
();

38 
Stus
 
R—d
(cÚ¡ 
¡d
::
¡ršg
 &
bË
, cÚ¡ std::¡ršg &
key
,

39 cÚ¡ 
¡d
::
veùÜ
<¡d::
¡ršg
> *
f›lds
, std::veùÜ<
F›ld
> &
»suÉ
) {

40  (
this
->*(
m‘hod_»ad_
))(
bË
, 
	gkey
, 
	gf›lds
, 
	g»suÉ
);

43 
Stus
 
Sÿn
(cÚ¡ 
¡d
::
¡ršg
 &
bË
, cÚ¡ std::¡ršg &
key
, 
Ën
,

44 cÚ¡ 
¡d
::
veùÜ
<¡d::
¡ršg
> *
f›lds
, std::veùÜ<¡d::veùÜ<
F›ld
>> &
»suÉ
) {

45  (
this
->*(
m‘hod_sÿn_
))(
bË
, 
	gkey
, 
	gËn
, 
	gf›lds
, 
	g»suÉ
);

48 
Stus
 
Upd©e
(cÚ¡ 
¡d
::
¡ršg
 &
bË
, cÚ¡ std::¡ršg &
key
, std::
veùÜ
<
F›ld
> &
v®ues
) {

49  (
this
->*(
m‘hod_upd©e_
))(
bË
, 
	gkey
, 
	gv®ues
);

52 
Stus
 
In£¹
(cÚ¡ 
¡d
::
¡ršg
 &
bË
, cÚ¡ std::¡ršg &
key
, std::
veùÜ
<
F›ld
> &
v®ues
) {

53  (
this
->*(
m‘hod_š£¹_
))(
bË
, 
	gkey
, 
	gv®ues
);

56 
Stus
 
D–‘e
(cÚ¡ 
¡d
::
¡ršg
 &
bË
, cÚ¡ std::¡ršg &
key
) {

57  (
this
->*(
m‘hod_d–‘e_
))(
bË
, 
	gkey
);

60 
	g´iv©e
:

61 
	eRocksFÜm©
 {

62 
kSšgËRow
,

64 
RocksFÜm©
 
	gfÜm©_
;

66 
G‘O±iÚs
(cÚ¡ 
uts
::
Prİ”t›s
 &
´İs
, 
rocksdb
::
O±iÚs
 *
İt
,

67 
¡d
::
veùÜ
<
rocksdb
::
CŞumnFamyDesütÜ
> *
cf_descs
);

68 
S”ŸlizeRow
(cÚ¡ 
¡d
::
veùÜ
<
F›ld
> &
v®ues
, std::
¡ršg
 &
d©a
);

69 
De£rŸlizeRowF‹r
(
¡d
::
veùÜ
<
F›ld
> &
v®ues
, cÚ¡ *
p
, cÚ¡ *
lim
,

70 cÚ¡ 
¡d
::
veùÜ
<¡d::
¡ršg
> &
f›lds
);

71 
De£rŸlizeRowF‹r
(
¡d
::
veùÜ
<
F›ld
> &
v®ues
, cÚ¡ std::
¡ršg
 &
d©a
,

72 cÚ¡ 
¡d
::
veùÜ
<¡d::
¡ršg
> &
f›lds
);

73 
De£rŸlizeRow
(
¡d
::
veùÜ
<
F›ld
> &
v®ues
, cÚ¡ *
p
, cÚ¡ *
lim
);

74 
De£rŸlizeRow
(
¡d
::
veùÜ
<
F›ld
> &
v®ues
, cÚ¡ std::
¡ršg
 &
d©a
);

76 
Stus
 
R—dSšgË
(cÚ¡ 
¡d
::
¡ršg
 &
bË
, cÚ¡ std::¡ršg &
key
,

77 cÚ¡ 
¡d
::
veùÜ
<¡d::
¡ršg
> *
f›lds
, std::veùÜ<
F›ld
> &
»suÉ
);

78 
Stus
 
SÿnSšgË
(cÚ¡ 
¡d
::
¡ršg
 &
bË
, cÚ¡ std::¡ršg &
key
, 
Ën
,

79 cÚ¡ 
¡d
::
veùÜ
<¡d::
¡ršg
> *
f›lds
,

80 
¡d
::
veùÜ
<¡d::veùÜ<
F›ld
>> &
»suÉ
);

81 
Stus
 
Upd©eSšgË
(cÚ¡ 
¡d
::
¡ršg
 &
bË
, cÚ¡ std::¡ršg &
key
,

82 
¡d
::
veùÜ
<
F›ld
> &
v®ues
);

83 
Stus
 
M”geSšgË
(cÚ¡ 
¡d
::
¡ršg
 &
bË
, cÚ¡ std::¡ršg &
key
,

84 
¡d
::
veùÜ
<
F›ld
> &
v®ues
);

85 
Stus
 
In£¹SšgË
(cÚ¡ 
¡d
::
¡ršg
 &
bË
, cÚ¡ std::¡ršg &
key
,

86 
¡d
::
veùÜ
<
F›ld
> &
v®ues
);

87 
Stus
 
D–‘eSšgË
(cÚ¡ 
¡d
::
¡ršg
 &
bË
, cÚ¡ std::¡ršg &
key
);

89 
Stus
 (
RocksdbDB
::*
m‘hod_»ad_
)(cÚ¡ 
¡d
::
¡ršg
 &, cÚ¡ 
	g¡d
:: string &,

90 cÚ¡ 
	g¡d
::
veùÜ
<
¡d
::
¡ršg
> *, std::veùÜ<
F›ld
> &);

91 
Stus
 (
RocksdbDB
::*
m‘hod_sÿn_
)(cÚ¡ 
¡d
::
¡ršg
 &, cÚ¡ 
	g¡d
::string &,

92 , cÚ¡ 
	g¡d
::
veùÜ
<
¡d
::
¡ršg
> *,

93 
	g¡d
::
veùÜ
<
¡d
::veùÜ<
F›ld
>> &);

94 
Stus
 (
RocksdbDB
::*
m‘hod_upd©e_
)(cÚ¡ 
¡d
::
¡ršg
 &, cÚ¡ 
	g¡d
::string &,

95 
	g¡d
::
veùÜ
<
F›ld
> &);

96 
Stus
 (
RocksdbDB
::*
m‘hod_š£¹_
)(cÚ¡ 
¡d
::
¡ršg
 &, cÚ¡ 
	g¡d
::string &,

97 
	g¡d
::
veùÜ
<
F›ld
> &);

98 
Stus
 (
RocksdbDB
::*
m‘hod_d–‘e_
)(cÚ¡ 
¡d
::
¡ršg
 &, cÚ¡ 
	g¡d
::string &);

100 
	gf›ldcouÁ_
;

102 
	grocksdb
::
DB
 *
db_
;

103 
	g»f_út_
;

104 
	g¡d
::
mu‹x
 
mu_
;

108 
DB
 *
NewRocksdbDB
();

	@leveldb/leveldb_db.cc

8 
	~"Ëv–db_db.h
"

9 
	~"cÜe/´İ”t›s.h
"

10 
	~"cÜe/uts.h
"

11 
	~"cÜe/cÜe_wÜklßd.h
"

12 
	~"cÜe/db_çùÜy.h
"

14 
	~<Ëv–db/İtiÚs.h
>

15 
	~<Ëv–db/wr™e_b©ch.h
>

17 
	gÇme¥aû
 {

18 cÚ¡ 
	g¡d
::
¡ršg
 
PROP_NAME
 = "leveldb.dbname";

19 cÚ¡ 
	g¡d
::
¡ršg
 
PROP_NAME_DEFAULT
 = "";

21 cÚ¡ 
	g¡d
::
¡ršg
 
PROP_FORMAT
 = "leveldb.format";

22 cÚ¡ 
	g¡d
::
¡ršg
 
PROP_FORMAT_DEFAULT
 = "single";

24 cÚ¡ 
	g¡d
::
¡ršg
 
PROP_DESTROY
 = "leveldb.destroy";

25 cÚ¡ 
	g¡d
::
¡ršg
 
PROP_DESTROY_DEFAULT
 = "false";

27 cÚ¡ 
	g¡d
::
¡ršg
 
PROP_COMPRESSION
 = "leveldb.compression";

28 cÚ¡ 
	g¡d
::
¡ršg
 
PROP_COMPRESSION_DEFAULT
 = "no";

30 cÚ¡ 
	g¡d
::
¡ršg
 
PROP_WRITE_BUFFER_SIZE
 = "leveldb.write_buffer_size";

31 cÚ¡ 
	g¡d
::
¡ršg
 
PROP_WRITE_BUFFER_SIZE_DEFAULT
 = "-1";

33 cÚ¡ 
	g¡d
::
¡ršg
 
PROP_MAX_FILE_SIZE
 = "leveldb.max_file_size";

34 cÚ¡ 
	g¡d
::
¡ršg
 
PROP_MAX_FILE_SIZE_DEFAULT
 = "-1";

36 cÚ¡ 
	g¡d
::
¡ršg
 
PROP_MAX_OPEN_FILES
 = "leveldb.max_open_files";

37 cÚ¡ 
	g¡d
::
¡ršg
 
PROP_MAX_OPEN_FILES_DEFAULT
 = "-1";

39 cÚ¡ 
	g¡d
::
¡ršg
 
PROP_CACHE_SIZE
 = "leveldb.cache_size";

40 cÚ¡ 
	g¡d
::
¡ršg
 
PROP_CACHE_SIZE_DEFAULT
 = "-1";

42 cÚ¡ 
	g¡d
::
¡ršg
 
PROP_FILTER_BITS
 = "leveldb.filter_bits";

43 cÚ¡ 
	g¡d
::
¡ršg
 
PROP_FILTER_BITS_DEFAULT
 = "-1";

46 
Çme¥aû
 
	gycsbc
 {

48 
	gËv–db
::
DB
 *
Lev–dbDB
::
db_
 = 
nuÎ±r
;

49 
	gLev–dbDB
::
»f_út_
 = 0;

50 
	g¡d
::
mu‹x
 
Lev–dbDB
::
mu_
;

52 
	gLev–dbDB
::
In™
() {

53 cÚ¡ 
¡d
::
lock_gu¬d
<¡d::
mu‹x
> 
lock
(
mu_
);

55 cÚ¡ 
	guts
::
Prİ”t›s
 &
´İs
 = *
´İs_
;

56 cÚ¡ 
	g¡d
::
¡ršg
 &
fÜm©
 = 
´İs
.
G‘Prİ”ty
(
PROP_FORMAT
, 
PROP_FORMAT_DEFAULT
);

57 ià(
	gfÜm©
 == "single") {

58 
fÜm©_
 = 
kSšgËEÁry
;

59 
	gm‘hod_»ad_
 = &
Lev–dbDB
::
R—dSšgËEÁry
;

60 
	gm‘hod_sÿn_
 = &
Lev–dbDB
::
SÿnSšgËEÁry
;

61 
	gm‘hod_upd©e_
 = &
Lev–dbDB
::
Upd©eSšgËEÁry
;

62 
	gm‘hod_š£¹_
 = &
Lev–dbDB
::
In£¹SšgËEÁry
;

63 
	gm‘hod_d–‘e_
 = &
Lev–dbDB
::
D–‘eSšgËEÁry
;

64 } ià(
	gfÜm©
 == "row") {

65 
fÜm©_
 = 
kRowMajÜ
;

66 
	gm‘hod_»ad_
 = &
Lev–dbDB
::
R—dCompKeyRM
;

67 
	gm‘hod_sÿn_
 = &
Lev–dbDB
::
SÿnCompKeyRM
;

68 
	gm‘hod_upd©e_
 = &
Lev–dbDB
::
In£¹CompKey
;

69 
	gm‘hod_š£¹_
 = &
Lev–dbDB
::
In£¹CompKey
;

70 
	gm‘hod_d–‘e_
 = &
Lev–dbDB
::
D–‘eCompKey
;

71 } ià(
	gfÜm©
 == "column") {

72 
fÜm©_
 = 
kCŞumnMajÜ
;

73 
	gm‘hod_»ad_
 = &
Lev–dbDB
::
R—dCompKeyCM
;

74 
	gm‘hod_sÿn_
 = &
Lev–dbDB
::
SÿnCompKeyCM
;

75 
	gm‘hod_upd©e_
 = &
Lev–dbDB
::
In£¹CompKey
;

76 
	gm‘hod_š£¹_
 = &
Lev–dbDB
::
In£¹CompKey
;

77 
	gm‘hod_d–‘e_
 = &
Lev–dbDB
::
D–‘eCompKey
;

79 
throw
 
	guts
::
Exû±iÚ
("unknown format");

81 
	gf›ldcouÁ_
 = 
¡d
::
¡oi
(
´İs
.
G‘Prİ”ty
(
CÜeWÜklßd
::
FIELD_COUNT_PROPERTY
,

82 
CÜeWÜklßd
::
FIELD_COUNT_DEFAULT
));

83 
	gf›ld_´efix_
 = 
´İs
.
G‘Prİ”ty
(
CÜeWÜklßd
::
FIELD_NAME_PREFIX
,

84 
CÜeWÜklßd
::
FIELD_NAME_PREFIX_DEFAULT
);

86 
	g»f_út_
++;

87 ià(
	gdb_
) {

91 cÚ¡ 
	g¡d
::
¡ršg
 &
db_·th
 = 
´İs
.
G‘Prİ”ty
(
PROP_NAME
, 
PROP_NAME_DEFAULT
);

92 ià(
	gdb_·th
 == "") {

93 
throw
 
uts
::
Exû±iÚ
("LevelDB db…ath is missing");

96 
	gËv–db
::
O±iÚs
 
İt
;

97 
	gİt
.
	gü—‹_if_missšg
 = 
Œue
;

98 
G‘O±iÚs
(
´İs
, &
İt
);

100 
	gËv–db
::
Stus
 
s
;

102 ià(
	g´İs
.
G‘Prİ”ty
(
PROP_DESTROY
, 
PROP_DESTROY_DEFAULT
) == "true") {

103 
s
 = 
Ëv–db
::
De¡royDB
(
db_·th
, 
İt
);

104 ià(!
	gs
.
ok
()) {

105 
throw
 
	guts
::
Exû±iÚ
(
¡d
::
¡ršg
("Lev–DB De¡royDB: "è+ 
s
.
ToSŒšg
());

108 
	gs
 = 
Ëv–db
::
DB
::
O³n
(
İt
, 
db_·th
, &
db_
);

109 ià(!
	gs
.
ok
()) {

110 
throw
 
	guts
::
Exû±iÚ
(
¡d
::
¡ršg
("Lev–DB O³n: "è+ 
s
.
ToSŒšg
());

114 
	gLev–dbDB
::
CËªup
() {

115 cÚ¡ 
¡d
::
lock_gu¬d
<¡d::
mu‹x
> 
lock
(
mu_
);

116 ià(--
	g»f_út_
) {

119 
d–‘e
 
	gdb_
;

122 
	gLev–dbDB
::
G‘O±iÚs
(cÚ¡ 
uts
::
Prİ”t›s
 &
´İs
, 
Ëv–db
::
O±iÚs
 *
İt
) {

123 
size_t
 
wr™”_bufãr_size
 = 
¡d
::
¡Ş
(
´İs
.
G‘Prİ”ty
(
PROP_WRITE_BUFFER_SIZE
,

124 
PROP_WRITE_BUFFER_SIZE_DEFAULT
));

125 ià(
	gwr™”_bufãr_size
 > 0) {

126 
	gİt
->
	gwr™e_bufãr_size
 = 
wr™”_bufãr_size
;

128 
size_t
 
	gmax_fe_size
 = 
¡d
::
¡Ş
(
´İs
.
G‘Prİ”ty
(
PROP_MAX_FILE_SIZE
,

129 
PROP_MAX_FILE_SIZE_DEFAULT
));

130 ià(
	gmax_fe_size
 > 0) {

131 
	gİt
->
	gmax_fe_size
 = 
max_fe_size
;

133 
size_t
 
	gÿche_size
 = 
¡d
::
¡Ş
(
´İs
.
G‘Prİ”ty
(
PROP_CACHE_SIZE
,

134 
PROP_CACHE_SIZE_DEFAULT
));

135 ià(
	gÿche_size
 >= 0) {

136 
İt
->
block_ÿche
 = 
Ëv–db
::
NewLRUCache
(
ÿche_size
);

138 
	gmax_İ’_fes
 = 
¡d
::
¡oi
(
´İs
.
G‘Prİ”ty
(
PROP_MAX_OPEN_FILES
,

139 
PROP_MAX_OPEN_FILES_DEFAULT
));

140 ià(
	gmax_İ’_fes
 > 0) {

141 
	gİt
->
	gmax_İ’_fes
 = 
max_İ’_fes
;

143 
	g¡d
::
¡ršg
 
com´essiÚ
 = 
´İs
.
G‘Prİ”ty
(
PROP_COMPRESSION
,

144 
PROP_COMPRESSION_DEFAULT
);

145 ià(
	gcom´essiÚ
 == "snappy") {

146 
İt
->
com´essiÚ
 = 
Ëv–db
::
kSÇµyCom´essiÚ
;

148 
	gİt
->
	gcom´essiÚ
 = 
Ëv–db
::
kNoCom´essiÚ
;

150 
	gf‹r_b™s
 = 
¡d
::
¡oi
(
´İs
.
G‘Prİ”ty
(
PROP_FILTER_BITS
,

151 
PROP_FILTER_BITS_DEFAULT
));

152 ià(
	gf‹r_b™s
 > 0) {

153 
	gİt
->
	gf‹r_pŞicy
 = 
Ëv–db
::
NewBloomF‹rPŞicy
(
f‹r_b™s
);

157 
	gLev–dbDB
::
S”ŸlizeRow
(cÚ¡ 
¡d
::
veùÜ
<
F›ld
> &
v®ues
, std::
¡ršg
 *
d©a
) {

158 cÚ¡ 
F›ld
 &
f›ld
 : 
v®ues
) {

159 
ušt32_t
 
Ën
 = 
f›ld
.
Çme
.
size
();

160 
	gd©a
->
­³nd
(
»š‹½»t_ÿ¡
<*>(&
Ën
), (
ušt32_t
));

161 
	gd©a
->
­³nd
(
f›ld
.
Çme
.
d©a
(), f›ld.Çme.
size
());

162 
	gËn
 = 
f›ld
.
v®ue
.
size
();

163 
	gd©a
->
­³nd
(
»š‹½»t_ÿ¡
<*>(&
Ën
), (
ušt32_t
));

164 
	gd©a
->
­³nd
(
f›ld
.
v®ue
.
d©a
(), f›ld.v®ue.
size
());

168 
	gLev–dbDB
::
De£rŸlizeRowF‹r
(
¡d
::
veùÜ
<
F›ld
> *
v®ues
, cÚ¡ std::
¡ršg
 &
d©a
,

169 cÚ¡ 
¡d
::
veùÜ
<¡d::
¡ršg
> &
f›lds
) {

170 cÚ¡ *
p
 = 
d©a
.data();

171 cÚ¡ *
	glim
 = 
p
 + 
d©a
.
size
();

173 
	g¡d
::
veùÜ
<
¡d
::
¡ršg
>::
cÚ¡_™”©Ü
 
f‹r_™”
 = 
f›lds
.
begš
();

174 
	gp
 !ğ
lim
 && 
f‹r_™”
 !ğ
f›lds
.
’d
()) {

175 
as£¹
(
p
 < 
lim
);

176 
ušt32_t
 
	gËn
 = *
»š‹½»t_ÿ¡
<cÚ¡ ušt32_ˆ*>(
p
);

177 
	gp
 +ğ(
ušt32_t
);

178 
	g¡d
::
¡ršg
 
f›ld
(
p
, 
¡©ic_ÿ¡
<cÚ¡ 
size_t
>(
Ën
));

179 
	gp
 +ğ
Ën
;

180 
	gËn
 = *
»š‹½»t_ÿ¡
<cÚ¡ 
ušt32_t
 *>(
p
);

181 
	gp
 +ğ(
ušt32_t
);

182 
	g¡d
::
¡ršg
 
v®ue
(
p
, 
¡©ic_ÿ¡
<cÚ¡ 
size_t
>(
Ën
));

183 
	gp
 +ğ
Ën
;

184 ià(*
	gf‹r_™”
 =ğ
f›ld
) {

185 
v®ues
->
push_back
({
f›ld
, 
v®ue
});

186 
	gf‹r_™”
++;

189 
as£¹
(
v®ues
->
size
(è=ğ
f›lds
.size());

192 
	gLev–dbDB
::
De£rŸlizeRow
(
¡d
::
veùÜ
<
F›ld
> *
v®ues
, cÚ¡ std::
¡ršg
 &
d©a
) {

193 cÚ¡ *
p
 = 
d©a
.data();

194 cÚ¡ *
	glim
 = 
p
 + 
d©a
.
size
();

195 
	gp
 !ğ
lim
) {

196 
as£¹
(
p
 < 
lim
);

197 
ušt32_t
 
	gËn
 = *
»š‹½»t_ÿ¡
<cÚ¡ ušt32_ˆ*>(
p
);

198 
	gp
 +ğ(
ušt32_t
);

199 
	g¡d
::
¡ršg
 
f›ld
(
p
, 
¡©ic_ÿ¡
<cÚ¡ 
size_t
>(
Ën
));

200 
	gp
 +ğ
Ën
;

201 
	gËn
 = *
»š‹½»t_ÿ¡
<cÚ¡ 
ušt32_t
 *>(
p
);

202 
	gp
 +ğ(
ušt32_t
);

203 
	g¡d
::
¡ršg
 
v®ue
(
p
, 
¡©ic_ÿ¡
<cÚ¡ 
size_t
>(
Ën
));

204 
	gp
 +ğ
Ën
;

205 
	gv®ues
->
push_back
({
f›ld
, 
v®ue
});

207 
as£¹
(
v®ues
->
size
(è=ğ
f›ldcouÁ_
);

210 
	g¡d
::
¡ršg
 
Lev–dbDB
::
BudCompKey
(cÚ¡ 
¡d
::¡ršg &
key
, cÚ¡ std::¡ršg &
f›ld_Çme
) {

211 
fÜm©_
) {

212 
kRowMajÜ
:

213  
key
 + ":" + 
f›ld_Çme
;

215 
	gkCŞumnMajÜ
:

216  
f›ld_Çme
 + ":" + 
key
;

219 
throw
 
uts
::
Exû±iÚ
("wrong format");

223 
	g¡d
::
¡ršg
 
Lev–dbDB
::
KeyFromCompKey
(cÚ¡ 
¡d
::¡ršg &
comp_key
) {

224 
size_t
 
idx
 = 
comp_key
.
fšd
(":");

225 
as£¹
(
idx
 !ğ
¡d
::
¡ršg
::
Åos
);

226  
	gcomp_key
.
sub¡r
(0, 
idx
);

229 
	g¡d
::
¡ršg
 
Lev–dbDB
::
F›ldFromCompKey
(cÚ¡ 
¡d
::¡ršg &
comp_key
) {

230 
size_t
 
idx
 = 
comp_key
.
fšd
(":");

231 
as£¹
(
idx
 !ğ
¡d
::
¡ršg
::
Åos
);

232  
	gcomp_key
.
sub¡r
(
idx
 + 1);

235 
	gDB
::
Stus
 
Lev–dbDB
::
R—dSšgËEÁry
(cÚ¡ 
¡d
::
¡ršg
 &
bË
, cÚ¡ std::¡ršg &
key
,

236 cÚ¡ 
¡d
::
veùÜ
<¡d::
¡ršg
> *
f›lds
,

237 
¡d
::
veùÜ
<
F›ld
> &
»suÉ
) {

238 
¡d
::
¡ršg
 
d©a
;

239 
	gËv–db
::
Stus
 
s
 = 
db_
->
G‘
(
Ëv–db
::
R—dO±iÚs
(), 
key
, &
d©a
);

240 ià(
	gs
.
IsNÙFound
()) {

241  
	gkNÙFound
;

242 } ià(!
	gs
.
ok
()) {

243 
throw
 
	guts
::
Exû±iÚ
(
¡d
::
¡ršg
("Lev–DB G‘: "è+ 
s
.
ToSŒšg
());

245 ià(
	gf›lds
 !ğ
nuÎ±r
) {

246 
De£rŸlizeRowF‹r
(&
»suÉ
, 
d©a
, *
f›lds
);

248 
De£rŸlizeRow
(&
»suÉ
, 
d©a
);

250  
	gkOK
;

253 
	gDB
::
Stus
 
Lev–dbDB
::
SÿnSšgËEÁry
(cÚ¡ 
¡d
::
¡ršg
 &
bË
, cÚ¡ std::¡ršg &
key
, 
Ën
,

254 cÚ¡ 
¡d
::
veùÜ
<¡d::
¡ršg
> *
f›lds
,

255 
¡d
::
veùÜ
<¡d::veùÜ<
F›ld
>> &
»suÉ
) {

256 
Ëv–db
::
I‹¿tÜ
 *
db_™”
 = 
db_
->
NewI‹¿tÜ
Öev–db::
R—dO±iÚs
());

257 
	gdb_™”
->
S“k
(
key
);

258 
	gi
 = 0; 
	gdb_™”
->
V®id
(è&& i < 
	gËn
; i++) {

259 
	g¡d
::
¡ršg
 
d©a
 = 
db_™”
->
v®ue
().
ToSŒšg
();

260 
	g»suÉ
.
push_back
(
¡d
::
veùÜ
<
F›ld
>());

261 
	g¡d
::
veùÜ
<
F›ld
> &
v®ues
 = 
»suÉ
.
back
();

262 ià(
	gf›lds
 !ğ
nuÎ±r
) {

263 
De£rŸlizeRowF‹r
(&
v®ues
, 
d©a
, *
f›lds
);

265 
De£rŸlizeRow
(&
v®ues
, 
d©a
);

267 
	gdb_™”
->
Next
();

269 
d–‘e
 
	gdb_™”
;

270  
	gkOK
;

273 
	gDB
::
Stus
 
Lev–dbDB
::
Upd©eSšgËEÁry
(cÚ¡ 
¡d
::
¡ršg
 &
bË
, cÚ¡ std::¡ršg &
key
,

274 
¡d
::
veùÜ
<
F›ld
> &
v®ues
) {

275 
¡d
::
¡ršg
 
d©a
;

276 
	gËv–db
::
Stus
 
s
 = 
db_
->
G‘
(
Ëv–db
::
R—dO±iÚs
(), 
key
, &
d©a
);

277 ià(
	gs
.
IsNÙFound
()) {

278  
	gkNÙFound
;

279 } ià(!
	gs
.
ok
()) {

280 
throw
 
	guts
::
Exû±iÚ
(
¡d
::
¡ršg
("Lev–DB G‘: "è+ 
s
.
ToSŒšg
());

282 
	g¡d
::
veùÜ
<
F›ld
> 
cu¼’t_v®ues
;

283 
De£rŸlizeRow
(&
cu¼’t_v®ues
, 
d©a
);

284 
	gF›ld
 &
	gÃw_f›ld
 : 
v®ues
) {

285 
boŞ
 
found
 
__©Œibu‹__
((
unu£d
)èğ
çl£
;

286 
	gF›ld
 &
	gcur_f›ld
 : 
cu¼’t_v®ues
) {

287 ià(
cur_f›ld
.
Çme
 =ğ
Ãw_f›ld
.name) {

288 
found
 = 
Œue
;

289 
	gcur_f›ld
.
	gv®ue
 = 
Ãw_f›ld
.
v®ue
;

293 
as£¹
(
found
);

295 
	gËv–db
::
Wr™eO±iÚs
 
wİt
;

297 
	gd©a
.
ş—r
();

298 
S”ŸlizeRow
(
cu¼’t_v®ues
, &
d©a
);

299 
	gs
 = 
db_
->
Put
(
wİt
, 
key
, 
d©a
);

300 ià(!
	gs
.
ok
()) {

301 
throw
 
	guts
::
Exû±iÚ
(
¡d
::
¡ršg
("Lev–DB Put: "è+ 
s
.
ToSŒšg
());

303  
	gkOK
;

306 
	gDB
::
Stus
 
Lev–dbDB
::
In£¹SšgËEÁry
(cÚ¡ 
¡d
::
¡ršg
 &
bË
, cÚ¡ std::¡ršg &
key
,

307 
¡d
::
veùÜ
<
F›ld
> &
v®ues
) {

308 
¡d
::
¡ršg
 
d©a
;

309 
S”ŸlizeRow
(
v®ues
, &
d©a
);

310 
	gËv–db
::
Wr™eO±iÚs
 
wİt
;

311 
	gËv–db
::
Stus
 
s
 = 
db_
->
Put
(
wİt
, 
key
, 
d©a
);

312 ià(!
	gs
.
ok
()) {

313 
throw
 
	guts
::
Exû±iÚ
(
¡d
::
¡ršg
("Lev–DB Put: "è+ 
s
.
ToSŒšg
());

315  
	gkOK
;

318 
	gDB
::
Stus
 
Lev–dbDB
::
D–‘eSšgËEÁry
(cÚ¡ 
¡d
::
¡ršg
 &
bË
, cÚ¡ std::¡ršg &
key
) {

319 
Ëv–db
::
Wr™eO±iÚs
 
wİt
;

320 
	gËv–db
::
Stus
 
s
 = 
db_
->
D–‘e
(
wİt
, 
key
);

321 ià(!
	gs
.
ok
()) {

322 
throw
 
	guts
::
Exû±iÚ
(
¡d
::
¡ršg
("Lev–DB D–‘e: "è+ 
s
.
ToSŒšg
());

324  
	gkOK
;

327 
	gDB
::
Stus
 
Lev–dbDB
::
R—dCompKeyRM
(cÚ¡ 
¡d
::
¡ršg
 &
bË
, cÚ¡ std::¡ršg &
key
,

328 cÚ¡ 
¡d
::
veùÜ
<¡d::
¡ršg
> *
f›lds
,

329 
¡d
::
veùÜ
<
F›ld
> &
»suÉ
) {

330 
Ëv–db
::
I‹¿tÜ
 *
db_™”
 = 
db_
->
NewI‹¿tÜ
Öev–db::
R—dO±iÚs
());

331 
	gdb_™”
->
S“k
(
key
);

332 ià(!
	gdb_™”
->
V®id
(è|| 
KeyFromCompKey
(
db_™”
->
key
().
ToSŒšg
()) != key) {

333  
kNÙFound
;

335 ià(
	gf›lds
 !ğ
nuÎ±r
) {

336 
¡d
::
veùÜ
<¡d::
¡ršg
>::
cÚ¡_™”©Ü
 
f‹r_™”
 = 
f›lds
->
begš
();

337 
	gi
 = 0; i < 
	gf›ldcouÁ_
 && 
	gf‹r_™”
 !ğ
f›lds
->
’d
(è&& 
db_™”
->
V®id
(); i++) {

338 
	g¡d
::
¡ršg
 
comp_key
 = 
db_™”
->
key
().
ToSŒšg
();

339 
	g¡d
::
¡ršg
 
cur_v®
 = 
db_™”
->
v®ue
().
ToSŒšg
();

340 
	g¡d
::
¡ršg
 
cur_key
 = 
KeyFromCompKey
(
comp_key
);

341 
	g¡d
::
¡ršg
 
cur_f›ld
 = 
F›ldFromCompKey
(
comp_key
);

342 
as£¹
(
cur_key
 =ğ
key
);

343 
as£¹
(
cur_f›ld
 =ğ
f›ld_´efix_
 + 
¡d
::
to_¡ršg
(
i
));

345 ià(
	gcur_f›ld
 =ğ*
f‹r_™”
) {

346 
»suÉ
.
push_back
({
cur_f›ld
, 
cur_v®
});

347 
	gf‹r_™”
++;

349 
	gdb_™”
->
Next
();

351 
as£¹
(
»suÉ
.
size
(è=ğ
f›lds
->size());

353 
	gi
 = 0; i < 
	gf›ldcouÁ_
 && 
	gdb_™”
->
V®id
(); i++) {

354 
	g¡d
::
¡ršg
 
comp_key
 = 
db_™”
->
key
().
ToSŒšg
();

355 
	g¡d
::
¡ršg
 
cur_v®
 = 
db_™”
->
v®ue
().
ToSŒšg
();

356 
	g¡d
::
¡ršg
 
cur_key
 = 
KeyFromCompKey
(
comp_key
);

357 
	g¡d
::
¡ršg
 
cur_f›ld
 = 
F›ldFromCompKey
(
comp_key
);

358 
as£¹
(
cur_key
 =ğ
key
);

359 
as£¹
(
cur_f›ld
 =ğ
f›ld_´efix_
 + 
¡d
::
to_¡ršg
(
i
));

361 
	g»suÉ
.
push_back
({
cur_f›ld
, 
cur_v®
});

362 
	gdb_™”
->
Next
();

364 
as£¹
(
»suÉ
.
size
(è=ğ
f›ldcouÁ_
);

366 
d–‘e
 
	gdb_™”
;

367  
	gkOK
;

370 
	gDB
::
Stus
 
Lev–dbDB
::
SÿnCompKeyRM
(cÚ¡ 
¡d
::
¡ršg
 &
bË
, cÚ¡ std::¡ršg &
key
, 
Ën
,

371 cÚ¡ 
¡d
::
veùÜ
<¡d::
¡ršg
> *
f›lds
,

372 
¡d
::
veùÜ
<¡d::veùÜ<
F›ld
>> &
»suÉ
) {

373 
Ëv–db
::
I‹¿tÜ
 *
db_™”
 = 
db_
->
NewI‹¿tÜ
Öev–db::
R—dO±iÚs
());

374 
	gdb_™”
->
S“k
(
key
);

375 
as£¹
(
db_™”
->
V®id
(è&& 
KeyFromCompKey
(db_™”->
key
().
ToSŒšg
()) == key);

376 
	gi
 = 0; i < 
	gËn
 && 
	gdb_™”
->
V®id
(); i++) {

377 
	g»suÉ
.
push_back
(
¡d
::
veùÜ
<
F›ld
>());

378 
	g¡d
::
veùÜ
<
F›ld
> &
v®ues
 = 
»suÉ
.
back
();

379 ià(
	gf›lds
 !ğ
nuÎ±r
) {

380 
¡d
::
veùÜ
<¡d::
¡ršg
>::
cÚ¡_™”©Ü
 
f‹r_™”
 = 
f›lds
->
begš
();

381 
	gj
 = 0; j < 
	gf›ldcouÁ_
 && 
	gf‹r_™”
 !ğ
f›lds
->
’d
(è&& 
db_™”
->
V®id
(); j++) {

382 
	g¡d
::
¡ršg
 
comp_key
 = 
db_™”
->
key
().
ToSŒšg
();

383 
	g¡d
::
¡ršg
 
cur_v®
 = 
db_™”
->
v®ue
().
ToSŒšg
();

384 
	g¡d
::
¡ršg
 
cur_key
 = 
KeyFromCompKey
(
comp_key
);

385 
	g¡d
::
¡ršg
 
cur_f›ld
 = 
F›ldFromCompKey
(
comp_key
);

386 
as£¹
(
cur_f›ld
 =ğ
f›ld_´efix_
 + 
¡d
::
to_¡ršg
(
j
));

388 ià(
	gcur_f›ld
 =ğ*
f‹r_™”
) {

389 
v®ues
.
push_back
({
cur_f›ld
, 
cur_v®
});

390 
	gf‹r_™”
++;

392 
	gdb_™”
->
Next
();

394 
as£¹
(
v®ues
.
size
(è=ğ
f›lds
->size());

396 
	gj
 = 0; j < 
	gf›ldcouÁ_
 && 
	gdb_™”
->
V®id
(); j++) {

397 
	g¡d
::
¡ršg
 
comp_key
 = 
db_™”
->
key
().
ToSŒšg
();

398 
	g¡d
::
¡ršg
 
cur_v®
 = 
db_™”
->
v®ue
().
ToSŒšg
();

399 
	g¡d
::
¡ršg
 
cur_key
 = 
KeyFromCompKey
(
comp_key
);

400 
	g¡d
::
¡ršg
 
cur_f›ld
 = 
F›ldFromCompKey
(
comp_key
);

401 
as£¹
(
cur_f›ld
 =ğ
f›ld_´efix_
 + 
¡d
::
to_¡ršg
(
j
));

403 
	gv®ues
.
push_back
({
cur_f›ld
, 
cur_v®
});

404 
	gdb_™”
->
Next
();

406 
as£¹
(
v®ues
.
size
(è=ğ
f›ldcouÁ_
);

409 
d–‘e
 
	gdb_™”
;

410  
	gkOK
;

413 
	gDB
::
Stus
 
Lev–dbDB
::
R—dCompKeyCM
(cÚ¡ 
¡d
::
¡ršg
 &
bË
, cÚ¡ std::¡ršg &
key
,

414 cÚ¡ 
¡d
::
veùÜ
<¡d::
¡ršg
> *
f›lds
,

415 
¡d
::
veùÜ
<
F›ld
> &
»suÉ
) {

416  
kNÙIm¶em’‹d
;

419 
	gDB
::
Stus
 
Lev–dbDB
::
SÿnCompKeyCM
(cÚ¡ 
¡d
::
¡ršg
 &
bË
, cÚ¡ std::¡ršg &
key
, 
Ën
,

420 cÚ¡ 
¡d
::
veùÜ
<¡d::
¡ršg
> *
f›lds
,

421 
¡d
::
veùÜ
<¡d::veùÜ<
F›ld
>> &
»suÉ
) {

422  
kNÙIm¶em’‹d
;

425 
	gDB
::
Stus
 
Lev–dbDB
::
In£¹CompKey
(cÚ¡ 
¡d
::
¡ršg
 &
bË
, cÚ¡ std::¡ršg &
key
,

426 
¡d
::
veùÜ
<
F›ld
> &
v®ues
) {

427 
Ëv–db
::
Wr™eO±iÚs
 
wİt
;

428 
	gËv–db
::
Wr™eB©ch
 
b©ch
;

430 
	g¡d
::
¡ršg
 
comp_key
;

431 
	gF›ld
 &
	gf›ld
 : 
v®ues
) {

432 
comp_key
 = 
BudCompKey
(
key
, 
f›ld
.
Çme
);

433 
	gb©ch
.
Put
(
comp_key
, 
f›ld
.
v®ue
);

436 
	gËv–db
::
Stus
 
s
 = 
db_
->
Wr™e
(
wİt
, &
b©ch
);

437 ià(!
	gs
.
ok
()) {

438 
throw
 
	guts
::
Exû±iÚ
(
¡d
::
¡ršg
("Lev–DB Wr™e: "è+ 
s
.
ToSŒšg
());

440  
	gkOK
;

443 
	gDB
::
Stus
 
Lev–dbDB
::
D–‘eCompKey
(cÚ¡ 
¡d
::
¡ršg
 &
bË
, cÚ¡ std::¡ršg &
key
) {

444 
Ëv–db
::
Wr™eO±iÚs
 
wİt
;

445 
	gËv–db
::
Wr™eB©ch
 
b©ch
;

447 
	g¡d
::
¡ršg
 
comp_key
;

448 
	gi
 = 0; i < 
	gf›ldcouÁ_
; i++) {

449 
	gcomp_key
 = 
BudCompKey
(
key
, 
f›ld_´efix_
 + 
¡d
::
to_¡ršg
(
i
));

450 
	gb©ch
.
D–‘e
(
comp_key
);

453 
	gËv–db
::
Stus
 
s
 = 
db_
->
Wr™e
(
wİt
, &
b©ch
);

454 ià(!
	gs
.
ok
()) {

455 
throw
 
	guts
::
Exû±iÚ
(
¡d
::
¡ršg
("Lev–DB Wr™e: "è+ 
s
.
ToSŒšg
());

457  
	gkOK
;

460 
DB
 *
NewLev–dbDB
() {

461  
Ãw
 
	gLev–dbDB
;

464 cÚ¡ 
boŞ
 
	g»gi¡”ed
 = 
DBFaùÜy
::
Regi¡”DB
("Ëv–db", 
NewLev–dbDB
);

	@leveldb/leveldb_db.h

8 #iâdeà
YCSB_C_LEVELDB_DB_H_


9 
	#YCSB_C_LEVELDB_DB_H_


	)

11 
	~<io¡»am
>

12 
	~<¡ršg
>

13 
	~<mu‹x
>

15 
	~"cÜe/db.h
"

16 
	~"cÜe/´İ”t›s.h
"

18 
	~<Ëv–db/db.h
>

19 
	~<Ëv–db/İtiÚs.h
>

20 
	~<Ëv–db/¡©us.h
>

21 
	~<Ëv–db/ÿche.h
>

22 
	~<Ëv–db/f‹r_pŞicy.h
>

24 
Çme¥aû
 
	gycsbc
 {

26 şas 
	cLev–dbDB
 : 
public
 
DB
 {

27 
public
:

28 
Lev–dbDB
() {}

29 ~
Lev–dbDB
() {}

31 
In™
();

33 
CËªup
();

35 
Stus
 
R—d
(cÚ¡ 
¡d
::
¡ršg
 &
bË
, cÚ¡ std::¡ršg &
key
,

36 cÚ¡ 
¡d
::
veùÜ
<¡d::
¡ršg
> *
f›lds
, std::veùÜ<
F›ld
> &
»suÉ
) {

37  (
this
->*(
m‘hod_»ad_
))(
bË
, 
	gkey
, 
	gf›lds
, 
	g»suÉ
);

40 
Stus
 
Sÿn
(cÚ¡ 
¡d
::
¡ršg
 &
bË
, cÚ¡ std::¡ršg &
key
, 
Ën
,

41 cÚ¡ 
¡d
::
veùÜ
<¡d::
¡ršg
> *
f›lds
, std::veùÜ<¡d::veùÜ<
F›ld
>> &
»suÉ
) {

42  (
this
->*(
m‘hod_sÿn_
))(
bË
, 
	gkey
, 
	gËn
, 
	gf›lds
, 
	g»suÉ
);

45 
Stus
 
Upd©e
(cÚ¡ 
¡d
::
¡ršg
 &
bË
, cÚ¡ std::¡ršg &
key
, std::
veùÜ
<
F›ld
> &
v®ues
) {

46  (
this
->*(
m‘hod_upd©e_
))(
bË
, 
	gkey
, 
	gv®ues
);

49 
Stus
 
In£¹
(cÚ¡ 
¡d
::
¡ršg
 &
bË
, cÚ¡ std::¡ršg &
key
, std::
veùÜ
<
F›ld
> &
v®ues
) {

50  (
this
->*(
m‘hod_š£¹_
))(
bË
, 
	gkey
, 
	gv®ues
);

53 
Stus
 
D–‘e
(cÚ¡ 
¡d
::
¡ršg
 &
bË
, cÚ¡ std::¡ršg &
key
) {

54  (
this
->*(
m‘hod_d–‘e_
))(
bË
, 
	gkey
);

57 
	g´iv©e
:

58 
	eLdbFÜm©
 {

59 
kSšgËEÁry
,

60 
	gkRowMajÜ
,

61 
	gkCŞumnMajÜ


63 
LdbFÜm©
 
	gfÜm©_
;

65 
G‘O±iÚs
(cÚ¡ 
uts
::
Prİ”t›s
 &
´İs
, 
Ëv–db
::
O±iÚs
 *
İt
);

66 
S”ŸlizeRow
(cÚ¡ 
¡d
::
veùÜ
<
F›ld
> &
v®ues
, std::
¡ršg
 *
d©a
);

67 
De£rŸlizeRowF‹r
(
¡d
::
veùÜ
<
F›ld
> *
v®ues
, cÚ¡ std::
¡ršg
 &
d©a
,

68 cÚ¡ 
¡d
::
veùÜ
<¡d::
¡ršg
> &
f›lds
);

69 
De£rŸlizeRow
(
¡d
::
veùÜ
<
F›ld
> *
v®ues
, cÚ¡ std::
¡ršg
 &
d©a
);

70 
	g¡d
::
¡ršg
 
BudCompKey
(cÚ¡ 
¡d
::¡ršg &
key
, cÚ¡ std::¡ršg &
f›ld_Çme
);

71 
	g¡d
::
¡ršg
 
KeyFromCompKey
(cÚ¡ 
¡d
::¡ršg &
comp_key
);

72 
	g¡d
::
¡ršg
 
F›ldFromCompKey
(cÚ¡ 
¡d
::¡ršg &
comp_key
);

74 
Stus
 
R—dSšgËEÁry
(cÚ¡ 
¡d
::
¡ršg
 &
bË
, cÚ¡ std::¡ršg &
key
,

75 cÚ¡ 
¡d
::
veùÜ
<¡d::
¡ršg
> *
f›lds
, std::veùÜ<
F›ld
> &
»suÉ
);

76 
Stus
 
SÿnSšgËEÁry
(cÚ¡ 
¡d
::
¡ršg
 &
bË
, cÚ¡ std::¡ršg &
key
, 
Ën
,

77 cÚ¡ 
¡d
::
veùÜ
<¡d::
¡ršg
> *
f›lds
,

78 
¡d
::
veùÜ
<¡d::veùÜ<
F›ld
>> &
»suÉ
);

79 
Stus
 
Upd©eSšgËEÁry
(cÚ¡ 
¡d
::
¡ršg
 &
bË
, cÚ¡ std::¡ršg &
key
,

80 
¡d
::
veùÜ
<
F›ld
> &
v®ues
);

81 
Stus
 
In£¹SšgËEÁry
(cÚ¡ 
¡d
::
¡ršg
 &
bË
, cÚ¡ std::¡ršg &
key
,

82 
¡d
::
veùÜ
<
F›ld
> &
v®ues
);

83 
Stus
 
D–‘eSšgËEÁry
(cÚ¡ 
¡d
::
¡ršg
 &
bË
, cÚ¡ std::¡ršg &
key
);

85 
Stus
 
R—dCompKeyRM
(cÚ¡ 
¡d
::
¡ršg
 &
bË
, cÚ¡ std::¡ršg &
key
,

86 cÚ¡ 
¡d
::
veùÜ
<¡d::
¡ršg
> *
f›lds
, std::veùÜ<
F›ld
> &
»suÉ
);

87 
Stus
 
SÿnCompKeyRM
(cÚ¡ 
¡d
::
¡ršg
 &
bË
, cÚ¡ std::¡ršg &
key
, 
Ën
,

88 cÚ¡ 
¡d
::
veùÜ
<¡d::
¡ršg
> *
f›lds
,

89 
¡d
::
veùÜ
<¡d::veùÜ<
F›ld
>> &
»suÉ
);

90 
Stus
 
R—dCompKeyCM
(cÚ¡ 
¡d
::
¡ršg
 &
bË
, cÚ¡ std::¡ršg &
key
,

91 cÚ¡ 
¡d
::
veùÜ
<¡d::
¡ršg
> *
f›lds
, std::veùÜ<
F›ld
> &
»suÉ
);

92 
Stus
 
SÿnCompKeyCM
(cÚ¡ 
¡d
::
¡ršg
 &
bË
, cÚ¡ std::¡ršg &
key
, 
Ën
,

93 cÚ¡ 
¡d
::
veùÜ
<¡d::
¡ršg
> *
f›lds
,

94 
¡d
::
veùÜ
<¡d::veùÜ<
F›ld
>> &
»suÉ
);

95 
Stus
 
In£¹CompKey
(cÚ¡ 
¡d
::
¡ršg
 &
bË
, cÚ¡ std::¡ršg &
key
,

96 
¡d
::
veùÜ
<
F›ld
> &
v®ues
);

97 
Stus
 
D–‘eCompKey
(cÚ¡ 
¡d
::
¡ršg
 &
bË
, cÚ¡ std::¡ršg &
key
);

99 
Stus
 (
Lev–dbDB
::*
m‘hod_»ad_
)(cÚ¡ 
¡d
::
¡ršg
 &, cÚ¡ 
	g¡d
:: string &,

100 cÚ¡ 
	g¡d
::
veùÜ
<
¡d
::
¡ršg
> *, std::veùÜ<
F›ld
> &);

101 
Stus
 (
Lev–dbDB
::*
m‘hod_sÿn_
)(cÚ¡ 
¡d
::
¡ršg
 &, cÚ¡ 
	g¡d
::string &, ,

102 cÚ¡ 
	g¡d
::
veùÜ
<
¡d
::
¡ršg
> *,

103 
	g¡d
::
veùÜ
<
¡d
::veùÜ<
F›ld
>> &);

104 
Stus
 (
Lev–dbDB
::*
m‘hod_upd©e_
)(cÚ¡ 
¡d
::
¡ršg
 &, cÚ¡ 
	g¡d
::string &,

105 
	g¡d
::
veùÜ
<
F›ld
> &);

106 
Stus
 (
Lev–dbDB
::*
m‘hod_š£¹_
)(cÚ¡ 
¡d
::
¡ršg
 &, cÚ¡ 
	g¡d
::string &,

107 
	g¡d
::
veùÜ
<
F›ld
> &);

108 
Stus
 (
Lev–dbDB
::*
m‘hod_d–‘e_
)(cÚ¡ 
¡d
::
¡ršg
 &, cÚ¡ 
	g¡d
::string &);

110 
	gf›ldcouÁ_
;

111 
	g¡d
::
¡ršg
 
f›ld_´efix_
;

113 
	gËv–db
::
DB
 *
db_
;

114 
	g»f_út_
;

115 
	g¡d
::
mu‹x
 
mu_
;

118 
DB
 *
NewLev–dbDB
();

	@lmdb/lmdb_db.cc

8 
	~<¡ršg.h
>

9 
	~<sys/¡©.h
>

11 
	~"lmdb_db.h
"

12 
	~"cÜe/´İ”t›s.h
"

13 
	~"cÜe/uts.h
"

14 
	~"cÜe/cÜe_wÜklßd.h
"

15 
	~"cÜe/db_çùÜy.h
"

17 
	~<lmdb.h
>

19 
	gÇme¥aû
 {

20 cÚ¡ 
	g¡d
::
¡ršg
 
PROP_DBPATH
 = "lmdb.dbpath";

21 cÚ¡ 
	g¡d
::
¡ršg
 
PROP_DBPATH_DEFAULT
 = "";

23 cÚ¡ 
	g¡d
::
¡ršg
 
PROP_FORMAT
 = "lmdb.format";

24 cÚ¡ 
	g¡d
::
¡ršg
 
PROP_FORMAT_DEFAULT
 = "single";

26 cÚ¡ 
	g¡d
::
¡ršg
 
PROP_MAPSIZE
 = "lmdb.mapsize";

27 cÚ¡ 
	g¡d
::
¡ršg
 
PROP_MAPSIZE_DEFAULT
 = "-1";

29 cÚ¡ 
	g¡d
::
¡ršg
 
PROP_NOSYNC
 = "lmdb.nosync";

30 cÚ¡ 
	g¡d
::
¡ršg
 
PROP_NOSYNC_DEFAULT
 = "false";

32 cÚ¡ 
	g¡d
::
¡ršg
 
PROP_NOMETASYNC
 = "lmdb.nometasync";

33 cÚ¡ 
	g¡d
::
¡ršg
 
PROP_NOMETASYNC_DEFAULT
 = "false";

35 cÚ¡ 
	g¡d
::
¡ršg
 
PROP_NORDAHEAD
 = "lmdb.noreadahead";

36 cÚ¡ 
	g¡d
::
¡ršg
 
PROP_NORDAHEAD_DEFAULT
 = "false";

38 cÚ¡ 
	g¡d
::
¡ršg
 
PROP_WRITEMAP
 = "lmdb.writemap";

39 cÚ¡ 
	g¡d
::
¡ršg
 
PROP_WRITEMAP_DEFAULT
 = "false";

42 
Çme¥aû
 
	gycsbc
 {

44 
MDB_’v
 *
	gLmdbDB
::
’v_
;

45 
MDB_dbi
 
	gLmdbDB
::
dbi_
;

46 
	gLmdbDB
::
»f_út_
 = 0;

47 
	g¡d
::
mu‹x
 
LmdbDB
::
mu‹x_
;

49 
	gLmdbDB
::
In™
() {

50 cÚ¡ 
¡d
::
lock_gu¬d
<¡d::
mu‹x
> 
lock
(
mu‹x_
);

52 cÚ¡ 
	guts
::
Prİ”t›s
 &
´İs
 = *
´İs_
;

53 cÚ¡ 
	g¡d
::
¡ršg
 &
fÜm©
 = 
´İs
.
G‘Prİ”ty
(
PROP_FORMAT
, 
PROP_FORMAT_DEFAULT
);

54 ià(
	gfÜm©
 == "single") {

55 
fÜm©_
 = 
kSšgËEÁry
;

56 
	gm‘hod_»ad_
 = &
LmdbDB
::
R—dSšgËEÁry
;

57 
	gm‘hod_sÿn_
 = &
LmdbDB
::
SÿnSšgËEÁry
;

58 
	gm‘hod_upd©e_
 = &
LmdbDB
::
Upd©eSšgËEÁry
;

59 
	gm‘hod_š£¹_
 = &
LmdbDB
::
In£¹SšgËEÁry
;

60 
	gm‘hod_d–‘e_
 = &
LmdbDB
::
D–‘eSšgËEÁry
;

62 
throw
 
	guts
::
Exû±iÚ
("unknown format");

64 
	gf›ldcouÁ_
 = 
¡d
::
¡oi
(
´İs
.
G‘Prİ”ty
(
CÜeWÜklßd
::
FIELD_COUNT_PROPERTY
,

65 
CÜeWÜklßd
::
FIELD_COUNT_DEFAULT
));

66 
	gf›ld_´efix_
 = 
´İs
.
G‘Prİ”ty
(
CÜeWÜklßd
::
FIELD_NAME_PREFIX
,

67 
CÜeWÜklßd
::
FIELD_NAME_PREFIX_DEFAULT
);

69 ià(
	g»f_út_
++) {

73 
	g»t
;

74 
	g’v_İt
 = 0;

75 ià(
	g´İs
.
G‘Prİ”ty
(
PROP_NOSYNC
, 
PROP_NOSYNC_DEFAULT
) == "true") {

76 
’v_İt
 |ğ
MDB_NOSYNC
;

78 ià(
	g´İs
.
G‘Prİ”ty
(
PROP_NOMETASYNC
, 
PROP_NOMETASYNC_DEFAULT
) == "true") {

79 
’v_İt
 |ğ
MDB_NOMETASYNC
;

81 ià(
	g´İs
.
G‘Prİ”ty
(
PROP_NORDAHEAD
, 
PROP_NORDAHEAD_DEFAULT
) == "true") {

82 
’v_İt
 |ğ
MDB_NORDAHEAD
;

84 ià(
	g´İs
.
G‘Prİ”ty
(
PROP_WRITEMAP
, 
PROP_WRITEMAP_DEFAULT
) == "true") {

85 
’v_İt
 |ğ
MDB_WRITEMAP
;

87 
	g»t
 = 
mdb_’v_ü—‹
(&
’v_
);

88 ià(
	g»t
) {

89 
throw
 
	guts
::
Exû±iÚ
(
¡d
::
¡ršg
("In™ mdb_’v_ü—‹: "è+ 
mdb_¡»¼Ü
(
»t
));

91 
size_t
 
	gm­_size
 = 
¡d
::
¡oul
(
´İs
.
G‘Prİ”ty
(
PROP_MAPSIZE
, 
PROP_MAPSIZE_DEFAULT
));

92 ià(
	gm­_size
 >= 0) {

93 
»t
 = 
mdb_’v_£t_m­size
(
’v_
, 
m­_size
);

94 ià(
	g»t
) {

95 
throw
 
	guts
::
Exû±iÚ
(
¡d
::
¡ršg
("In™ mdb_’v_£t_m­size: "è+ 
mdb_¡»¼Ü
(
»t
));

98 cÚ¡ 
	g¡d
::
¡ršg
 &
db_·th
 = 
´İs
.
G‘Prİ”ty
(
PROP_DBPATH
, 
PROP_DBPATH_DEFAULT
);

99 ià(
	gdb_·th
 == "") {

100 
throw
 
uts
::
Exû±iÚ
("LMDB db…ath is missing");

102 
	g»t
 = 
mkdœ
(
db_·th
.
c_¡r
(), 0775);

103 ià(
	g»t
 && 
	g”ºo
 !ğ
EEXIST
) {

104 
throw
 
uts
::
Exû±iÚ
(
¡d
::
¡ršg
("In™ mkdœ: "è+ 
¡»¼Ü
(
”ºo
));

106 
	g»t
 = 
mdb_’v_İ’
(
’v_
, 
db_·th
.
c_¡r
(), 
’v_İt
, 0664);

107 ià(
	g»t
) {

108 
throw
 
	guts
::
Exû±iÚ
(
¡d
::
¡ršg
("In™ mdb_’v_İ’: "è+ 
mdb_¡»¼Ü
(
»t
));

111 
MDB_txn
 *
	gtxn
;

112 
	g»t
 = 
mdb_txn_begš
(
’v_
, 
nuÎ±r
, 0, &
txn
);

113 ià(
	g»t
) {

114 
throw
 
	guts
::
Exû±iÚ
(
¡d
::
¡ršg
("In™ mdb_txn_begš: "è+ 
mdb_¡»¼Ü
(
»t
));

116 
	g»t
 = 
mdb_İ’
(
txn
, 
nuÎ±r
, 0, &
dbi_
);

117 ià(
	g»t
) {

118 
throw
 
	guts
::
Exû±iÚ
(
¡d
::
¡ršg
("In™ mdb_İ’: "è+ 
mdb_¡»¼Ü
(
»t
));

120 
	g»t
 = 
mdb_txn_comm™
(
txn
);

121 ià(
	g»t
) {

122 
throw
 
	guts
::
Exû±iÚ
(
¡d
::
¡ršg
("In™ mdb_txn_comm™: "è+ 
mdb_¡»¼Ü
(
»t
));

126 
	gLmdbDB
::
CËªup
() {

127 cÚ¡ 
¡d
::
lock_gu¬d
<¡d::
mu‹x
> 
lock
(
mu‹x_
);

128 ià(--
	g»f_út_
) {

131 
mdb_şo£
(
’v_
, 
dbi_
);

132 
mdb_’v_şo£
(
’v_
);

135 
	gLmdbDB
::
S”ŸlizeRow
(cÚ¡ 
¡d
::
veùÜ
<
F›ld
> &
v®ues
, std::
¡ršg
 *
d©a
) {

136 cÚ¡ 
F›ld
 &
f›ld
 : 
v®ues
) {

137 
ušt32_t
 
Ën
 = 
f›ld
.
Çme
.
size
();

138 
	gd©a
->
­³nd
(
»š‹½»t_ÿ¡
<*>(&
Ën
), (
ušt32_t
));

139 
	gd©a
->
­³nd
(
f›ld
.
Çme
.
d©a
(), f›ld.Çme.
size
());

140 
	gËn
 = 
f›ld
.
v®ue
.
size
();

141 
	gd©a
->
­³nd
(
»š‹½»t_ÿ¡
<*>(&
Ën
), (
ušt32_t
));

142 
	gd©a
->
­³nd
(
f›ld
.
v®ue
.
d©a
(), f›ld.v®ue.
size
());

146 
	gLmdbDB
::
De£rŸlizeRowF‹r
(
¡d
::
veùÜ
<
F›ld
> *
v®ues
, cÚ¡ *
d©a_±r
, 
size_t
 
d©a_Ën
,

147 cÚ¡ 
¡d
::
veùÜ
<¡d::
¡ršg
> &
f›lds
) {

148 cÚ¡ *
p
 = 
d©a_±r
;

149 cÚ¡ *
	glim
 = 
p
 + 
d©a_Ën
;

150 
	g¡d
::
veùÜ
<
¡d
::
¡ršg
>::
cÚ¡_™”©Ü
 
f‹r_™”
 = 
f›lds
.
begš
();

151 
	gp
 !ğ
lim
 && 
f‹r_™”
 !ğ
f›lds
.
’d
()) {

152 
as£¹
(
p
 < 
lim
);

153 
ušt32_t
 
	gËn
 = *
»š‹½»t_ÿ¡
<cÚ¡ ušt32_ˆ*>(
p
);

154 
	gp
 +ğ(
ušt32_t
);

155 
	g¡d
::
¡ršg
 
f›ld
(
p
, 
¡©ic_ÿ¡
<cÚ¡ 
size_t
>(
Ën
));

156 
	gp
 +ğ
Ën
;

157 
	gËn
 = *
»š‹½»t_ÿ¡
<cÚ¡ 
ušt32_t
 *>(
p
);

158 
	gp
 +ğ(
ušt32_t
);

159 
	g¡d
::
¡ršg
 
v®ue
(
p
, 
¡©ic_ÿ¡
<cÚ¡ 
size_t
>(
Ën
));

160 
	gp
 +ğ
Ën
;

161 ià(*
	gf‹r_™”
 =ğ
f›ld
) {

162 
v®ues
->
push_back
({
f›ld
, 
v®ue
});

163 
	gf‹r_™”
++;

166 
as£¹
(
v®ues
->
size
(è=ğ
f›lds
.size());

169 
	gLmdbDB
::
De£rŸlizeRow
(
¡d
::
veùÜ
<
F›ld
> *
v®ues
, cÚ¡ *
d©a_±r
, 
size_t
 
d©a_Ën
) {

170 cÚ¡ *
	gp
 = 
d©a_±r
;

171 cÚ¡ *
	glim
 = 
p
 + 
d©a_Ën
;

172 
	gp
 !ğ
lim
) {

173 
as£¹
(
p
 < 
lim
);

174 
ušt32_t
 
	gËn
 = *
»š‹½»t_ÿ¡
<cÚ¡ ušt32_ˆ*>(
p
);

175 
	gp
 +ğ(
ušt32_t
);

176 
	g¡d
::
¡ršg
 
f›ld
(
p
, 
¡©ic_ÿ¡
<cÚ¡ 
size_t
>(
Ën
));

177 
	gp
 +ğ
Ën
;

178 
	gËn
 = *
»š‹½»t_ÿ¡
<cÚ¡ 
ušt32_t
 *>(
p
);

179 
	gp
 +ğ(
ušt32_t
);

180 
	g¡d
::
¡ršg
 
v®ue
(
p
, 
¡©ic_ÿ¡
<cÚ¡ 
size_t
>(
Ën
));

181 
	gp
 +ğ
Ën
;

182 
	gv®ues
->
push_back
({
f›ld
, 
v®ue
});

184 
as£¹
(
v®ues
->
size
(è=ğ
f›ldcouÁ_
);

187 
	gDB
::
Stus
 
LmdbDB
::
R—dSšgËEÁry
(cÚ¡ 
¡d
::
¡ršg
 &
bË
, cÚ¡ std::¡ršg &
key
,

188 cÚ¡ 
¡d
::
veùÜ
<¡d::
¡ršg
> *
f›lds
,

189 
¡d
::
veùÜ
<
F›ld
> &
»suÉ
) {

190 
MDB_txn
 *
txn
;

191 
MDB_v®
 
	gkey_¦iû
, 
	gv®_¦iû
;

193 
	gkey_¦iû
.
	gmv_d©a
 = 
¡©ic_ÿ¡
<*>(
cÚ¡_ÿ¡
<*>(
key
.
d©a
()));

194 
	gkey_¦iû
.
	gmv_size
 = 
key
.
size
();

196 
	g»t
;

197 
	g»t
 = 
mdb_txn_begš
(
’v_
, 
nuÎ±r
, 
MDB_RDONLY
, &
txn
);

198 ià(
	g»t
) {

199 
throw
 
	guts
::
Exû±iÚ
(
¡d
::
¡ršg
("R—d mdb_txn_begš: "è+ 
mdb_¡»¼Ü
(
»t
));

201 
	g»t
 = 
mdb_g‘
(
txn
, 
dbi_
, &
key_¦iû
, &
v®_¦iû
);

202 ià(
	g»t
) {

203 
throw
 
	guts
::
Exû±iÚ
(
¡d
::
¡ršg
("R—d mdb_g‘: "è+ 
mdb_¡»¼Ü
(
»t
));

205 ià(
	gf›lds
 !ğ
nuÎ±r
) {

206 
De£rŸlizeRowF‹r
(&
»suÉ
, 
¡©ic_ÿ¡
<*>(
v®_¦iû
.
mv_d©a
), v®_¦iû.
mv_size
,

207 *
f›lds
);

209 
De£rŸlizeRow
(&
»suÉ
, 
¡©ic_ÿ¡
<*>(
v®_¦iû
.
mv_d©a
), v®_¦iû.
mv_size
);

211 
mdb_txn_abÜt
(
txn
);

212  
	gkOK
;

215 
	gDB
::
Stus
 
LmdbDB
::
SÿnSšgËEÁry
(cÚ¡ 
¡d
::
¡ršg
 &
bË
, cÚ¡ std::¡ršg &
key
, 
Ën
,

216 cÚ¡ 
¡d
::
veùÜ
<¡d::
¡ršg
> *
f›lds
,

217 
¡d
::
veùÜ
<¡d::veùÜ<
F›ld
>> &
»suÉ
) {

218 
MDB_txn
 *
txn
;

219 
MDB_cursÜ
 *
	gcursÜ
;

220 
MDB_v®
 
	gkey_¦iû
, 
	gv®_¦iû
;

222 
	gkey_¦iû
.
	gmv_d©a
 = 
¡©ic_ÿ¡
<*>(
cÚ¡_ÿ¡
<*>(
key
.
d©a
()));

223 
	gkey_¦iû
.
	gmv_size
 = 
key
.
size
();

225 
	g»t
;

226 
	g»t
 = 
mdb_txn_begš
(
’v_
, 
nuÎ±r
, 0, &
txn
);

227 ià(
	g»t
) {

228 
throw
 
	guts
::
Exû±iÚ
(
¡d
::
¡ršg
("SÿÀmdb_txn_begš: "è+ 
mdb_¡»¼Ü
(
»t
));

230 
	g»t
 = 
mdb_cursÜ_İ’
(
txn
, 
dbi_
, &
cursÜ
);

231 ià(
	g»t
) {

232 
throw
 
	guts
::
Exû±iÚ
(
¡d
::
¡ršg
("SÿÀmdb_cursÜ_İ’: "è+ 
mdb_¡»¼Ü
(
»t
));

234 
	g»t
 = 
mdb_cursÜ_g‘
(
cursÜ
, &
key_¦iû
, &
v®_¦iû
, 
MDB_SET
);

235 
as£¹
(
»t
 !ğ
MDB_NOTFOUND
);

236 ià(
	g»t
) {

237 
throw
 
	guts
::
Exû±iÚ
(
¡d
::
¡ršg
("SÿÀmdb_cursÜ_g‘: "è+ 
mdb_¡»¼Ü
(
»t
));

239 
	gi
 = 0; !
	g»t
 && i < 
	gËn
; i++) {

240 
	g»suÉ
.
push_back
(
¡d
::
veùÜ
<
F›ld
>());

241 
	g¡d
::
veùÜ
<
F›ld
> &
v®ues
 = 
»suÉ
.
back
();

242 ià(
	gf›lds
 !ğ
nuÎ±r
) {

243 
De£rŸlizeRowF‹r
(&
v®ues
, 
¡©ic_ÿ¡
<*>(
v®_¦iû
.
mv_d©a
), v®_¦iû.
mv_size
,

244 *
f›lds
);

246 
De£rŸlizeRow
(&
v®ues
, 
¡©ic_ÿ¡
<*>(
v®_¦iû
.
mv_d©a
), v®_¦iû.
mv_size
);

248 
	g»t
 = 
mdb_cursÜ_g‘
(
cursÜ
, &
key_¦iû
, &
v®_¦iû
, 
MDB_NEXT
);

250 
mdb_cursÜ_şo£
(
cursÜ
);

251 
mdb_txn_abÜt
(
txn
);

252  
	gkOK
;

255 
	gDB
::
Stus
 
LmdbDB
::
Upd©eSšgËEÁry
(cÚ¡ 
¡d
::
¡ršg
 &
bË
, cÚ¡ std::¡ršg &
key
,

256 
¡d
::
veùÜ
<
F›ld
> &
v®ues
) {

257 
MDB_txn
 *
txn
;

258 
MDB_v®
 
	gkey_¦iû
, 
	gv®_¦iû
;

260 
	gkey_¦iû
.
	gmv_d©a
 = 
¡©ic_ÿ¡
<*>(
cÚ¡_ÿ¡
<*>(
key
.
d©a
()));

261 
	gkey_¦iû
.
	gmv_size
 = 
key
.
size
();

263 
	g»t
;

264 
	g»t
 = 
mdb_txn_begš
(
’v_
, 
nuÎ±r
, 0, &
txn
);

265 ià(
	g»t
) {

266 
throw
 
	guts
::
Exû±iÚ
(
¡d
::
¡ršg
("Upd©mdb_txn_begš: "è+ 
mdb_¡»¼Ü
(
»t
));

268 
	g»t
 = 
mdb_g‘
(
txn
, 
dbi_
, &
key_¦iû
, &
v®_¦iû
);

269 ià(
	g»t
) {

270 
throw
 
	guts
::
Exû±iÚ
(
¡d
::
¡ršg
("Upd©mdb_g‘: "è+ 
mdb_¡»¼Ü
(
»t
));

272 
	g¡d
::
veùÜ
<
F›ld
> 
cu¼’t_v®ues
;

273 
De£rŸlizeRow
(&
cu¼’t_v®ues
, 
¡©ic_ÿ¡
<*>(
v®_¦iû
.
mv_d©a
), v®_¦iû.
mv_size
);

274 
	gF›ld
 &
	gÃw_f›ld
 : 
v®ues
) {

275 
boŞ
 
found
 
__©Œibu‹__
((
unu£d
)èğ
çl£
;

276 
	gF›ld
 &
	gcur_f›ld
 : 
cu¼’t_v®ues
) {

277 ià(
cur_f›ld
.
Çme
 =ğ
Ãw_f›ld
.name) {

278 
found
 = 
Œue
;

279 
	gcur_f›ld
.
	gv®ue
 = 
Ãw_f›ld
.
v®ue
;

283 
as£¹
(
found
);

286 
	g¡d
::
¡ršg
 
d©a
;

287 
S”ŸlizeRow
(
cu¼’t_v®ues
, &
d©a
);

288 
	gv®_¦iû
.
	gmv_d©a
 = 
cÚ¡_ÿ¡
<*>(
d©a
.data());

289 
	gv®_¦iû
.
	gmv_size
 = 
d©a
.
size
();

290 
	g»t
 = 
mdb_put
(
txn
, 
dbi_
, &
key_¦iû
, &
v®_¦iû
, 0);

291 ià(
	g»t
) {

292 
throw
 
	guts
::
Exû±iÚ
(
¡d
::
¡ršg
("Upd©mdb_put: "è+ 
mdb_¡»¼Ü
(
»t
));

295 
	g»t
 = 
mdb_txn_comm™
(
txn
);

296 ià(
	g»t
) {

297 
throw
 
	guts
::
Exû±iÚ
(
¡d
::
¡ršg
("Upd©mdb_txn_comm™: "è+ 
mdb_¡»¼Ü
(
»t
));

299  
	gkOK
;

302 
	gDB
::
Stus
 
LmdbDB
::
In£¹SšgËEÁry
(cÚ¡ 
¡d
::
¡ršg
 &
bË
, cÚ¡ std::¡ršg &
key
,

303 
¡d
::
veùÜ
<
F›ld
> &
v®ues
) {

304 
MDB_txn
 *
txn
;

305 
MDB_v®
 
	gkey_¦iû
, 
	gv®_¦iû
;

307 
	gkey_¦iû
.
	gmv_d©a
 = 
¡©ic_ÿ¡
<*>(
cÚ¡_ÿ¡
<*>(
key
.
d©a
()));

308 
	gkey_¦iû
.
	gmv_size
 = 
key
.
size
();

310 
	g¡d
::
¡ršg
 
d©a
;

311 
S”ŸlizeRow
(
v®ues
, &
d©a
);

312 
	gv®_¦iû
.
	gmv_d©a
 = 
¡©ic_ÿ¡
<*>(
cÚ¡_ÿ¡
<*>(
d©a
.data()));

313 
	gv®_¦iû
.
	gmv_size
 = 
d©a
.
size
();

315 
	g»t
;

316 
	g»t
 = 
mdb_txn_begš
(
’v_
, 
nuÎ±r
, 0, &
txn
);

317 ià(
	g»t
) {

318 
throw
 
	guts
::
Exû±iÚ
(
¡d
::
¡ršg
("In£¹ mdb_txn_begš: "è+ 
mdb_¡»¼Ü
(
»t
));

320 
	g»t
 = 
mdb_put
(
txn
, 
dbi_
, &
key_¦iû
, &
v®_¦iû
, 0);

321 ià(
	g»t
) {

322 
throw
 
	guts
::
Exû±iÚ
(
¡d
::
¡ršg
("In£¹ mdb_put: "è+ 
mdb_¡»¼Ü
(
»t
));

324 
	g»t
 = 
mdb_txn_comm™
(
txn
);

325 ià(
	g»t
) {

326 
throw
 
	guts
::
Exû±iÚ
(
¡d
::
¡ršg
("In£¹ mdb_txn_comm™: "è+ 
mdb_¡»¼Ü
(
»t
));

328  
	gkOK
;

331 
	gDB
::
Stus
 
LmdbDB
::
D–‘eSšgËEÁry
(cÚ¡ 
¡d
::
¡ršg
 &
bË
, cÚ¡ std::¡ršg &
key
) {

332 
MDB_txn
 *
txn
;

333 
MDB_v®
 
	gkey_¦iû
;

335 
	gkey_¦iû
.
	gmv_d©a
 = 
¡©ic_ÿ¡
<*>(
cÚ¡_ÿ¡
<*>(
key
.
d©a
()));

336 
	gkey_¦iû
.
	gmv_size
 = 
key
.
size
();

338 
	g»t
;

339 
	g»t
 = 
mdb_txn_begš
(
’v_
, 
nuÎ±r
, 0, &
txn
);

340 ià(
	g»t
) {

341 
throw
 
	guts
::
Exû±iÚ
(
¡d
::
¡ršg
("D–‘mdb_txn_begš: "è+ 
mdb_¡»¼Ü
(
»t
));

343 
	g»t
 = 
mdb_d–
(
txn
, 
dbi_
, &
key_¦iû
, 
nuÎ±r
);

344 ià(
	g»t
) {

345 
throw
 
	guts
::
Exû±iÚ
(
¡d
::
¡ršg
("D–‘mdb_d–: "è+ 
mdb_¡»¼Ü
(
»t
));

347 
	g»t
 = 
mdb_txn_comm™
(
txn
);

348 ià(
	g»t
) {

349 
throw
 
	guts
::
Exû±iÚ
(
¡d
::
¡ršg
("D–‘mdb_txn_comm™: "è+ 
mdb_¡»¼Ü
(
»t
));

351  
	gkOK
;

354 
DB
 *
NewLmdbDB
() {

355  
Ãw
 
	gLmdbDB
;

358 cÚ¡ 
boŞ
 
	g»gi¡”ed
 = 
DBFaùÜy
::
Regi¡”DB
("lmdb", 
NewLmdbDB
);

	@lmdb/lmdb_db.h

8 #iâdeà
YCSB_C_LMDB_DB_H_


9 
	#YCSB_C_LMDB_DB_H_


	)

11 
	~<¡ršg
>

12 
	~<mu‹x
>

14 
	~"cÜe/db.h
"

16 
	~<lmdb.h
>

18 
Çme¥aû
 
	gycsbc
 {

20 şas 
	cLmdbDB
 : 
public
 
DB
 {

21 
public
:

22 
LmdbDB
() {}

23 ~
LmdbDB
() {}

25 
In™
();

27 
CËªup
();

29 
Stus
 
R—d
(cÚ¡ 
¡d
::
¡ršg
 &
bË
, cÚ¡ std::¡ršg &
key
,

30 cÚ¡ 
¡d
::
veùÜ
<¡d::
¡ršg
> *
f›lds
, std::veùÜ<
F›ld
> &
»suÉ
) {

31  (
this
->*(
m‘hod_»ad_
))(
bË
, 
	gkey
, 
	gf›lds
, 
	g»suÉ
);

34 
Stus
 
Sÿn
(cÚ¡ 
¡d
::
¡ršg
 &
bË
, cÚ¡ std::¡ršg &
key
, 
Ën
,

35 cÚ¡ 
¡d
::
veùÜ
<¡d::
¡ršg
> *
f›lds
, std::veùÜ<¡d::veùÜ<
F›ld
>> &
»suÉ
) {

36  (
this
->*(
m‘hod_sÿn_
))(
bË
, 
	gkey
, 
	gËn
, 
	gf›lds
, 
	g»suÉ
);

39 
Stus
 
Upd©e
(cÚ¡ 
¡d
::
¡ršg
 &
bË
, cÚ¡ std::¡ršg &
key
, std::
veùÜ
<
F›ld
> &
v®ues
) {

40  (
this
->*(
m‘hod_upd©e_
))(
bË
, 
	gkey
, 
	gv®ues
);

43 
Stus
 
In£¹
(cÚ¡ 
¡d
::
¡ršg
 &
bË
, cÚ¡ std::¡ršg &
key
, std::
veùÜ
<
F›ld
> &
v®ues
) {

44  (
this
->*(
m‘hod_š£¹_
))(
bË
, 
	gkey
, 
	gv®ues
);

47 
Stus
 
D–‘e
(cÚ¡ 
¡d
::
¡ršg
 &
bË
, cÚ¡ std::¡ršg &
key
) {

48  (
this
->*(
m‘hod_d–‘e_
))(
bË
, 
	gkey
);

51 
	g´iv©e
:

52 
	eLmdbFÜm©
 {

53 
kSšgËEÁry
,

54 
	gkRowMajÜ
,

55 
	gkCŞumnMajÜ


57 
LmdbFÜm©
 
	gfÜm©_
;

59 
S”ŸlizeRow
(cÚ¡ 
¡d
::
veùÜ
<
F›ld
> &
v®ues
, std::
¡ršg
 *
d©a
);

60 
De£rŸlizeRowF‹r
(
¡d
::
veùÜ
<
F›ld
> *
v®ues
, cÚ¡ *
d©a_±r
, 
size_t
 
d©a_Ën
,

61 cÚ¡ 
¡d
::
veùÜ
<¡d::
¡ršg
> &
f›lds
);

62 
De£rŸlizeRow
(
¡d
::
veùÜ
<
F›ld
> *
v®ues
, cÚ¡ *
d©a_±r
, 
size_t
 
d©a_Ën
);

64 
Stus
 
R—dSšgËEÁry
(cÚ¡ 
¡d
::
¡ršg
 &
bË
, cÚ¡ std::¡ršg &
key
,

65 cÚ¡ 
¡d
::
veùÜ
<¡d::
¡ršg
> *
f›lds
, std::veùÜ<
F›ld
> &
»suÉ
);

66 
Stus
 
SÿnSšgËEÁry
(cÚ¡ 
¡d
::
¡ršg
 &
bË
, cÚ¡ std::¡ršg &
key
, 
Ën
,

67 cÚ¡ 
¡d
::
veùÜ
<¡d::
¡ršg
> *
f›lds
,

68 
¡d
::
veùÜ
<¡d::veùÜ<
F›ld
>> &
»suÉ
);

69 
Stus
 
Upd©eSšgËEÁry
(cÚ¡ 
¡d
::
¡ršg
 &
bË
, cÚ¡ std::¡ršg &
key
,

70 
¡d
::
veùÜ
<
F›ld
> &
v®ues
);

71 
Stus
 
In£¹SšgËEÁry
(cÚ¡ 
¡d
::
¡ršg
 &
bË
, cÚ¡ std::¡ršg &
key
,

72 
¡d
::
veùÜ
<
F›ld
> &
v®ues
);

73 
Stus
 
D–‘eSšgËEÁry
(cÚ¡ 
¡d
::
¡ršg
 &
bË
, cÚ¡ std::¡ršg &
key
);

75 
Stus
 (
LmdbDB
::*
m‘hod_»ad_
)(cÚ¡ 
¡d
::
¡ršg
 &, cÚ¡ 
	g¡d
:: string &,

76 cÚ¡ 
	g¡d
::
veùÜ
<
¡d
::
¡ršg
> *, std::veùÜ<
F›ld
> &);

77 
Stus
 (
LmdbDB
::*
m‘hod_sÿn_
)(cÚ¡ 
¡d
::
¡ršg
 &, cÚ¡ 
	g¡d
::string &, ,

78 cÚ¡ 
	g¡d
::
veùÜ
<
¡d
::
¡ršg
> *,

79 
	g¡d
::
veùÜ
<
¡d
::veùÜ<
F›ld
>> &);

80 
Stus
 (
LmdbDB
::*
m‘hod_upd©e_
)(cÚ¡ 
¡d
::
¡ršg
 &, cÚ¡ 
	g¡d
::¡ršg &, std::
veùÜ
<
F›ld
> &);

81 
Stus
 (
LmdbDB
::*
m‘hod_š£¹_
)(cÚ¡ 
¡d
::
¡ršg
 &, cÚ¡ 
	g¡d
::¡ršg &, std::
veùÜ
<
F›ld
> &);

82 
Stus
 (
LmdbDB
::*
m‘hod_d–‘e_
)(cÚ¡ 
¡d
::
¡ršg
 &, cÚ¡ 
	g¡d
::string &);

84 
	gf›ldcouÁ_
;

85 
	g¡d
::
¡ršg
 
f›ld_´efix_
;

87 
MDB_’v
 *
	g’v_
;

88 
MDB_dbi
 
	gdbi_
;

89 
	g»f_út_
;

90 
	g¡d
::
mu‹x
 
mu‹x_
;

93 
DB
 *
NewLmdbDB
();

	@remixdb/remixdb_db.cc

8 
	~"»mixdb_db.h
"

10 
	~"cÜe/cÜe_wÜklßd.h
"

11 
	~"cÜe/db_çùÜy.h
"

12 
	~"cÜe/´İ”t›s.h
"

13 
	~"cÜe/uts.h
"

14 
	~"»mixdb/ùy³s.h
"

15 
	~"»mixdb/lib.h
"

16 
	~"»mixdb/kv.h
"

17 
	~"»mixdb/s¡.h
"

18 
	~"»mixdb/xdb.h
"

19 
	~<¡dio.h
>

21 
	gÇme¥aû
 {

22 cÚ¡ 
	g¡d
::
¡ršg
 
PROP_NAME
 = "remixdb.dbname";

23 cÚ¡ 
	g¡d
::
¡ršg
 
PROP_NAME_DEFAULT
 = "";

25 cÚ¡ 
	g¡d
::
¡ršg
 
PROP_FORMAT
 = "remixdb.format";

26 cÚ¡ 
	g¡d
::
¡ršg
 
PROP_FORMAT_DEFAULT
 = "single";

28 cÚ¡ 
	g¡d
::
¡ršg
 
PROP_CACHE_SIZE
 = "remixdb.cachesz";

29 cÚ¡ 
	g¡d
::
¡ršg
 
PROP_CACHE_SIZE_DEFAULT
 = "1024";

31 cÚ¡ 
	g¡d
::
¡ršg
 
PROP_MT_SIZE
 = "remixdb.mtsz";

32 cÚ¡ 
	g¡d
::
¡ršg
 
PROP_MT_SIZE_DEFAULT
 = "1024";

36 
Çme¥aû
 
	gycsbc
 {

38 
xdb
 *
	gRemixdbDB
::
db_
 = 
nuÎ±r
;

40 
	gRemixdbDB
::
»f_út_
 = 0;

41 
	g¡d
::
mu‹x
 
RemixdbDB
::
mu_
;

43 
	gRemixdbDB
::
In™
() {

45 #ifdeà
USE_MERGEUPDATE


46 şas 
	cYCSBUpd©eM”ge
 : {

47 
public
:

48 
vœtu®
 
boŞ
 
M”ge
(cÚ¡ 
rocksdb
::
Sliû
 &
key
, cÚ¡„ocksdb::Sliû *
exi¡šg_v®ue
,

49 cÚ¡ 
rocksdb
::
Sliû
 &
v®ue
, 
¡d
::
¡ršg
 *
Ãw_v®ue
,

50 
rocksdb
::
Logg”
 *
logg”
ècÚ¡ 
ov”ride
 {

51 
as£¹
(
exi¡šg_v®ue
);

53 
	g¡d
::
veùÜ
<
F›ld
> 
v®ues
;

54 cÚ¡ *
	gp
 = 
exi¡šg_v®ue
->
d©a
();

55 cÚ¡ *
	glim
 = 
p
 + 
exi¡šg_v®ue
->
size
();

56 
De£rŸlizeRow
(
v®ues
, 
p
, 
lim
);

58 
	g¡d
::
veùÜ
<
F›ld
> 
Ãw_v®ues
;

59 
	gp
 = 
v®ue
.
d©a
();

60 
	glim
 = 
p
 + 
v®ue
.
size
();

61 
De£rŸlizeRow
(
Ãw_v®ues
, 
p
, 
lim
);

63 
	gF›ld
 &
	gÃw_f›ld
 : 
Ãw_v®ues
) {

64 
boŞ
 
found
 = 
çl£
;

65 
	gF›ld
 &
	gf›ld
 : 
v®ues
) {

66 ià(
f›ld
.
Çme
 =ğ
Ãw_f›ld
.name) {

67 
found
 = 
Œue
;

68 
	gf›ld
.
	gv®ue
 = 
Ãw_f›ld
.
v®ue
;

72 ià(!
	gfound
) {

73 
	gv®ues
.
push_back
(
Ãw_f›ld
);

77 
S”ŸlizeRow
(
v®ues
, *
Ãw_v®ue
);

78  
	gŒue
;

81 
vœtu®
 cÚ¡ *
Name
(ècÚ¡ 
	gov”ride
 {

86 cÚ¡ 
	g¡d
::
lock_gu¬d
<
¡d
::
mu‹x
> 
lock
(
mu_
);

88 cÚ¡ 
	guts
::
Prİ”t›s
 &
´İs
 = *
´İs_
;

89 cÚ¡ 
	g¡d
::
¡ršg
 
fÜm©
 = 
´İs
.
G‘Prİ”ty
(
PROP_FORMAT
, 
PROP_FORMAT_DEFAULT
);

90 ià(
	gfÜm©
 == "single") {

91 
fÜm©_
 = 
kSšgËRow
;

92 
	gm‘hod_»ad_
 = &
RemixdbDB
::
R—dSšgË
;

93 
	gm‘hod_sÿn_
 = &
RemixdbDB
::
SÿnSšgË
;

94 
	gm‘hod_upd©e_
 = &
RemixdbDB
::
Upd©eSšgË
;

95 
	gm‘hod_š£¹_
 = &
RemixdbDB
::
In£¹SšgË
;

96 
	gm‘hod_d–‘e_
 = &
RemixdbDB
::
D–‘eSšgË
;

97 #ifdeà
USE_MERGEUPDATE


98 ià(
	g´İs
.
G‘Prİ”ty
(
PROP_MERGEUPDATE
, 
PROP_MERGEUPDATE_DEFAULT
) == "true") {

99 
m‘hod_upd©e_
 = &
RemixdbDB
::
M”geSšgË
;

103 
throw
 
	guts
::
Exû±iÚ
("unknown format");

105 
	gf›ldcouÁ_
 = 
¡d
::
¡oi
(
´İs
.
G‘Prİ”ty
(
CÜeWÜklßd
::
FIELD_COUNT_PROPERTY
,

106 
CÜeWÜklßd
::
FIELD_COUNT_DEFAULT
));

108 
	g»f_út_
++;

110 ià(!
	gdb_
) {

111 cÚ¡ 
	g¡d
::
¡ršg
 &
db_·th
 = 
´İs
.
G‘Prİ”ty
(
PROP_NAME
, 
PROP_NAME_DEFAULT
);

112 ià(
	gdb_·th
 == "") {

113 
throw
 
uts
::
Exû±iÚ
("Remixdb db…ath is missing");

116 cÚ¡ 
u64
 
	gÿchesz
 = 
a2u64
(
´İs
.
G‘Prİ”ty
(
PROP_CACHE_SIZE
, 
PROP_CACHE_SIZE_DEFAULT
).
c_¡r
());

117 cÚ¡ 
u64
 
	gmtsz
 = 
a2u64
(
´İs
.
G‘Prİ”ty
(
PROP_MT_SIZE
, 
PROP_MT_SIZE_DEFAULT
).
c_¡r
());

119 
´štf
("[DHDEBUG] Mem Size: %ld %ld\n", 
ÿchesz
, 
mtsz
);

121 
	gdb_
 = 
»mixdb_İ’
(
db_·th
.
c_¡r
(), 
ÿchesz
, 
mtsz
, 
Œue
);

122 ià(!
	gdb_
) {

123 
throw
 
	guts
::
Exû±iÚ
(
¡d
::
¡ršg
("Remixdb Open Failed\n"));

127 
	g»f_
 = 
»mixdb_»f
(
db_
);

131 
	gRemixdbDB
::
	$CËªup
() {

132 cÚ¡ 
¡d
::
lock_gu¬d
<¡d::
mu‹x
> 
	`lock
(
mu_
);

134 
	`»mixdb_uÄef
(
»f_
);

135 ià(--
»f_út_
) {

138 
	`»mixdb_şo£
(
db_
);

139 
	}
}

141 
	gRemixdbDB
::
S”ŸlizeRow
(cÚ¡ 
¡d
::
veùÜ
<
F›ld
> &
v®ues
, std::
¡ršg
 &
d©a
) {

142 cÚ¡ 
F›ld
 &
f›ld
 : 
v®ues
) {

143 
ušt32_t
 
Ën
 = 
f›ld
.
Çme
.
size
();

144 
	gd©a
.
­³nd
(
»š‹½»t_ÿ¡
<*>(&
Ën
), (
ušt32_t
));

145 
	gd©a
.
­³nd
(
f›ld
.
Çme
.
d©a
(), f›ld.Çme.
size
());

146 
	gËn
 = 
f›ld
.
v®ue
.
size
();

147 
	gd©a
.
­³nd
(
»š‹½»t_ÿ¡
<*>(&
Ën
), (
ušt32_t
));

148 
	gd©a
.
­³nd
(
f›ld
.
v®ue
.
d©a
(), f›ld.v®ue.
size
());

152 
	gRemixdbDB
::
De£rŸlizeRowF‹r
(
¡d
::
veùÜ
<
F›ld
> &
v®ues
, cÚ¡ *
p
, cÚ¡ *
lim
,

153 cÚ¡ 
¡d
::
veùÜ
<¡d::
¡ršg
> &
f›lds
) {

154 
¡d
::
veùÜ
<¡d::
¡ršg
>::
cÚ¡_™”©Ü
 
f‹r_™”
 = 
f›lds
.
begš
();

155 
	gp
 !ğ
lim
 && 
f‹r_™”
 !ğ
f›lds
.
’d
()) {

156 
as£¹
(
p
 < 
lim
);

157 
ušt32_t
 
	gËn
 = *
»š‹½»t_ÿ¡
<cÚ¡ ušt32_ˆ*>(
p
);

158 
	gp
 +ğ(
ušt32_t
);

159 
	g¡d
::
¡ršg
 
f›ld
(
p
, 
¡©ic_ÿ¡
<cÚ¡ 
size_t
>(
Ën
));

160 
	gp
 +ğ
Ën
;

161 
	gËn
 = *
»š‹½»t_ÿ¡
<cÚ¡ 
ušt32_t
 *>(
p
);

162 
	gp
 +ğ(
ušt32_t
);

163 
	g¡d
::
¡ršg
 
v®ue
(
p
, 
¡©ic_ÿ¡
<cÚ¡ 
size_t
>(
Ën
));

164 
	gp
 +ğ
Ën
;

165 ià(*
	gf‹r_™”
 =ğ
f›ld
) {

166 
v®ues
.
push_back
({
f›ld
, 
v®ue
});

167 
	gf‹r_™”
++;

170 
as£¹
(
v®ues
.
size
(è=ğ
f›lds
.size());

173 
	gRemixdbDB
::
De£rŸlizeRowF‹r
(
¡d
::
veùÜ
<
F›ld
> &
v®ues
, cÚ¡ std::
¡ršg
 &
d©a
,

174 cÚ¡ 
¡d
::
veùÜ
<¡d::
¡ršg
> &
f›lds
) {

175 cÚ¡ *
p
 = 
d©a
.data();

176 cÚ¡ *
	glim
 = 
p
 + 
d©a
.
size
();

177 
De£rŸlizeRowF‹r
(
v®ues
, 
p
, 
lim
, 
f›lds
);

180 
	gRemixdbDB
::
De£rŸlizeRow
(
¡d
::
veùÜ
<
F›ld
> &
v®ues
, cÚ¡ *
p
, cÚ¡ *
lim
) {

181 
	gp
 !ğ
lim
) {

182 
as£¹
(
p
 < 
lim
);

183 
ušt32_t
 
	gËn
 = *
»š‹½»t_ÿ¡
<cÚ¡ ušt32_ˆ*>(
p
);

184 
	gp
 +ğ(
ušt32_t
);

185 
	g¡d
::
¡ršg
 
f›ld
(
p
, 
¡©ic_ÿ¡
<cÚ¡ 
size_t
>(
Ën
));

186 
	gp
 +ğ
Ën
;

187 
	gËn
 = *
»š‹½»t_ÿ¡
<cÚ¡ 
ušt32_t
 *>(
p
);

188 
	gp
 +ğ(
ušt32_t
);

189 
	g¡d
::
¡ršg
 
v®ue
(
p
, 
¡©ic_ÿ¡
<cÚ¡ 
size_t
>(
Ën
));

190 
	gp
 +ğ
Ën
;

191 
	gv®ues
.
push_back
({
f›ld
, 
v®ue
});

195 
	gRemixdbDB
::
De£rŸlizeRow
(
¡d
::
veùÜ
<
F›ld
> &
v®ues
, cÚ¡ std::
¡ršg
 &
d©a
) {

196 cÚ¡ *
p
 = 
d©a
.data();

197 cÚ¡ *
	glim
 = 
p
 + 
d©a
.
size
();

198 
De£rŸlizeRow
(
v®ues
, 
p
, 
lim
);

201 
	gDB
::
Stus
 
RemixdbDB
::
R—dSšgË
(cÚ¡ 
¡d
::
¡ršg
 &
bË
, cÚ¡ std::¡ršg &
key
,

202 cÚ¡ 
¡d
::
veùÜ
<¡d::
¡ršg
> *
f›lds
,

203 
¡d
::
veùÜ
<
F›ld
> &
»suÉ
) {

204 
boŞ
 
r
;

206 
	gvbuf_out
[1024*2];

207 
u32
 
	gvËn_out
;

210 
	gr
 = 
»mixdb_g‘
(
»f_
, (*)
key
.
c_¡r
(), key.
size
(), 
vbuf_out
, &
vËn_out
);

212 ià(!
	gr
) {

213  
	gkNÙFound
;

217 
	g¡d
::
¡ršg
 
d©a
(
¡©ic_ÿ¡
<*>(
vbuf_out
), stic_ÿ¡<cÚ¡ 
size_t
>(
vËn_out
));

219 ià(
	gf›lds
 !ğ
nuÎ±r
) {

220 
De£rŸlizeRowF‹r
(
»suÉ
, 
d©a
, *
f›lds
);

222 
De£rŸlizeRow
(
»suÉ
, 
d©a
);

223 
as£¹
(
»suÉ
.
size
(è=ğ
¡©ic_ÿ¡
<
size_t
>(
f›ldcouÁ_
));

226  
	gkOK
;

229 
	gDB
::
Stus
 
RemixdbDB
::
SÿnSšgË
(cÚ¡ 
¡d
::
¡ršg
 &
bË
, cÚ¡ std::¡ršg &
key
, 
Ën
,

230 cÚ¡ 
¡d
::
veùÜ
<¡d::
¡ršg
> *
f›lds
,

231 
¡d
::
veùÜ
<¡d::veùÜ<
F›ld
>> &
»suÉ
) {

232 
kbuf_out
[1024];

233 
	gvbuf_out
[1024];

234 
u32
 
	gkËn_out
;

235 
u32
 
	gvËn_out
;

236 
xdb_™”
* cÚ¡ 
	gdb_™”
 = 
»mixdb_™”_ü—‹
(
»f_
);

238 
»mixdb_™”_£ek
(
db_™”
, (*)
key
.
c_¡r
(), key.
size
());

240 
	gi
 = 0; 
»mixdb_™”_v®id
(
db_™”
è&& i < 
	gËn
; i++) {

241 
»mixdb_™”_³ek
(
db_™”
, 
kbuf_out
, &
kËn_out
, 
vbuf_out
, &
vËn_out
);

242 
	g¡d
::
¡ršg
 
d©a
(
¡©ic_ÿ¡
<*>(
vbuf_out
), stic_ÿ¡<cÚ¡ 
size_t
>(
vËn_out
));

244 
	g»suÉ
.
push_back
(
¡d
::
veùÜ
<
F›ld
>());

245 
	g¡d
::
veùÜ
<
F›ld
> &
v®ues
 = 
»suÉ
.
back
();

246 ià(
	gf›lds
 !ğ
nuÎ±r
) {

247 
De£rŸlizeRowF‹r
(
v®ues
, 
d©a
, *
f›lds
);

249 
De£rŸlizeRow
(
v®ues
, 
d©a
);

250 
as£¹
(
v®ues
.
size
(è=ğ
¡©ic_ÿ¡
<
size_t
>(
f›ldcouÁ_
));

252 
»mixdb_™”_sk1
(
db_™”
);

255 
»mixdb_™”_de¡roy
(
db_™”
);

256  
	gkOK
;

259 
	gDB
::
Stus
 
RemixdbDB
::
Upd©eSšgË
(cÚ¡ 
¡d
::
¡ršg
 &
bË
, cÚ¡ std::¡ršg &
key
,

260 
¡d
::
veùÜ
<
F›ld
> &
v®ues
) {

261 
boŞ
 
r
;

263 
	gout
[1024*2];

264 
u32
 
	gvËn_out
 = 0;

265 
	gr
 = 
»mixdb_g‘
(
»f_
, (*)
key
.
c_¡r
(), key.
size
(), 
out
, &
vËn_out
 );

266 ià(!
	gr
) {

267  
	gkNÙFound
;

269 
	g¡d
::
¡ršg
 
d©a
(
¡©ic_ÿ¡
<*>(
out
), stic_ÿ¡<cÚ¡ 
size_t
>(
vËn_out
));

271 
	g¡d
::
veùÜ
<
F›ld
> 
cu¼’t_v®ues
;

272 
De£rŸlizeRow
(
cu¼’t_v®ues
, 
d©a
);

273 
as£¹
(
cu¼’t_v®ues
.
size
(è=ğ
¡©ic_ÿ¡
<
size_t
>(
f›ldcouÁ_
));

274 
	gF›ld
 &
	gÃw_f›ld
 : 
v®ues
) {

275 
boŞ
 
found
 
__©Œibu‹__
((
unu£d
)èğ
çl£
;

276 
	gF›ld
 &
	gcur_f›ld
 : 
cu¼’t_v®ues
) {

277 ià(
cur_f›ld
.
Çme
 =ğ
Ãw_f›ld
.name) {

278 
found
 = 
Œue
;

279 
	gcur_f›ld
.
	gv®ue
 = 
Ãw_f›ld
.
v®ue
;

283 
as£¹
(
found
);

286 
	gd©a
.
ş—r
();

287 
S”ŸlizeRow
(
cu¼’t_v®ues
, 
d©a
);

288 
	gr
 = 
»mixdb_put
(
»f_
, (*)
key
.
c_¡r
(), key.
size
(), (*)
d©a
.c_str(), data.size());

289 ià(!
	gr
) {

290 
throw
 
	guts
::
Exû±iÚ
(
¡d
::
¡ršg
("Remixdb Put: ")+ 
key
);

293  
	gkOK
;

296 
	gDB
::
Stus
 
RemixdbDB
::
M”geSšgË
(cÚ¡ 
¡d
::
¡ršg
 &
bË
, cÚ¡ std::¡ršg &
key
,

297 
¡d
::
veùÜ
<
F›ld
> &
v®ues
) {

298 
årštf
(
¡d”r
, "RemixDB does‚ot support Merge\n");

299  
	gkE¼Ü
;

302 
	gDB
::
Stus
 
RemixdbDB
::
In£¹SšgË
(cÚ¡ 
¡d
::
¡ršg
 &
bË
, cÚ¡ std::¡ršg &
key
,

303 
¡d
::
veùÜ
<
F›ld
> &
v®ues
) {

304 
¡d
::
¡ršg
 
d©a
;

305 
S”ŸlizeRow
(
v®ues
, 
d©a
);

307 
»mixdb_put
(
»f_
, (*)
key
.
c_¡r
(), key.
size
(), (*)
d©a
.c_str(), data.size());

308  
	gkOK
;

311 
	gDB
::
Stus
 
RemixdbDB
::
	$D–‘eSšgË
(cÚ¡ 
¡d
::
¡ršg
 &
bË
, cÚ¡ std::¡ršg &
key
) {

312 
	`»mixdb_d–
(
»f_
, (*)
key
.
	`c_¡r
(), key.
	`size
());

313  
kOK
;

314 
	}
}

316 
DB
 *
	$NewRemixdbDB
() {

317  
Ãw
 
RemixdbDB
;

318 
	}
}

320 cÚ¡ 
boŞ
 
	g»gi¡”ed
 = 
DBFaùÜy
::
Regi¡”DB
("»mixdb", 
NewRemixdbDB
);

	@remixdb/remixdb_db.h

8 #iâdeà
YCSB_C_REMIXDB_DB_H_


9 
	#YCSB_C_REMIXDB_DB_H_


	)

11 
	~<¡ršg
>

12 
	~<mu‹x
>

14 
	~"cÜe/db.h
"

15 
	~"cÜe/´İ”t›s.h
"

16 
	~"»mixdb/ùy³s.h
"

17 
	~"»mixdb/lib.h
"

18 
	~"»mixdb/kv.h
"

19 
	~"»mixdb/s¡.h
"

20 
	~"»mixdb/xdb.h
"

21 
Çme¥aû
 
	gycsbc
 {

23 şas 
	cRemixdbDB
 : 
public
 
DB
 {

24 
public
:

25 
RemixdbDB
() {}

26 ~
RemixdbDB
() {}

28 
In™
();

30 
CËªup
();

32 
Stus
 
R—d
(cÚ¡ 
¡d
::
¡ršg
 &
bË
, cÚ¡ std::¡ršg &
key
,

33 cÚ¡ 
¡d
::
veùÜ
<¡d::
¡ršg
> *
f›lds
, std::veùÜ<
F›ld
> &
»suÉ
) {

34  (
this
->*(
m‘hod_»ad_
))(
bË
, 
	gkey
, 
	gf›lds
, 
	g»suÉ
);

37 
Stus
 
Sÿn
(cÚ¡ 
¡d
::
¡ršg
 &
bË
, cÚ¡ std::¡ršg &
key
, 
Ën
,

38 cÚ¡ 
¡d
::
veùÜ
<¡d::
¡ršg
> *
f›lds
, std::veùÜ<¡d::veùÜ<
F›ld
>> &
»suÉ
) {

39  (
this
->*(
m‘hod_sÿn_
))(
bË
, 
	gkey
, 
	gËn
, 
	gf›lds
, 
	g»suÉ
);

42 
Stus
 
Upd©e
(cÚ¡ 
¡d
::
¡ršg
 &
bË
, cÚ¡ std::¡ršg &
key
, std::
veùÜ
<
F›ld
> &
v®ues
) {

43  (
this
->*(
m‘hod_upd©e_
))(
bË
, 
	gkey
, 
	gv®ues
);

46 
Stus
 
In£¹
(cÚ¡ 
¡d
::
¡ršg
 &
bË
, cÚ¡ std::¡ršg &
key
, std::
veùÜ
<
F›ld
> &
v®ues
) {

47  (
this
->*(
m‘hod_š£¹_
))(
bË
, 
	gkey
, 
	gv®ues
);

50 
Stus
 
D–‘e
(cÚ¡ 
¡d
::
¡ršg
 &
bË
, cÚ¡ std::¡ršg &
key
) {

51  (
this
->*(
m‘hod_d–‘e_
))(
bË
, 
	gkey
);

54 
	g´iv©e
:

55 
	eRemixFÜm©
 {

56 
kSšgËRow
,

58 
RemixFÜm©
 
	gfÜm©_
;

60 
S”ŸlizeRow
(cÚ¡ 
¡d
::
veùÜ
<
F›ld
> &
v®ues
, std::
¡ršg
 &
d©a
);

61 
De£rŸlizeRowF‹r
(
¡d
::
veùÜ
<
F›ld
> &
v®ues
, cÚ¡ *
p
, cÚ¡ *
lim
,

62 cÚ¡ 
¡d
::
veùÜ
<¡d::
¡ršg
> &
f›lds
);

63 
De£rŸlizeRowF‹r
(
¡d
::
veùÜ
<
F›ld
> &
v®ues
, cÚ¡ std::
¡ršg
 &
d©a
,

64 cÚ¡ 
¡d
::
veùÜ
<¡d::
¡ršg
> &
f›lds
);

65 
De£rŸlizeRow
(
¡d
::
veùÜ
<
F›ld
> &
v®ues
, cÚ¡ *
p
, cÚ¡ *
lim
);

66 
De£rŸlizeRow
(
¡d
::
veùÜ
<
F›ld
> &
v®ues
, cÚ¡ std::
¡ršg
 &
d©a
);

68 
Stus
 
R—dSšgË
(cÚ¡ 
¡d
::
¡ršg
 &
bË
, cÚ¡ std::¡ršg &
key
,

69 cÚ¡ 
¡d
::
veùÜ
<¡d::
¡ršg
> *
f›lds
, std::veùÜ<
F›ld
> &
»suÉ
);

70 
Stus
 
SÿnSšgË
(cÚ¡ 
¡d
::
¡ršg
 &
bË
, cÚ¡ std::¡ršg &
key
, 
Ën
,

71 cÚ¡ 
¡d
::
veùÜ
<¡d::
¡ršg
> *
f›lds
,

72 
¡d
::
veùÜ
<¡d::veùÜ<
F›ld
>> &
»suÉ
);

73 
Stus
 
Upd©eSšgË
(cÚ¡ 
¡d
::
¡ršg
 &
bË
, cÚ¡ std::¡ršg &
key
,

74 
¡d
::
veùÜ
<
F›ld
> &
v®ues
);

75 
Stus
 
M”geSšgË
(cÚ¡ 
¡d
::
¡ršg
 &
bË
, cÚ¡ std::¡ršg &
key
,

76 
¡d
::
veùÜ
<
F›ld
> &
v®ues
);

77 
Stus
 
In£¹SšgË
(cÚ¡ 
¡d
::
¡ršg
 &
bË
, cÚ¡ std::¡ršg &
key
,

78 
¡d
::
veùÜ
<
F›ld
> &
v®ues
);

79 
Stus
 
D–‘eSšgË
(cÚ¡ 
¡d
::
¡ršg
 &
bË
, cÚ¡ std::¡ršg &
key
);

81 
Stus
 (
RemixdbDB
::*
m‘hod_»ad_
)(cÚ¡ 
¡d
::
¡ršg
 &, cÚ¡ 
	g¡d
:: string &,

82 cÚ¡ 
	g¡d
::
veùÜ
<
¡d
::
¡ršg
> *, std::veùÜ<
F›ld
> &);

83 
Stus
 (
RemixdbDB
::*
m‘hod_sÿn_
)(cÚ¡ 
¡d
::
¡ršg
 &, cÚ¡ 
	g¡d
::string &,

84 , cÚ¡ 
	g¡d
::
veùÜ
<
¡d
::
¡ršg
> *,

85 
	g¡d
::
veùÜ
<
¡d
::veùÜ<
F›ld
>> &);

86 
Stus
 (
RemixdbDB
::*
m‘hod_upd©e_
)(cÚ¡ 
¡d
::
¡ršg
 &, cÚ¡ 
	g¡d
::string &,

87 
	g¡d
::
veùÜ
<
F›ld
> &);

88 
Stus
 (
RemixdbDB
::*
m‘hod_š£¹_
)(cÚ¡ 
¡d
::
¡ršg
 &, cÚ¡ 
	g¡d
::string &,

89 
	g¡d
::
veùÜ
<
F›ld
> &);

90 
Stus
 (
RemixdbDB
::*
m‘hod_d–‘e_
)(cÚ¡ 
¡d
::
¡ršg
 &, cÚ¡ 
	g¡d
::string &);

92 
	gf›ldcouÁ_
;

93 
xdb
* 
	gdb_
;

99 
xdb_»f
* 
	g»f_
 = 
nuÎ±r
;

100 
	g»f_út_
;

101 
	g¡d
::
mu‹x
 
mu_
;

104 
DB
 *
NewRemixdbDB
();

	@rocksdb/rocksdb_db.cc

8 
	~"rocksdb_db.h
"

11 
	~"cÜe/cÜe_wÜklßd.h
"

12 
	~"cÜe/db_çùÜy.h
"

13 
	~"cÜe/´İ”t›s.h
"

14 
	~"cÜe/uts.h
"

16 
	~<rocksdb/ÿche.h
>

17 
	~<rocksdb/m”ge_İ”©Ü.h
>

18 
	~<rocksdb/¡©us.h
>

19 
	~<rocksdb/ut™›s/İtiÚs_ut.h
>

20 
	~<rocksdb/wr™e_b©ch.h
>

21 
	~<io¡»am
>

28 
	gÇme¥aû
 {

29 cÚ¡ 
	g¡d
::
¡ršg
 
PROP_NAME
 = "rocksdb.dbname";

30 cÚ¡ 
	g¡d
::
¡ršg
 
PROP_NAME_DEFAULT
 = "";

32 cÚ¡ 
	g¡d
::
¡ršg
 
PROP_BLUEFS_ENABLED
 = "bluefs.enabled";

33 cÚ¡ 
	g¡d
::
¡ršg
 
PROP_BLUEFS_ENABLED_DEFAULT
 = "false";

35 cÚ¡ 
	g¡d
::
¡ršg
 
PROP_FORMAT
 = "rocksdb.format";

36 cÚ¡ 
	g¡d
::
¡ršg
 
PROP_FORMAT_DEFAULT
 = "single";

38 cÚ¡ 
	g¡d
::
¡ršg
 
PROP_MERGEUPDATE
 = "rocksdb.mergeupdate";

39 cÚ¡ 
	g¡d
::
¡ršg
 
PROP_MERGEUPDATE_DEFAULT
 = "false";

41 cÚ¡ 
	g¡d
::
¡ršg
 
PROP_DESTROY
 = "rocksdb.destroy";

42 cÚ¡ 
	g¡d
::
¡ršg
 
PROP_DESTROY_DEFAULT
 = "false";

44 cÚ¡ 
	g¡d
::
¡ršg
 
PROP_COMPRESSION
 = "rocksdb.compression";

45 cÚ¡ 
	g¡d
::
¡ršg
 
PROP_COMPRESSION_DEFAULT
 = "no";

47 cÚ¡ 
	g¡d
::
¡ršg
 
PROP_MAX_BG_JOBS
 = "rocksdb.max_background_jobs";

48 cÚ¡ 
	g¡d
::
¡ršg
 
PROP_MAX_BG_JOBS_DEFAULT
 = "0";

50 cÚ¡ 
	g¡d
::
¡ršg
 
PROP_TARGET_FILE_SIZE_BASE
 = "rocksdb.target_file_size_base";

51 cÚ¡ 
	g¡d
::
¡ršg
 
PROP_TARGET_FILE_SIZE_BASE_DEFAULT
 = "0";

53 cÚ¡ 
	g¡d
::
¡ršg
 
PROP_TARGET_FILE_SIZE_MULT
 = "rocksdb.target_file_size_multiplier";

54 cÚ¡ 
	g¡d
::
¡ršg
 
PROP_TARGET_FILE_SIZE_MULT_DEFAULT
 = "0";

56 cÚ¡ 
	g¡d
::
¡ršg
 
PROP_MAX_BYTES_FOR_LEVEL_BASE
 = "rocksdb.max_bytes_for_level_base";

57 cÚ¡ 
	g¡d
::
¡ršg
 
PROP_MAX_BYTES_FOR_LEVEL_BASE_DEFAULT
 = "0";

59 cÚ¡ 
	g¡d
::
¡ršg
 
PROP_WRITE_BUFFER_SIZE
 = "rocksdb.write_buffer_size";

60 cÚ¡ 
	g¡d
::
¡ršg
 
PROP_WRITE_BUFFER_SIZE_DEFAULT
 = "0";

62 cÚ¡ 
	g¡d
::
¡ršg
 
PROP_MAX_WRITE_BUFFER
 = "rocksdb.max_write_buffer_number";

63 cÚ¡ 
	g¡d
::
¡ršg
 
PROP_MAX_WRITE_BUFFER_DEFAULT
 = "0";

65 cÚ¡ 
	g¡d
::
¡ršg
 
PROP_COMPACTION_PRI
 = "rocksdb.compaction_pri";

66 cÚ¡ 
	g¡d
::
¡ršg
 
PROP_COMPACTION_PRI_DEFAULT
 = "-1";

68 cÚ¡ 
	g¡d
::
¡ršg
 
PROP_CACHE_SIZE
 = "rocksdb.cache_size";

69 cÚ¡ 
	g¡d
::
¡ršg
 
PROP_CACHE_SIZE_DEFAULT
 = "0";

71 cÚ¡ 
	g¡d
::
¡ršg
 
PROP_INCREASE_PARALLELISM
 = "rocksdb.increase_parallelism";

72 cÚ¡ 
	g¡d
::
¡ršg
 
PROP_INCREASE_PARALLELISM_DEFAULT
 = "false";

74 cÚ¡ 
	g¡d
::
¡ršg
 
PROP_OPTIMIZE_LEVELCOMP
 = "rocksdb.optimize_level_style_compaction";

75 cÚ¡ 
	g¡d
::
¡ršg
 
PROP_OPTIMIZE_LEVELCOMP_DEFAULT
 = "false";

77 cÚ¡ 
	g¡d
::
¡ršg
 
PROP_OPTIONS_FILE
 = "rocksdb.optionsfile";

78 cÚ¡ 
	g¡d
::
¡ršg
 
PROP_OPTIONS_FILE_DEFAULT
 = "";

80 cÚ¡ 
	g¡d
::
¡ršg
 
PROP_ENV_URI
 = "rocksdb.env_uri";

81 cÚ¡ 
	g¡d
::
¡ršg
 
PROP_ENV_URI_DEFAULT
 = "";

83 cÚ¡ 
	g¡d
::
¡ršg
 
PROP_FS_URI
 = "rocksdb.fs_uri";

84 cÚ¡ 
	g¡d
::
¡ršg
 
PROP_FS_URI_DEFAULT
 = "";

86 
	g¡d
::
sh¬ed_±r
<
rocksdb
::
Env
> 
’v_gu¬d
;

87 
	g¡d
::
sh¬ed_±r
<
rocksdb
::
Cache
> 
block_ÿche
;

90 
Çme¥aû
 
	gycsbc
 {

92 
	grocksdb
::
DB
 *
RocksdbDB
::
db_
 = 
nuÎ±r
;

93 
	gRocksdbDB
::
»f_út_
 = 0;

94 
	g¡d
::
mu‹x
 
RocksdbDB
::
mu_
;

97 
	gRocksdbDB
::
In™
() {

99 #ifdeà
USE_MERGEUPDATE


100 şas 
	cYCSBUpd©eM”ge
 : 
public
 
rocksdb
::
AssocŸtiveM”geO³¿tÜ
 {

101 
public
:

102 
vœtu®
 
boŞ
 
M”ge
(cÚ¡ 
rocksdb
::
Sliû
 &
key
, cÚ¡„ocksdb::Sliû *
exi¡šg_v®ue
,

103 cÚ¡ 
rocksdb
::
Sliû
 &
v®ue
, 
¡d
::
¡ršg
 *
Ãw_v®ue
,

104 
rocksdb
::
Logg”
 *
logg”
ècÚ¡ 
ov”ride
 {

105 
as£¹
(
exi¡šg_v®ue
);

107 
	g¡d
::
veùÜ
<
F›ld
> 
v®ues
;

108 cÚ¡ *
	gp
 = 
exi¡šg_v®ue
->
d©a
();

109 cÚ¡ *
	glim
 = 
p
 + 
exi¡šg_v®ue
->
size
();

110 
De£rŸlizeRow
(
v®ues
, 
p
, 
lim
);

112 
	g¡d
::
veùÜ
<
F›ld
> 
Ãw_v®ues
;

113 
	gp
 = 
v®ue
.
d©a
();

114 
	glim
 = 
p
 + 
v®ue
.
size
();

115 
De£rŸlizeRow
(
Ãw_v®ues
, 
p
, 
lim
);

117 
	gF›ld
 &
	gÃw_f›ld
 : 
Ãw_v®ues
) {

118 
boŞ
 
found
 = 
çl£
;

119 
	gF›ld
 &
	gf›ld
 : 
v®ues
) {

120 ià(
f›ld
.
Çme
 =ğ
Ãw_f›ld
.name) {

121 
found
 = 
Œue
;

122 
	gf›ld
.
	gv®ue
 = 
Ãw_f›ld
.
v®ue
;

126 ià(!
	gfound
) {

127 
	gv®ues
.
push_back
(
Ãw_f›ld
);

131 
S”ŸlizeRow
(
v®ues
, *
Ãw_v®ue
);

132  
	gŒue
;

135 
vœtu®
 cÚ¡ *
Name
(ècÚ¡ 
	gov”ride
 {

140 cÚ¡ 
	g¡d
::
lock_gu¬d
<
¡d
::
mu‹x
> 
lock
(
mu_
);

142 cÚ¡ 
	guts
::
Prİ”t›s
 &
´İs
 = *
´İs_
;

143 cÚ¡ 
	g¡d
::
¡ršg
 
fÜm©
 = 
´İs
.
G‘Prİ”ty
(
PROP_FORMAT
, 
PROP_FORMAT_DEFAULT
);

144 ià(
	gfÜm©
 == "single") {

145 
fÜm©_
 = 
kSšgËRow
;

146 
	gm‘hod_»ad_
 = &
RocksdbDB
::
R—dSšgË
;

147 
	gm‘hod_sÿn_
 = &
RocksdbDB
::
SÿnSšgË
;

148 
	gm‘hod_upd©e_
 = &
RocksdbDB
::
Upd©eSšgË
;

149 
	gm‘hod_š£¹_
 = &
RocksdbDB
::
In£¹SšgË
;

150 
	gm‘hod_d–‘e_
 = &
RocksdbDB
::
D–‘eSšgË
;

151 #ifdeà
USE_MERGEUPDATE


152 ià(
	g´İs
.
G‘Prİ”ty
(
PROP_MERGEUPDATE
, 
PROP_MERGEUPDATE_DEFAULT
) == "true") {

153 
m‘hod_upd©e_
 = &
RocksdbDB
::
M”geSšgË
;

157 
throw
 
	guts
::
Exû±iÚ
("unknown format");

159 
	gf›ldcouÁ_
 = 
¡d
::
¡oi
(
´İs
.
G‘Prİ”ty
(
CÜeWÜklßd
::
FIELD_COUNT_PROPERTY
,

160 
CÜeWÜklßd
::
FIELD_COUNT_DEFAULT
));

162 
	g»f_út_
++;

163 ià(
	gdb_
) {

167 cÚ¡ 
	g¡d
::
¡ršg
 &
db_·th
 = 
´İs
.
G‘Prİ”ty
(
PROP_NAME
, 
PROP_NAME_DEFAULT
);

168 ià(
	gdb_·th
 == "") {

169 
throw
 
uts
::
Exû±iÚ
("RocksDB db…ath is missing");

172 
	grocksdb
::
O±iÚs
 
İt
;

173 
	gİt
.
	gü—‹_if_missšg
 = 
Œue
;

174 
	g¡d
::
veùÜ
<
rocksdb
::
CŞumnFamyDesütÜ
> 
cf_descs
;

175 
	g¡d
::
veùÜ
<
rocksdb
::
CŞumnFamyHªdË
 *> 
cf_hªdËs
;

176 
G‘O±iÚs
(
´İs
, &
İt
, &
cf_descs
);

177 #ifdeà
USE_MERGEUPDATE


178 
	gİt
.
	gm”ge_İ”©Ü
.
»£t
(
Ãw
 
YCSBUpd©eM”ge
);

181 
	grocksdb
::
Stus
 
s
;

182 ià(
	g´İs
.
G‘Prİ”ty
(
PROP_DESTROY
, 
PROP_DESTROY_DEFAULT
) == "true") {

183 
s
 = 
rocksdb
::
De¡royDB
(
db_·th
, 
İt
);

184 ià(!
	gs
.
ok
()) {

185 
throw
 
	guts
::
Exû±iÚ
(
¡d
::
¡ršg
("RocksDB De¡royDB: "è+ 
s
.
ToSŒšg
());

188 ià(
	gcf_descs
.
em±y
()) {

189 
	gs
 = 
rocksdb
::
DB
::
O³n
(
İt
, 
db_·th
, &
db_
);

191 
	gs
 = 
rocksdb
::
DB
::
O³n
(
İt
, 
db_·th
, 
cf_descs
, &
cf_hªdËs
, &
db_
);

193 ià(!
	gs
.
ok
()) {

194 
throw
 
	guts
::
Exû±iÚ
(
¡d
::
¡ršg
("RocksDB O³n: "è+ 
s
.
ToSŒšg
());

198 
	gRocksdbDB
::
	$CËªup
() {

199 cÚ¡ 
¡d
::
lock_gu¬d
<¡d::
mu‹x
> 
	`lock
(
mu_
);

200 ià(--
»f_út_
) {

203 
d–‘e
 
db_
;

204 
	}
}

206 
	gRocksdbDB
::
G‘O±iÚs
(cÚ¡ 
uts
::
Prİ”t›s
 &
´İs
, 
rocksdb
::
O±iÚs
 *
İt
,

207 
¡d
::
veùÜ
<
rocksdb
::
CŞumnFamyDesütÜ
> *
cf_descs
) {

208 
¡d
::
¡ršg
 
’v_uri
 = 
´İs
.
G‘Prİ”ty
(
PROP_ENV_URI
, 
PROP_ENV_URI_DEFAULT
);

209 
	g¡d
::
¡ršg
 
fs_uri
 = 
´İs
.
G‘Prİ”ty
(
PROP_FS_URI
, 
PROP_FS_URI_DEFAULT
);

210 
	grocksdb
::
Env
* 
’v
;

211 
	g’v
 = 
rocksdb
::
Env
::
DeçuÉ
();

213 cÚ¡ 
	g¡d
::
¡ršg
 
İtiÚs_fe
 = 
´İs
.
G‘Prİ”ty
(
PROP_OPTIONS_FILE
, 
PROP_OPTIONS_FILE_DEFAULT
);

215 ià(
	gİtiÚs_fe
 != "") {

216 
rocksdb
::
Stus
 
s
 =„ocksdb::
LßdO±iÚsFromFe
(
İtiÚs_fe
, 
’v
, 
İt
, 
cf_descs
);

217 ià(!
	gs
.
ok
()) {

218 
throw
 
	guts
::
Exû±iÚ
(
¡d
::
¡ršg
("RocksDB LßdO±iÚsFromFe: "è+ 
s
.
ToSŒšg
());

221 cÚ¡ 
	g¡d
::
¡ršg
 
com´essiÚ_ty³
 = 
´İs
.
G‘Prİ”ty
(
PROP_COMPRESSION
,

222 
PROP_COMPRESSION_DEFAULT
);

223 ià(
	gcom´essiÚ_ty³
 == "no") {

224 
İt
->
com´essiÚ
 = 
rocksdb
::
kNoCom´essiÚ
;

225 } ià(
	gcom´essiÚ_ty³
 == "snappy") {

226 
İt
->
com´essiÚ
 = 
rocksdb
::
kSÇµyCom´essiÚ
;

227 } ià(
	gcom´essiÚ_ty³
 == "zlib") {

228 
İt
->
com´essiÚ
 = 
rocksdb
::
kZlibCom´essiÚ
;

229 } ià(
	gcom´essiÚ_ty³
 == "bzip2") {

230 
İt
->
com´essiÚ
 = 
rocksdb
::
kBZ2Com´essiÚ
;

231 } ià(
	gcom´essiÚ_ty³
 == "lz4") {

232 
İt
->
com´essiÚ
 = 
rocksdb
::
kLZ4Com´essiÚ
;

233 } ià(
	gcom´essiÚ_ty³
 == "lz4hc") {

234 
İt
->
com´essiÚ
 = 
rocksdb
::
kLZ4HCCom´essiÚ
;

235 } ià(
	gcom´essiÚ_ty³
 == "xpress") {

236 
İt
->
com´essiÚ
 = 
rocksdb
::
kX´essCom´essiÚ
;

237 } ià(
	gcom´essiÚ_ty³
 == "zstd") {

238 
İt
->
com´essiÚ
 = 
rocksdb
::
kZSTD
;

240 
throw
 
	guts
::
Exû±iÚ
("Unknown compressionype");

243 
	gv®
 = 
¡d
::
¡oi
(
´İs
.
G‘Prİ”ty
(
PROP_MAX_BG_JOBS
, 
PROP_MAX_BG_JOBS_DEFAULT
));

244 ià(
	gv®
 != 0) {

245 
İt
->
max_background_jobs
 = 
v®
;

247 
	gv®
 = 
¡d
::
¡oi
(
´İs
.
G‘Prİ”ty
(
PROP_TARGET_FILE_SIZE_BASE
, 
PROP_TARGET_FILE_SIZE_BASE_DEFAULT
));

248 ià(
	gv®
 != 0) {

249 
İt
->
rg‘_fe_size_ba£
 = 
v®
;

251 
	gv®
 = 
¡d
::
¡oi
(
´İs
.
G‘Prİ”ty
(
PROP_TARGET_FILE_SIZE_MULT
, 
PROP_TARGET_FILE_SIZE_MULT_DEFAULT
));

252 ià(
	gv®
 != 0) {

253 
İt
->
rg‘_fe_size_muÉl›r
 = 
v®
;

255 
	gv®
 = 
¡d
::
¡oi
(
´İs
.
G‘Prİ”ty
(
PROP_MAX_BYTES_FOR_LEVEL_BASE
, 
PROP_MAX_BYTES_FOR_LEVEL_BASE_DEFAULT
));

256 ià(
	gv®
 != 0) {

257 
İt
->
max_by‹s_fÜ_Ëv–_ba£
 = 
v®
;

259 
	gv®
 = 
¡d
::
¡oi
(
´İs
.
G‘Prİ”ty
(
PROP_WRITE_BUFFER_SIZE
, 
PROP_WRITE_BUFFER_SIZE_DEFAULT
));

260 ià(
	gv®
 != 0) {

261 
İt
->
wr™e_bufãr_size
 = 
v®
;

263 
	gv®
 = 
¡d
::
¡oi
(
´İs
.
G‘Prİ”ty
(
PROP_MAX_WRITE_BUFFER
, 
PROP_MAX_WRITE_BUFFER_DEFAULT
));

264 ià(
	gv®
 != 0) {

265 
İt
->
max_wr™e_bufãr_numb”
 = 
v®
;

267 
	gv®
 = 
¡d
::
¡oi
(
´İs
.
G‘Prİ”ty
(
PROP_COMPACTION_PRI
, 
PROP_COMPACTION_PRI_DEFAULT
));

268 ià(
	gv®
 != -1) {

269 
İt
->
com·ùiÚ_´i
 = 
¡©ic_ÿ¡
<
rocksdb
::
Com·ùiÚPri
>(
v®
);

272 
size_t
 
	gÿche_size
 = 
¡d
::
¡oul
(
´İs
.
G‘Prİ”ty
(
PROP_CACHE_SIZE
, 
PROP_CACHE_SIZE_DEFAULT
));

273 ià(
	gÿche_size
 > 0) {

274 
	gblock_ÿche
 = 
rocksdb
::
NewLRUCache
(
ÿche_size
);

275 
	grocksdb
::
BlockBa£dTabËO±iÚs
 
bË_İtiÚs
;

276 
	gbË_İtiÚs
.
	gblock_ÿche
 = 
block_ÿche
;

277 
	gİt
->
	gbË_çùÜy
.
»£t
(
rocksdb
::
NewBlockBa£dTabËFaùÜy
(
bË_İtiÚs
));

280 ià(
	g´İs
.
G‘Prİ”ty
(
PROP_INCREASE_PARALLELISM
, 
PROP_INCREASE_PARALLELISM_DEFAULT
) == "true") {

281 
İt
->
Inü—£P¬®Ëlism
();

283 ià(
	g´İs
.
G‘Prİ”ty
(
PROP_OPTIMIZE_LEVELCOMP
, 
PROP_OPTIMIZE_LEVELCOMP_DEFAULT
) == "true") {

284 
İt
->
O±imizeLev–StyËCom·ùiÚ
();

289 
	gRocksdbDB
::
S”ŸlizeRow
(cÚ¡ 
¡d
::
veùÜ
<
F›ld
> &
v®ues
, std::
¡ršg
 &
d©a
) {

290 cÚ¡ 
F›ld
 &
f›ld
 : 
v®ues
) {

291 
ušt32_t
 
Ën
 = 
f›ld
.
Çme
.
size
();

292 
	gd©a
.
­³nd
(
»š‹½»t_ÿ¡
<*>(&
Ën
), (
ušt32_t
));

293 
	gd©a
.
­³nd
(
f›ld
.
Çme
.
d©a
(), f›ld.Çme.
size
());

294 
	gËn
 = 
f›ld
.
v®ue
.
size
();

295 
	gd©a
.
­³nd
(
»š‹½»t_ÿ¡
<*>(&
Ën
), (
ušt32_t
));

296 
	gd©a
.
­³nd
(
f›ld
.
v®ue
.
d©a
(), f›ld.v®ue.
size
());

300 
	gRocksdbDB
::
De£rŸlizeRowF‹r
(
¡d
::
veùÜ
<
F›ld
> &
v®ues
, cÚ¡ *
p
, cÚ¡ *
lim
,

301 cÚ¡ 
¡d
::
veùÜ
<¡d::
¡ršg
> &
f›lds
) {

302 
¡d
::
veùÜ
<¡d::
¡ršg
>::
cÚ¡_™”©Ü
 
f‹r_™”
 = 
f›lds
.
begš
();

303 
	gp
 !ğ
lim
 && 
f‹r_™”
 !ğ
f›lds
.
’d
()) {

304 
as£¹
(
p
 < 
lim
);

305 
ušt32_t
 
	gËn
 = *
»š‹½»t_ÿ¡
<cÚ¡ ušt32_ˆ*>(
p
);

306 
	gp
 +ğ(
ušt32_t
);

307 
	g¡d
::
¡ršg
 
f›ld
(
p
, 
¡©ic_ÿ¡
<cÚ¡ 
size_t
>(
Ën
));

308 
	gp
 +ğ
Ën
;

309 
	gËn
 = *
»š‹½»t_ÿ¡
<cÚ¡ 
ušt32_t
 *>(
p
);

310 
	gp
 +ğ(
ušt32_t
);

311 
	g¡d
::
¡ršg
 
v®ue
(
p
, 
¡©ic_ÿ¡
<cÚ¡ 
size_t
>(
Ën
));

312 
	gp
 +ğ
Ën
;

313 ià(*
	gf‹r_™”
 =ğ
f›ld
) {

314 
v®ues
.
push_back
({
f›ld
, 
v®ue
});

315 
	gf‹r_™”
++;

318 
as£¹
(
v®ues
.
size
(è=ğ
f›lds
.size());

321 
	gRocksdbDB
::
De£rŸlizeRowF‹r
(
¡d
::
veùÜ
<
F›ld
> &
v®ues
, cÚ¡ std::
¡ršg
 &
d©a
,

322 cÚ¡ 
¡d
::
veùÜ
<¡d::
¡ršg
> &
f›lds
) {

323 cÚ¡ *
p
 = 
d©a
.data();

324 cÚ¡ *
	glim
 = 
p
 + 
d©a
.
size
();

325 
De£rŸlizeRowF‹r
(
v®ues
, 
p
, 
lim
, 
f›lds
);

328 
	gRocksdbDB
::
De£rŸlizeRow
(
¡d
::
veùÜ
<
F›ld
> &
v®ues
, cÚ¡ *
p
, cÚ¡ *
lim
) {

329 
	gp
 !ğ
lim
) {

330 
as£¹
(
p
 < 
lim
);

331 
ušt32_t
 
	gËn
 = *
»š‹½»t_ÿ¡
<cÚ¡ ušt32_ˆ*>(
p
);

332 
	gp
 +ğ(
ušt32_t
);

333 
	g¡d
::
¡ršg
 
f›ld
(
p
, 
¡©ic_ÿ¡
<cÚ¡ 
size_t
>(
Ën
));

334 
	gp
 +ğ
Ën
;

335 
	gËn
 = *
»š‹½»t_ÿ¡
<cÚ¡ 
ušt32_t
 *>(
p
);

336 
	gp
 +ğ(
ušt32_t
);

337 
	g¡d
::
¡ršg
 
v®ue
(
p
, 
¡©ic_ÿ¡
<cÚ¡ 
size_t
>(
Ën
));

338 
	gp
 +ğ
Ën
;

339 
	gv®ues
.
push_back
({
f›ld
, 
v®ue
});

343 
	gRocksdbDB
::
De£rŸlizeRow
(
¡d
::
veùÜ
<
F›ld
> &
v®ues
, cÚ¡ std::
¡ršg
 &
d©a
) {

344 cÚ¡ *
p
 = 
d©a
.data();

345 cÚ¡ *
	glim
 = 
p
 + 
d©a
.
size
();

346 
De£rŸlizeRow
(
v®ues
, 
p
, 
lim
);

349 
	gDB
::
Stus
 
RocksdbDB
::
R—dSšgË
(cÚ¡ 
¡d
::
¡ršg
 &
bË
, cÚ¡ std::¡ršg &
key
,

350 cÚ¡ 
¡d
::
veùÜ
<¡d::
¡ršg
> *
f›lds
,

351 
¡d
::
veùÜ
<
F›ld
> &
»suÉ
) {

352 
¡d
::
¡ršg
 
d©a
;

353 
	grocksdb
::
Stus
 
s
 = 
db_
->
G‘
(
rocksdb
::
R—dO±iÚs
(), 
key
, &
d©a
);

354 ià(
	gs
.
IsNÙFound
()) {

355  
	gkNÙFound
;

356 } ià(!
	gs
.
ok
()) {

357 
throw
 
	guts
::
Exû±iÚ
(
¡d
::
¡ršg
("RocksDB G‘: "è+ 
s
.
ToSŒšg
());

359 ià(
	gf›lds
 !ğ
nuÎ±r
) {

360 
De£rŸlizeRowF‹r
(
»suÉ
, 
d©a
, *
f›lds
);

362 
De£rŸlizeRow
(
»suÉ
, 
d©a
);

363 
as£¹
(
»suÉ
.
size
(è=ğ
¡©ic_ÿ¡
<
size_t
>(
f›ldcouÁ_
));

365  
	gkOK
;

368 
	gDB
::
Stus
 
RocksdbDB
::
SÿnSšgË
(cÚ¡ 
¡d
::
¡ršg
 &
bË
, cÚ¡ std::¡ršg &
key
, 
Ën
,

369 cÚ¡ 
¡d
::
veùÜ
<¡d::
¡ršg
> *
f›lds
,

370 
¡d
::
veùÜ
<¡d::veùÜ<
F›ld
>> &
»suÉ
) {

371 
rocksdb
::
I‹¿tÜ
 *
db_™”
 = 
db_
->
NewI‹¿tÜ
Ôocksdb::
R—dO±iÚs
());

372 
	gdb_™”
->
S“k
(
key
);

373 
	gi
 = 0; 
	gdb_™”
->
V®id
(è&& i < 
	gËn
; i++) {

374 
	g¡d
::
¡ršg
 
d©a
 = 
db_™”
->
v®ue
().
ToSŒšg
();

375 
	g»suÉ
.
push_back
(
¡d
::
veùÜ
<
F›ld
>());

376 
	g¡d
::
veùÜ
<
F›ld
> &
v®ues
 = 
»suÉ
.
back
();

377 ià(
	gf›lds
 !ğ
nuÎ±r
) {

378 
De£rŸlizeRowF‹r
(
v®ues
, 
d©a
, *
f›lds
);

380 
De£rŸlizeRow
(
v®ues
, 
d©a
);

381 
as£¹
(
v®ues
.
size
(è=ğ
¡©ic_ÿ¡
<
size_t
>(
f›ldcouÁ_
));

383 
	gdb_™”
->
Next
();

385 
d–‘e
 
	gdb_™”
;

386  
	gkOK
;

389 
	gDB
::
Stus
 
RocksdbDB
::
Upd©eSšgË
(cÚ¡ 
¡d
::
¡ršg
 &
bË
, cÚ¡ std::¡ršg &
key
,

390 
¡d
::
veùÜ
<
F›ld
> &
v®ues
) {

391 
¡d
::
¡ršg
 
d©a
;

392 
	grocksdb
::
Stus
 
s
 = 
db_
->
G‘
(
rocksdb
::
R—dO±iÚs
(), 
key
, &
d©a
);

393 ià(
	gs
.
IsNÙFound
()) {

394  
	gkNÙFound
;

395 } ià(!
	gs
.
ok
()) {

396 
throw
 
	guts
::
Exû±iÚ
(
¡d
::
¡ršg
("RocksDB G‘: "è+ 
s
.
ToSŒšg
());

398 
	g¡d
::
veùÜ
<
F›ld
> 
cu¼’t_v®ues
;

399 
De£rŸlizeRow
(
cu¼’t_v®ues
, 
d©a
);

400 
as£¹
(
cu¼’t_v®ues
.
size
(è=ğ
¡©ic_ÿ¡
<
size_t
>(
f›ldcouÁ_
));

401 
	gF›ld
 &
	gÃw_f›ld
 : 
v®ues
) {

402 
boŞ
 
found
 
__©Œibu‹__
((
unu£d
)èğ
çl£
;

403 
	gF›ld
 &
	gcur_f›ld
 : 
cu¼’t_v®ues
) {

404 ià(
cur_f›ld
.
Çme
 =ğ
Ãw_f›ld
.name) {

405 
found
 = 
Œue
;

406 
	gcur_f›ld
.
	gv®ue
 = 
Ãw_f›ld
.
v®ue
;

410 
as£¹
(
found
);

412 
	grocksdb
::
Wr™eO±iÚs
 
wİt
;

414 
	gd©a
.
ş—r
();

415 
S”ŸlizeRow
(
cu¼’t_v®ues
, 
d©a
);

416 
	gs
 = 
db_
->
Put
(
wİt
, 
key
, 
d©a
);

417 ià(!
	gs
.
ok
()) {

418 
throw
 
	guts
::
Exû±iÚ
(
¡d
::
¡ršg
("RocksDB Put: "è+ 
s
.
ToSŒšg
());

420  
	gkOK
;

423 
	gDB
::
Stus
 
RocksdbDB
::
M”geSšgË
(cÚ¡ 
¡d
::
¡ršg
 &
bË
, cÚ¡ std::¡ršg &
key
,

424 
¡d
::
veùÜ
<
F›ld
> &
v®ues
) {

425 
¡d
::
¡ršg
 
d©a
;

426 
S”ŸlizeRow
(
v®ues
, 
d©a
);

427 
	grocksdb
::
Wr™eO±iÚs
 
wİt
;

428 
	grocksdb
::
Stus
 
s
 = 
db_
->
M”ge
(
wİt
, 
key
, 
d©a
);

429 ià(!
	gs
.
ok
()) {

430 
throw
 
	guts
::
Exû±iÚ
(
¡d
::
¡ršg
("RocksDB M”ge: "è+ 
s
.
ToSŒšg
());

432  
	gkOK
;

435 
	gDB
::
Stus
 
RocksdbDB
::
In£¹SšgË
(cÚ¡ 
¡d
::
¡ršg
 &
bË
, cÚ¡ std::¡ršg &
key
,

436 
¡d
::
veùÜ
<
F›ld
> &
v®ues
) {

437 
¡d
::
¡ršg
 
d©a
;

438 
S”ŸlizeRow
(
v®ues
, 
d©a
);

439 
	grocksdb
::
Wr™eO±iÚs
 
wİt
;

440 
	grocksdb
::
Stus
 
s
 = 
db_
->
Put
(
wİt
, 
key
, 
d©a
);

441 ià(!
	gs
.
ok
()) {

442 
throw
 
	guts
::
Exû±iÚ
(
¡d
::
¡ršg
("RocksDB Put: "è+ 
s
.
ToSŒšg
());

444  
	gkOK
;

447 
	gDB
::
Stus
 
RocksdbDB
::
	$D–‘eSšgË
(cÚ¡ 
¡d
::
¡ršg
 &
bË
, cÚ¡ std::¡ršg &
key
) {

448 
rocksdb
::
Wr™eO±iÚs
 
wİt
;

449 
rocksdb
::
Stus
 
s
 = 
db_
->
	`D–‘e
(
wİt
, 
key
);

450 ià(!
s
.
	`ok
()) {

451 
throw
 
uts
::
	`Exû±iÚ
(
¡d
::
	`¡ršg
("RocksDB D–‘e: "è+ 
s
.
	`ToSŒšg
());

453  
kOK
;

454 
	}
}

456 
DB
 *
	$NewRocksdbDB
() {

457  
Ãw
 
RocksdbDB
;

458 
	}
}

460 cÚ¡ 
boŞ
 
	g»gi¡”ed
 = 
DBFaùÜy
::
Regi¡”DB
("rocksdb", 
NewRocksdbDB
);

	@rocksdb/rocksdb_db.h

8 #iâdeà
YCSB_C_ROCKSDB_DB_H_


9 
	#YCSB_C_ROCKSDB_DB_H_


	)

11 
	~<¡ršg
>

12 
	~<mu‹x
>

14 
	~"cÜe/db.h
"

15 
	~"cÜe/´İ”t›s.h
"

17 
	~<rocksdb/db.h
>

18 
	~<rocksdb/bË.h
>

19 
	~<rocksdb/İtiÚs.h
>

27 
Çme¥aû
 
	gycsbc
 {

29 şas 
	cRocksdbDB
 : 
public
 
DB
 {

30 
public
:

31 
RocksdbDB
() {}

32 ~
RocksdbDB
() {}

34 
In™
();

36 
CËªup
();

38 
Stus
 
R—d
(cÚ¡ 
¡d
::
¡ršg
 &
bË
, cÚ¡ std::¡ršg &
key
,

39 cÚ¡ 
¡d
::
veùÜ
<¡d::
¡ršg
> *
f›lds
, std::veùÜ<
F›ld
> &
»suÉ
) {

40  (
this
->*(
m‘hod_»ad_
))(
bË
, 
	gkey
, 
	gf›lds
, 
	g»suÉ
);

43 
Stus
 
Sÿn
(cÚ¡ 
¡d
::
¡ršg
 &
bË
, cÚ¡ std::¡ršg &
key
, 
Ën
,

44 cÚ¡ 
¡d
::
veùÜ
<¡d::
¡ršg
> *
f›lds
, std::veùÜ<¡d::veùÜ<
F›ld
>> &
»suÉ
) {

45  (
this
->*(
m‘hod_sÿn_
))(
bË
, 
	gkey
, 
	gËn
, 
	gf›lds
, 
	g»suÉ
);

48 
Stus
 
Upd©e
(cÚ¡ 
¡d
::
¡ršg
 &
bË
, cÚ¡ std::¡ršg &
key
, std::
veùÜ
<
F›ld
> &
v®ues
) {

49  (
this
->*(
m‘hod_upd©e_
))(
bË
, 
	gkey
, 
	gv®ues
);

52 
Stus
 
In£¹
(cÚ¡ 
¡d
::
¡ršg
 &
bË
, cÚ¡ std::¡ršg &
key
, std::
veùÜ
<
F›ld
> &
v®ues
) {

53  (
this
->*(
m‘hod_š£¹_
))(
bË
, 
	gkey
, 
	gv®ues
);

56 
Stus
 
D–‘e
(cÚ¡ 
¡d
::
¡ršg
 &
bË
, cÚ¡ std::¡ršg &
key
) {

57  (
this
->*(
m‘hod_d–‘e_
))(
bË
, 
	gkey
);

60 
	g´iv©e
:

61 
	eRocksFÜm©
 {

62 
kSšgËRow
,

64 
RocksFÜm©
 
	gfÜm©_
;

66 
G‘O±iÚs
(cÚ¡ 
uts
::
Prİ”t›s
 &
´İs
, 
rocksdb
::
O±iÚs
 *
İt
,

67 
¡d
::
veùÜ
<
rocksdb
::
CŞumnFamyDesütÜ
> *
cf_descs
);

68 
S”ŸlizeRow
(cÚ¡ 
¡d
::
veùÜ
<
F›ld
> &
v®ues
, std::
¡ršg
 &
d©a
);

69 
De£rŸlizeRowF‹r
(
¡d
::
veùÜ
<
F›ld
> &
v®ues
, cÚ¡ *
p
, cÚ¡ *
lim
,

70 cÚ¡ 
¡d
::
veùÜ
<¡d::
¡ršg
> &
f›lds
);

71 
De£rŸlizeRowF‹r
(
¡d
::
veùÜ
<
F›ld
> &
v®ues
, cÚ¡ std::
¡ršg
 &
d©a
,

72 cÚ¡ 
¡d
::
veùÜ
<¡d::
¡ršg
> &
f›lds
);

73 
De£rŸlizeRow
(
¡d
::
veùÜ
<
F›ld
> &
v®ues
, cÚ¡ *
p
, cÚ¡ *
lim
);

74 
De£rŸlizeRow
(
¡d
::
veùÜ
<
F›ld
> &
v®ues
, cÚ¡ std::
¡ršg
 &
d©a
);

76 
Stus
 
R—dSšgË
(cÚ¡ 
¡d
::
¡ršg
 &
bË
, cÚ¡ std::¡ršg &
key
,

77 cÚ¡ 
¡d
::
veùÜ
<¡d::
¡ršg
> *
f›lds
, std::veùÜ<
F›ld
> &
»suÉ
);

78 
Stus
 
SÿnSšgË
(cÚ¡ 
¡d
::
¡ršg
 &
bË
, cÚ¡ std::¡ršg &
key
, 
Ën
,

79 cÚ¡ 
¡d
::
veùÜ
<¡d::
¡ršg
> *
f›lds
,

80 
¡d
::
veùÜ
<¡d::veùÜ<
F›ld
>> &
»suÉ
);

81 
Stus
 
Upd©eSšgË
(cÚ¡ 
¡d
::
¡ršg
 &
bË
, cÚ¡ std::¡ršg &
key
,

82 
¡d
::
veùÜ
<
F›ld
> &
v®ues
);

83 
Stus
 
M”geSšgË
(cÚ¡ 
¡d
::
¡ršg
 &
bË
, cÚ¡ std::¡ršg &
key
,

84 
¡d
::
veùÜ
<
F›ld
> &
v®ues
);

85 
Stus
 
In£¹SšgË
(cÚ¡ 
¡d
::
¡ršg
 &
bË
, cÚ¡ std::¡ršg &
key
,

86 
¡d
::
veùÜ
<
F›ld
> &
v®ues
);

87 
Stus
 
D–‘eSšgË
(cÚ¡ 
¡d
::
¡ršg
 &
bË
, cÚ¡ std::¡ršg &
key
);

89 
Stus
 (
RocksdbDB
::*
m‘hod_»ad_
)(cÚ¡ 
¡d
::
¡ršg
 &, cÚ¡ 
	g¡d
:: string &,

90 cÚ¡ 
	g¡d
::
veùÜ
<
¡d
::
¡ršg
> *, std::veùÜ<
F›ld
> &);

91 
Stus
 (
RocksdbDB
::*
m‘hod_sÿn_
)(cÚ¡ 
¡d
::
¡ršg
 &, cÚ¡ 
	g¡d
::string &,

92 , cÚ¡ 
	g¡d
::
veùÜ
<
¡d
::
¡ršg
> *,

93 
	g¡d
::
veùÜ
<
¡d
::veùÜ<
F›ld
>> &);

94 
Stus
 (
RocksdbDB
::*
m‘hod_upd©e_
)(cÚ¡ 
¡d
::
¡ršg
 &, cÚ¡ 
	g¡d
::string &,

95 
	g¡d
::
veùÜ
<
F›ld
> &);

96 
Stus
 (
RocksdbDB
::*
m‘hod_š£¹_
)(cÚ¡ 
¡d
::
¡ršg
 &, cÚ¡ 
	g¡d
::string &,

97 
	g¡d
::
veùÜ
<
F›ld
> &);

98 
Stus
 (
RocksdbDB
::*
m‘hod_d–‘e_
)(cÚ¡ 
¡d
::
¡ršg
 &, cÚ¡ 
	g¡d
::string &);

100 
	gf›ldcouÁ_
;

102 
	grocksdb
::
DB
 *
db_
;

103 
	g»f_út_
;

104 
	g¡d
::
mu‹x
 
mu_
;

108 
DB
 *
NewRocksdbDB
();

	@/usr/include/stdio.h

23 #iâdeà
_STDIO_H


24 
	#_STDIO_H
 1

	)

26 
	#__GLIBC_INTERNAL_STARTING_HEADER_IMPLEMENTATION


	)

27 
	~<b™s/libc-h—d”-¡¬t.h
>

29 
	g__BEGIN_DECLS


31 
	#__Ãed_size_t


	)

32 
	#__Ãed_NULL


	)

33 
	~<¡ddef.h
>

35 
	~<b™s/ty³s.h
>

36 
	~<b™s/ty³s/__FILE.h
>

37 
	~<b™s/ty³s/FILE.h
>

39 
	#_STDIO_USES_IOSTREAM


	)

41 
	~<b™s/libio.h
>

43 #ià
defšed
 
__USE_XOPEN
 || defšed 
__USE_XOPEN2K8


44 #ifdeà
__GNUC__


45 #iâdeà
_VA_LIST_DEFINED


46 
_G_va_li¡
 
	tva_li¡
;

47 
	#_VA_LIST_DEFINED


	)

50 
	~<¡d¬g.h
>

54 #ià
defšed
 
__USE_UNIX98
 || defšed 
__USE_XOPEN2K


55 #iâdeà
__off_t_defšed


56 #iâdeà
__USE_FILE_OFFSET64


57 
__off_t
 
	toff_t
;

59 
__off64_t
 
	toff_t
;

61 
	#__off_t_defšed


	)

63 #ià
defšed
 
__USE_LARGEFILE64
 && !defšed 
__off64_t_defšed


64 
__off64_t
 
	toff64_t
;

65 
	#__off64_t_defšed


	)

69 #ifdeà
__USE_XOPEN2K8


70 #iâdeà
__ssize_t_defšed


71 
__ssize_t
 
	tssize_t
;

72 
	#__ssize_t_defšed


	)

77 #iâdeà
__USE_FILE_OFFSET64


78 
_G_åos_t
 
	tåos_t
;

80 
_G_åos64_t
 
	tåos_t
;

82 #ifdeà
__USE_LARGEFILE64


83 
_G_åos64_t
 
	tåos64_t
;

87 
	#_IOFBF
 0

	)

88 
	#_IOLBF
 1

	)

89 
	#_IONBF
 2

	)

93 #iâdeà
BUFSIZ


94 
	#BUFSIZ
 
_IO_BUFSIZ


	)

100 #iâdeà
EOF


101 
	#EOF
 (-1)

	)

107 
	#SEEK_SET
 0

	)

108 
	#SEEK_CUR
 1

	)

109 
	#SEEK_END
 2

	)

110 #ifdeà
__USE_GNU


111 
	#SEEK_DATA
 3

	)

112 
	#SEEK_HOLE
 4

	)

116 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN


118 
	#P_tmpdœ
 "/tmp"

	)

131 
	~<b™s/¡dio_lim.h
>

135 
_IO_FILE
 *
¡dš
;

136 
_IO_FILE
 *
¡dout
;

137 
_IO_FILE
 *
¡d”r
;

139 
	#¡dš
 
¡dš


	)

140 
	#¡dout
 
¡dout


	)

141 
	#¡d”r
 
¡d”r


	)

144 
	$»move
 (cÚ¡ *
__f’ame
è
__THROW
;

146 
	$»Çme
 (cÚ¡ *
__Şd
, cÚ¡ *
__Ãw
è
__THROW
;

148 #ifdeà
__USE_ATFILE


150 
	$»Çm—t
 (
__Şdfd
, cÚ¡ *
__Şd
, 
__Ãwfd
,

151 cÚ¡ *
__Ãw
è
__THROW
;

158 #iâdeà
__USE_FILE_OFFSET64


159 
FILE
 *
	$tmpfe
 (è
__wur
;

161 #ifdeà
__REDIRECT


162 
FILE
 *
	`__REDIRECT
 (
tmpfe
, (), 
tmpfe64
è
__wur
;

164 
	#tmpfe
 
tmpfe64


	)

168 #ifdeà
__USE_LARGEFILE64


169 
FILE
 *
	$tmpfe64
 (è
__wur
;

173 *
	$tm²am
 (*
__s
è
__THROW
 
__wur
;

175 #ifdeà
__USE_MISC


178 *
	$tm²am_r
 (*
__s
è
__THROW
 
__wur
;

182 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN


190 *
	$‹m²am
 (cÚ¡ *
__dœ
, cÚ¡ *
__pfx
)

191 
__THROW
 
__©Œibu‹_m®loc__
 
__wur
;

199 
	`fşo£
 (
FILE
 *
__¡»am
);

204 
	`fæush
 (
FILE
 *
__¡»am
);

206 #ifdeà
__USE_MISC


213 
	`fæush_uÆocked
 (
FILE
 *
__¡»am
);

216 #ifdeà
__USE_GNU


223 
	`fşo£®l
 ();

227 #iâdeà
__USE_FILE_OFFSET64


232 
FILE
 *
	$fİ’
 (cÚ¡ *
__»¡riù
 
__f’ame
,

233 cÚ¡ *
__»¡riù
 
__modes
è
__wur
;

238 
FILE
 *
	$äeİ’
 (cÚ¡ *
__»¡riù
 
__f’ame
,

239 cÚ¡ *
__»¡riù
 
__modes
,

240 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

242 #ifdeà
__REDIRECT


243 
FILE
 *
	`__REDIRECT
 (
fİ’
, (cÚ¡ *
__»¡riù
 
__f’ame
,

244 cÚ¡ *
__»¡riù
 
__modes
), 
fİ’64
)

245 
__wur
;

246 
FILE
 *
	`__REDIRECT
 (
äeİ’
, (cÚ¡ *
__»¡riù
 
__f’ame
,

247 cÚ¡ *
__»¡riù
 
__modes
,

248 
FILE
 *
__»¡riù
 
__¡»am
), 
äeİ’64
)

249 
__wur
;

251 
	#fİ’
 
fİ’64


	)

252 
	#äeİ’
 
äeİ’64


	)

255 #ifdeà
__USE_LARGEFILE64


256 
FILE
 *
	$fİ’64
 (cÚ¡ *
__»¡riù
 
__f’ame
,

257 cÚ¡ *
__»¡riù
 
__modes
è
__wur
;

258 
FILE
 *
	$äeİ’64
 (cÚ¡ *
__»¡riù
 
__f’ame
,

259 cÚ¡ *
__»¡riù
 
__modes
,

260 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

263 #ifdef 
__USE_POSIX


265 
FILE
 *
	$fdİ’
 (
__fd
, cÚ¡ *
__modes
è
__THROW
 
__wur
;

268 #ifdef 
__USE_GNU


271 
FILE
 *
	$fİ’cook›
 (*
__»¡riù
 
__magic_cook›
,

272 cÚ¡ *
__»¡riù
 
__modes
,

273 
_IO_cook›_io_funùiÚs_t
 
__io_funcs
è
__THROW
 
__wur
;

276 #ià
defšed
 
__USE_XOPEN2K8
 || 
	`__GLIBC_USE
 (
LIB_EXT2
)

278 
FILE
 *
	$fmemİ’
 (*
__s
, 
size_t
 
__Ën
, cÚ¡ *
__modes
)

279 
__THROW
 
__wur
;

284 
FILE
 *
	$İ’_mem¡»am
 (**
__buæoc
, 
size_t
 *
__siz–oc
è
__THROW
 
__wur
;

290 
	$£tbuf
 (
FILE
 *
__»¡riù
 
__¡»am
, *__»¡riù 
__buf
è
__THROW
;

294 
	$£tvbuf
 (
FILE
 *
__»¡riù
 
__¡»am
, *__»¡riù 
__buf
,

295 
__modes
, 
size_t
 
__n
è
__THROW
;

297 #ifdef 
__USE_MISC


300 
	$£tbufãr
 (
FILE
 *
__»¡riù
 
__¡»am
, *__»¡riù 
__buf
,

301 
size_t
 
__size
è
__THROW
;

304 
	$£šebuf
 (
FILE
 *
__¡»am
è
__THROW
;

312 
	`årštf
 (
FILE
 *
__»¡riù
 
__¡»am
,

313 cÚ¡ *
__»¡riù
 
__fÜm©
, ...);

318 
	`´štf
 (cÚ¡ *
__»¡riù
 
__fÜm©
, ...);

320 
	$¥rštf
 (*
__»¡riù
 
__s
,

321 cÚ¡ *
__»¡riù
 
__fÜm©
, ...è
__THROWNL
;

327 
	`vårštf
 (
FILE
 *
__»¡riù
 
__s
, cÚ¡ *__»¡riù 
__fÜm©
,

328 
_G_va_li¡
 
__¬g
);

333 
	`v´štf
 (cÚ¡ *
__»¡riù
 
__fÜm©
, 
_G_va_li¡
 
__¬g
);

335 
	$v¥rštf
 (*
__»¡riù
 
__s
, cÚ¡ *__»¡riù 
__fÜm©
,

336 
_G_va_li¡
 
__¬g
è
__THROWNL
;

338 #ià
defšed
 
__USE_ISOC99
 || defšed 
__USE_UNIX98


340 
	$¢´štf
 (*
__»¡riù
 
__s
, 
size_t
 
__maxËn
,

341 cÚ¡ *
__»¡riù
 
__fÜm©
, ...)

342 
__THROWNL
 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__´štf__
, 3, 4)));

344 
	$v¢´štf
 (*
__»¡riù
 
__s
, 
size_t
 
__maxËn
,

345 cÚ¡ *
__»¡riù
 
__fÜm©
, 
_G_va_li¡
 
__¬g
)

346 
__THROWNL
 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__´štf__
, 3, 0)));

349 #ià
	`__GLIBC_USE
 (
LIB_EXT2
)

352 
	$va¥rštf
 (**
__»¡riù
 
__±r
, cÚ¡ *__»¡riù 
__f
,

353 
_G_va_li¡
 
__¬g
)

354 
__THROWNL
 
	`__©Œibu‹__
 ((
	$__fÜm©__
 (
__´štf__
, 2, 0))è
__wur
;

355 
	$__a¥rštf
 (**
__»¡riù
 
__±r
,

356 cÚ¡ *
__»¡riù
 
__fmt
, ...)

357 
__THROWNL
 
	`__©Œibu‹__
 ((
	$__fÜm©__
 (
__´štf__
, 2, 3))è
__wur
;

358 
	$a¥rštf
 (**
__»¡riù
 
__±r
,

359 cÚ¡ *
__»¡riù
 
__fmt
, ...)

360 
__THROWNL
 
	`__©Œibu‹__
 ((
	$__fÜm©__
 (
__´štf__
, 2, 3))è
__wur
;

363 #ifdeà
__USE_XOPEN2K8


365 
	$vd´štf
 (
__fd
, cÚ¡ *
__»¡riù
 
__fmt
,

366 
_G_va_li¡
 
__¬g
)

367 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__´štf__
, 2, 0)));

368 
	$d´štf
 (
__fd
, cÚ¡ *
__»¡riù
 
__fmt
, ...)

369 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__´štf__
, 2, 3)));

377 
	$fsÿnf
 (
FILE
 *
__»¡riù
 
__¡»am
,

378 cÚ¡ *
__»¡riù
 
__fÜm©
, ...è
__wur
;

383 
	$sÿnf
 (cÚ¡ *
__»¡riù
 
__fÜm©
, ...è
__wur
;

385 
	$ssÿnf
 (cÚ¡ *
__»¡riù
 
__s
,

386 cÚ¡ *
__»¡riù
 
__fÜm©
, ...è
__THROW
;

388 #ià
defšed
 
__USE_ISOC99
 && !defšed 
__USE_GNU
 \

389 && (!
defšed
 
__LDBL_COMPAT
 || !defšed 
__REDIRECT
) \

390 && (
defšed
 
__STRICT_ANSI__
 || defšed 
__USE_XOPEN2K
)

391 #ifdeà
__REDIRECT


395 
	`__REDIRECT
 (
fsÿnf
, (
FILE
 *
__»¡riù
 
__¡»am
,

396 cÚ¡ *
__»¡riù
 
__fÜm©
, ...),

397 
__isoc99_fsÿnf
è
__wur
;

398 
	`__REDIRECT
 (
sÿnf
, (cÚ¡ *
__»¡riù
 
__fÜm©
, ...),

399 
__isoc99_sÿnf
è
__wur
;

400 
	`__REDIRECT_NTH
 (
ssÿnf
, (cÚ¡ *
__»¡riù
 
__s
,

401 cÚ¡ *
__»¡riù
 
__fÜm©
, ...),

402 
__isoc99_ssÿnf
);

404 
	$__isoc99_fsÿnf
 (
FILE
 *
__»¡riù
 
__¡»am
,

405 cÚ¡ *
__»¡riù
 
__fÜm©
, ...è
__wur
;

406 
	$__isoc99_sÿnf
 (cÚ¡ *
__»¡riù
 
__fÜm©
, ...è
__wur
;

407 
	$__isoc99_ssÿnf
 (cÚ¡ *
__»¡riù
 
__s
,

408 cÚ¡ *
__»¡riù
 
__fÜm©
, ...è
__THROW
;

409 
	#fsÿnf
 
__isoc99_fsÿnf


	)

410 
	#sÿnf
 
__isoc99_sÿnf


	)

411 
	#ssÿnf
 
__isoc99_ssÿnf


	)

415 #ifdef 
__USE_ISOC99


420 
	$vfsÿnf
 (
FILE
 *
__»¡riù
 
__s
, cÚ¡ *__»¡riù 
__fÜm©
,

421 
_G_va_li¡
 
__¬g
)

422 
	`__©Œibu‹__
 ((
	$__fÜm©__
 (
__sÿnf__
, 2, 0))è
__wur
;

428 
	$vsÿnf
 (cÚ¡ *
__»¡riù
 
__fÜm©
, 
_G_va_li¡
 
__¬g
)

429 
	`__©Œibu‹__
 ((
	$__fÜm©__
 (
__sÿnf__
, 1, 0))è
__wur
;

432 
	$vssÿnf
 (cÚ¡ *
__»¡riù
 
__s
,

433 cÚ¡ *
__»¡riù
 
__fÜm©
, 
_G_va_li¡
 
__¬g
)

434 
__THROW
 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__sÿnf__
, 2, 0)));

436 #ià!
defšed
 
__USE_GNU
 \

437 && (!
defšed
 
__LDBL_COMPAT
 || !defšed 
__REDIRECT
) \

438 && (
defšed
 
__STRICT_ANSI__
 || defšed 
__USE_XOPEN2K
)

439 #ifdeà
__REDIRECT


443 
	`__REDIRECT
 (
vfsÿnf
,

444 (
FILE
 *
__»¡riù
 
__s
,

445 cÚ¡ *
__»¡riù
 
__fÜm©
, 
_G_va_li¡
 
__¬g
),

446 
__isoc99_vfsÿnf
)

447 
	`__©Œibu‹__
 ((
	$__fÜm©__
 (
__sÿnf__
, 2, 0))è
__wur
;

448 
	`__REDIRECT
 (
vsÿnf
, (cÚ¡ *
__»¡riù
 
__fÜm©
,

449 
_G_va_li¡
 
__¬g
), 
__isoc99_vsÿnf
)

450 
	`__©Œibu‹__
 ((
	$__fÜm©__
 (
__sÿnf__
, 1, 0))è
__wur
;

451 
	`__REDIRECT_NTH
 (
vssÿnf
,

452 (cÚ¡ *
__»¡riù
 
__s
,

453 cÚ¡ *
__»¡riù
 
__fÜm©
,

454 
_G_va_li¡
 
__¬g
), 
__isoc99_vssÿnf
)

455 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__sÿnf__
, 2, 0)));

457 
	$__isoc99_vfsÿnf
 (
FILE
 *
__»¡riù
 
__s
,

458 cÚ¡ *
__»¡riù
 
__fÜm©
,

459 
_G_va_li¡
 
__¬g
è
__wur
;

460 
	$__isoc99_vsÿnf
 (cÚ¡ *
__»¡riù
 
__fÜm©
,

461 
_G_va_li¡
 
__¬g
è
__wur
;

462 
	$__isoc99_vssÿnf
 (cÚ¡ *
__»¡riù
 
__s
,

463 cÚ¡ *
__»¡riù
 
__fÜm©
,

464 
_G_va_li¡
 
__¬g
è
__THROW
;

465 
	#vfsÿnf
 
__isoc99_vfsÿnf


	)

466 
	#vsÿnf
 
__isoc99_vsÿnf


	)

467 
	#vssÿnf
 
__isoc99_vssÿnf


	)

477 
	`fg‘c
 (
FILE
 *
__¡»am
);

478 
	`g‘c
 (
FILE
 *
__¡»am
);

484 
	`g‘ch¬
 ();

488 
	#g‘c
(
_å
è
	`_IO_g‘c
 (_å)

	)

490 #ifdeà
__USE_POSIX199506


495 
	`g‘c_uÆocked
 (
FILE
 *
__¡»am
);

496 
	`g‘ch¬_uÆocked
 ();

499 #ifdeà
__USE_MISC


506 
	`fg‘c_uÆocked
 (
FILE
 *
__¡»am
);

517 
	`åutc
 (
__c
, 
FILE
 *
__¡»am
);

518 
	`putc
 (
__c
, 
FILE
 *
__¡»am
);

524 
	`putch¬
 (
__c
);

528 
	#putc
(
_ch
, 
_å
è
	`_IO_putc
 (_ch, _å)

	)

530 #ifdeà
__USE_MISC


537 
	`åutc_uÆocked
 (
__c
, 
FILE
 *
__¡»am
);

540 #ifdeà
__USE_POSIX199506


545 
	`putc_uÆocked
 (
__c
, 
FILE
 *
__¡»am
);

546 
	`putch¬_uÆocked
 (
__c
);

550 #ià
defšed
 
__USE_MISC
 \

551 || (
defšed
 
__USE_XOPEN
 && !defšed 
__USE_XOPEN2K
)

553 
	`g‘w
 (
FILE
 *
__¡»am
);

556 
	`putw
 (
__w
, 
FILE
 *
__¡»am
);

564 *
	$fg‘s
 (*
__»¡riù
 
__s
, 
__n
, 
FILE
 *__»¡riù 
__¡»am
)

565 
__wur
;

567 #ià
	`__GLIBC_USE
 (
DEPRECATED_GETS
)

577 *
	$g‘s
 (*
__s
è
__wur
 
__©Œibu‹_d•»ÿ‹d__
;

580 #ifdeà
__USE_GNU


587 *
	$fg‘s_uÆocked
 (*
__»¡riù
 
__s
, 
__n
,

588 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

592 #ià
defšed
 
__USE_XOPEN2K8
 || 
	`__GLIBC_USE
 (
LIB_EXT2
)

603 
_IO_ssize_t
 
	$__g‘d–im
 (**
__»¡riù
 
__lš•Œ
,

604 
size_t
 *
__»¡riù
 
__n
, 
__d–im™”
,

605 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

606 
_IO_ssize_t
 
	$g‘d–im
 (**
__»¡riù
 
__lš•Œ
,

607 
size_t
 *
__»¡riù
 
__n
, 
__d–im™”
,

608 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

616 
_IO_ssize_t
 
	$g‘lše
 (**
__»¡riù
 
__lš•Œ
,

617 
size_t
 *
__»¡riù
 
__n
,

618 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

626 
	`åuts
 (cÚ¡ *
__»¡riù
 
__s
, 
FILE
 *__»¡riù 
__¡»am
);

632 
	`puts
 (cÚ¡ *
__s
);

639 
	`ung‘c
 (
__c
, 
FILE
 *
__¡»am
);

646 
size_t
 
	$ä—d
 (*
__»¡riù
 
__±r
, 
size_t
 
__size
,

647 
size_t
 
__n
, 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

652 
size_t
 
	`fwr™e
 (cÚ¡ *
__»¡riù
 
__±r
, size_ˆ
__size
,

653 
size_t
 
__n
, 
FILE
 *
__»¡riù
 
__s
);

655 #ifdeà
__USE_GNU


662 
	`åuts_uÆocked
 (cÚ¡ *
__»¡riù
 
__s
,

663 
FILE
 *
__»¡riù
 
__¡»am
);

666 #ifdeà
__USE_MISC


673 
size_t
 
	$ä—d_uÆocked
 (*
__»¡riù
 
__±r
, 
size_t
 
__size
,

674 
size_t
 
__n
, 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

675 
size_t
 
	`fwr™e_uÆocked
 (cÚ¡ *
__»¡riù
 
__±r
, size_ˆ
__size
,

676 
size_t
 
__n
, 
FILE
 *
__»¡riù
 
__¡»am
);

684 
	`f£ek
 (
FILE
 *
__¡»am
, 
__off
, 
__wh’û
);

689 
	$á–l
 (
FILE
 *
__¡»am
è
__wur
;

694 
	`»wšd
 (
FILE
 *
__¡»am
);

701 #ià
defšed
 
__USE_LARGEFILE
 || defšed 
__USE_XOPEN2K


702 #iâdeà
__USE_FILE_OFFSET64


707 
	`f£eko
 (
FILE
 *
__¡»am
, 
__off_t
 
__off
, 
__wh’û
);

712 
__off_t
 
	$á–lo
 (
FILE
 *
__¡»am
è
__wur
;

714 #ifdeà
__REDIRECT


715 
	`__REDIRECT
 (
f£eko
,

716 (
FILE
 *
__¡»am
, 
__off64_t
 
__off
, 
__wh’û
),

717 
f£eko64
);

718 
__off64_t
 
	`__REDIRECT
 (
á–lo
, (
FILE
 *
__¡»am
), 
á–lo64
);

720 
	#f£eko
 
f£eko64


	)

721 
	#á–lo
 
á–lo64


	)

726 #iâdeà
__USE_FILE_OFFSET64


731 
	`fg‘pos
 (
FILE
 *
__»¡riù
 
__¡»am
, 
åos_t
 *__»¡riù 
__pos
);

736 
	`f£os
 (
FILE
 *
__¡»am
, cÚ¡ 
åos_t
 *
__pos
);

738 #ifdeà
__REDIRECT


739 
	`__REDIRECT
 (
fg‘pos
, (
FILE
 *
__»¡riù
 
__¡»am
,

740 
åos_t
 *
__»¡riù
 
__pos
), 
fg‘pos64
);

741 
	`__REDIRECT
 (
f£os
,

742 (
FILE
 *
__¡»am
, cÚ¡ 
åos_t
 *
__pos
), 
f£os64
);

744 
	#fg‘pos
 
fg‘pos64


	)

745 
	#f£os
 
f£os64


	)

749 #ifdeà
__USE_LARGEFILE64


750 
	`f£eko64
 (
FILE
 *
__¡»am
, 
__off64_t
 
__off
, 
__wh’û
);

751 
__off64_t
 
	$á–lo64
 (
FILE
 *
__¡»am
è
__wur
;

752 
	`fg‘pos64
 (
FILE
 *
__»¡riù
 
__¡»am
, 
åos64_t
 *__»¡riù 
__pos
);

753 
	`f£os64
 (
FILE
 *
__¡»am
, cÚ¡ 
åos64_t
 *
__pos
);

757 
	$ş—»¼
 (
FILE
 *
__¡»am
è
__THROW
;

759 
	$ãof
 (
FILE
 *
__¡»am
è
__THROW
 
__wur
;

761 
	$ã¼Ü
 (
FILE
 *
__¡»am
è
__THROW
 
__wur
;

763 #ifdeà
__USE_MISC


765 
	$ş—»¼_uÆocked
 (
FILE
 *
__¡»am
è
__THROW
;

766 
	$ãof_uÆocked
 (
FILE
 *
__¡»am
è
__THROW
 
__wur
;

767 
	$ã¼Ü_uÆocked
 (
FILE
 *
__¡»am
è
__THROW
 
__wur
;

775 
	`³¼Ü
 (cÚ¡ *
__s
);

781 
	~<b™s/sys_”¾i¡.h
>

784 #ifdef 
__USE_POSIX


786 
	$f’o
 (
FILE
 *
__¡»am
è
__THROW
 
__wur
;

789 #ifdeà
__USE_MISC


791 
	$f’o_uÆocked
 (
FILE
 *
__¡»am
è
__THROW
 
__wur
;

795 #ifdeà
__USE_POSIX2


800 
FILE
 *
	$pİ’
 (cÚ¡ *
__commªd
, cÚ¡ *
__modes
è
__wur
;

806 
	`pşo£
 (
FILE
 *
__¡»am
);

810 #ifdef 
__USE_POSIX


812 *
	$ù”mid
 (*
__s
è
__THROW
;

816 #ià(
defšed
 
__USE_XOPEN
 && !defšed 
__USE_XOPEN2K
è|| defšed 
__USE_GNU


818 *
	`cu£rid
 (*
__s
);

822 #ifdef 
__USE_GNU


823 
ob¡ack
;

826 
	$ob¡ack_´štf
 (
ob¡ack
 *
__»¡riù
 
__ob¡ack
,

827 cÚ¡ *
__»¡riù
 
__fÜm©
, ...)

828 
__THROWNL
 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__´štf__
, 2, 3)));

829 
	$ob¡ack_v´štf
 (
ob¡ack
 *
__»¡riù
 
__ob¡ack
,

830 cÚ¡ *
__»¡riù
 
__fÜm©
,

831 
_G_va_li¡
 
__¬gs
)

832 
__THROWNL
 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__´štf__
, 2, 0)));

836 #ifdeà
__USE_POSIX199506


840 
	$æockfe
 (
FILE
 *
__¡»am
è
__THROW
;

844 
	$árylockfe
 (
FILE
 *
__¡»am
è
__THROW
 
__wur
;

847 
	$fuÆockfe
 (
FILE
 *
__¡»am
è
__THROW
;

850 #ià
defšed
 
__USE_XOPEN
 && !defšed 
__USE_XOPEN2K
 && !defšed 
__USE_GNU


853 
	~<b™s/g‘İt_posix.h
>

858 #ifdeà
__USE_EXTERN_INLINES


859 
	~<b™s/¡dio.h
>

861 #ià
__USE_FORTIFY_LEVEL
 > 0 && 
defšed
 
__fÜtify_funùiÚ


862 
	~<b™s/¡dio2.h
>

864 #ifdeà
__LDBL_COMPAT


865 
	~<b™s/¡dio-ldbl.h
>

868 
__END_DECLS


	@/usr/include/string.h

22 #iâdef 
_STRING_H


23 
	#_STRING_H
 1

	)

25 
	#__GLIBC_INTERNAL_STARTING_HEADER_IMPLEMENTATION


	)

26 
	~<b™s/libc-h—d”-¡¬t.h
>

28 
	g__BEGIN_DECLS


31 
	#__Ãed_size_t


	)

32 
	#__Ãed_NULL


	)

33 
	~<¡ddef.h
>

36 #ià
defšed
 
__ılu¥lus
 && 
__GNUC_PREREQ
 (4, 4)

37 
	#__CORRECT_ISO_CPP_STRING_H_PROTO


	)

42 *
	$memıy
 (*
__»¡riù
 
__de¡
, cÚ¡ *__»¡riù 
__¤c
,

43 
size_t
 
__n
è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

46 *
	$memmove
 (*
__de¡
, cÚ¡ *
__¤c
, 
size_t
 
__n
)

47 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

52 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN


53 *
	$memcıy
 (*
__»¡riù
 
__de¡
, cÚ¡ *__»¡riù 
__¤c
,

54 
__c
, 
size_t
 
__n
)

55 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

60 *
	$mem£t
 (*
__s
, 
__c
, 
size_t
 
__n
è
__THROW
 
	`__nÚnuÎ
 ((1));

63 
	$memcmp
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
, 
size_t
 
__n
)

64 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

67 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


70 *
	`memchr
 (*
__s
, 
__c
, 
size_t
 
__n
)

71 
__THROW
 
	`__asm
 ("memchr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

72 cÚ¡ *
	`memchr
 (cÚ¡ *
__s
, 
__c
, 
size_t
 
__n
)

73 
__THROW
 
	`__asm
 ("memchr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

75 #ifdeà
__OPTIMIZE__


76 
__ex‹º_®ways_šlše
 *

77 
	`memchr
 (*
__s
, 
__c
, 
size_t
 
__n
è
__THROW


79  
	`__butš_memchr
 (
__s
, 
__c
, 
__n
);

82 
__ex‹º_®ways_šlše
 const *

83 
	`memchr
 (cÚ¡ *
__s
, 
__c
, 
size_t
 
__n
è
__THROW


85  
	`__butš_memchr
 (
__s
, 
__c
, 
__n
);

88 
	}
}

90 *
	$memchr
 (cÚ¡ *
__s
, 
__c
, 
size_t
 
__n
)

91 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

94 #ifdeà
__USE_GNU


97 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


98 "C++" *
	$¿wmemchr
 (*
__s
, 
__c
)

99 
__THROW
 
	`__asm
 ("¿wmemchr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

100 "C++" cÚ¡ *
	$¿wmemchr
 (cÚ¡ *
__s
, 
__c
)

101 
__THROW
 
	`__asm
 ("¿wmemchr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

103 *
	$¿wmemchr
 (cÚ¡ *
__s
, 
__c
)

104 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

108 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


109 "C++" *
	$memrchr
 (*
__s
, 
__c
, 
size_t
 
__n
)

110 
__THROW
 
	`__asm
 ("memrchr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

111 "C++" cÚ¡ *
	$memrchr
 (cÚ¡ *
__s
, 
__c
, 
size_t
 
__n
)

112 
__THROW
 
	`__asm
 ("memrchr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

114 *
	$memrchr
 (cÚ¡ *
__s
, 
__c
, 
size_t
 
__n
)

115 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

121 *
	$¡rıy
 (*
__»¡riù
 
__de¡
, cÚ¡ *__»¡riù 
__¤c
)

122 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

124 *
	$¡ºıy
 (*
__»¡riù
 
__de¡
,

125 cÚ¡ *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

126 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

129 *
	$¡rÿt
 (*
__»¡riù
 
__de¡
, cÚ¡ *__»¡riù 
__¤c
)

130 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

132 *
	$¡ºÿt
 (*
__»¡riù
 
__de¡
, cÚ¡ *__»¡riù 
__¤c
,

133 
size_t
 
__n
è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

136 
	$¡rcmp
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
)

137 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

139 
	$¡ºcmp
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
, 
size_t
 
__n
)

140 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

143 
	$¡rcŞl
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
)

144 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

146 
size_t
 
	$¡rxäm
 (*
__»¡riù
 
__de¡
,

147 cÚ¡ *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

148 
__THROW
 
	`__nÚnuÎ
 ((2));

150 #ifdeà
__USE_XOPEN2K8


152 
	~<b™s/ty³s/loÿË_t.h
>

155 
	$¡rcŞl_l
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
, 
loÿË_t
 
__l
)

156 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2, 3));

159 
size_t
 
	$¡rxäm_l
 (*
__de¡
, cÚ¡ *
__¤c
, 
size_t
 
__n
,

160 
loÿË_t
 
__l
è
__THROW
 
	`__nÚnuÎ
 ((2, 4));

163 #ià(
defšed
 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K8
 \

164 || 
	$__GLIBC_USE
 (
LIB_EXT2
))

166 *
	$¡rdup
 (cÚ¡ *
__s
)

167 
__THROW
 
__©Œibu‹_m®loc__
 
	`__nÚnuÎ
 ((1));

173 #ià
defšed
 
__USE_XOPEN2K8
 || 
	`__GLIBC_USE
 (
LIB_EXT2
)

174 *
	$¡ºdup
 (cÚ¡ *
__¡ršg
, 
size_t
 
__n
)

175 
__THROW
 
__©Œibu‹_m®loc__
 
	`__nÚnuÎ
 ((1));

178 #ià
defšed
 
__USE_GNU
 && defšed 
__GNUC__


180 
	#¡rdu·
(
s
) \

181 (
__ex‹nsiÚ__
 \

183 cÚ¡ *
__Şd
 = (
s
); \

184 
size_t
 
__Ën
 = 
	`¡¾’
 (
__Şd
) + 1; \

185 *
__Ãw
 = (*è
	`__butš_®loÿ
 (
__Ën
); \

186 (*è
	`memıy
 (
__Ãw
, 
__Şd
, 
__Ën
); \

187 
	}
}))

	)

190 
	#¡ºdu·
(
s
, 
n
) \

191 (
__ex‹nsiÚ__
 \

193 cÚ¡ *
__Şd
 = (
s
); \

194 
size_t
 
__Ën
 = 
	`¡ºËn
 (
__Şd
, (
n
)); \

195 *
__Ãw
 = (*è
	`__butš_®loÿ
 (
__Ën
 + 1); \

196 
__Ãw
[
__Ën
] = '\0'; \

197 (*è
	`memıy
 (
__Ãw
, 
__Şd
, 
__Ën
); \

198 }))

	)

202 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


205 *
¡rchr
 (*
__s
, 
__c
)

206 
__THROW
 
__asm
 ("¡rchr"è
__©Œibu‹_pu»__
 
__nÚnuÎ
 ((1));

207 cÚ¡ *
¡rchr
 (cÚ¡ *
__s
, 
__c
)

208 
__THROW
 
__asm
 ("¡rchr"è
__©Œibu‹_pu»__
 
__nÚnuÎ
 ((1));

210 #ifdeà
__OPTIMIZE__


211 
__ex‹º_®ways_šlše
 *

212 
¡rchr
 (*
__s
, 
__c
è
	g__THROW


214  
__butš_¡rchr
 (
__s
, 
__c
);

217 
__ex‹º_®ways_šlše
 const *

218 
¡rchr
 (cÚ¡ *
__s
, 
__c
è
	g__THROW


220  
__butš_¡rchr
 (
__s
, 
__c
);

225 *
	$¡rchr
 (cÚ¡ *
__s
, 
__c
)

226 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

229 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


232 *
	`¡¼chr
 (*
__s
, 
__c
)

233 
__THROW
 
	`__asm
 ("¡¼chr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

234 cÚ¡ *
	`¡¼chr
 (cÚ¡ *
__s
, 
__c
)

235 
__THROW
 
	`__asm
 ("¡¼chr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

237 #ifdeà
__OPTIMIZE__


238 
__ex‹º_®ways_šlše
 *

239 
	`¡¼chr
 (*
__s
, 
__c
è
__THROW


241  
	`__butš_¡¼chr
 (
__s
, 
__c
);

244 
__ex‹º_®ways_šlše
 const *

245 
	`¡¼chr
 (cÚ¡ *
__s
, 
__c
è
__THROW


247  
	`__butš_¡¼chr
 (
__s
, 
__c
);

250 
	}
}

252 *
	$¡¼chr
 (cÚ¡ *
__s
, 
__c
)

253 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

256 #ifdeà
__USE_GNU


259 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


260 "C++" *
	$¡rchºul
 (*
__s
, 
__c
)

261 
__THROW
 
	`__asm
 ("¡rchºul"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

262 "C++" cÚ¡ *
	$¡rchºul
 (cÚ¡ *
__s
, 
__c
)

263 
__THROW
 
	`__asm
 ("¡rchºul"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

265 *
	$¡rchºul
 (cÚ¡ *
__s
, 
__c
)

266 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

272 
size_t
 
	$¡rc¥n
 (cÚ¡ *
__s
, cÚ¡ *
__»jeù
)

273 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

276 
size_t
 
	$¡r¥n
 (cÚ¡ *
__s
, cÚ¡ *
__acû±
)

277 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

279 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


282 *
	`¡½brk
 (*
__s
, cÚ¡ *
__acû±
)

283 
__THROW
 
	`__asm
 ("¡½brk"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

284 cÚ¡ *
	`¡½brk
 (cÚ¡ *
__s
, cÚ¡ *
__acû±
)

285 
__THROW
 
	`__asm
 ("¡½brk"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

287 #ifdeà
__OPTIMIZE__


288 
__ex‹º_®ways_šlše
 *

289 
	`¡½brk
 (*
__s
, cÚ¡ *
__acû±
è
__THROW


291  
	`__butš_¡½brk
 (
__s
, 
__acû±
);

294 
__ex‹º_®ways_šlše
 const *

295 
	`¡½brk
 (cÚ¡ *
__s
, cÚ¡ *
__acû±
è
__THROW


297  
	`__butš_¡½brk
 (
__s
, 
__acû±
);

300 
	}
}

302 *
	$¡½brk
 (cÚ¡ *
__s
, cÚ¡ *
__acû±
)

303 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

306 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


309 *
	`¡r¡r
 (*
__hay¡ack
, cÚ¡ *
__ÃedË
)

310 
__THROW
 
	`__asm
 ("¡r¡r"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

311 cÚ¡ *
	`¡r¡r
 (cÚ¡ *
__hay¡ack
, cÚ¡ *
__ÃedË
)

312 
__THROW
 
	`__asm
 ("¡r¡r"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

314 #ifdeà
__OPTIMIZE__


315 
__ex‹º_®ways_šlše
 *

316 
	`¡r¡r
 (*
__hay¡ack
, cÚ¡ *
__ÃedË
è
__THROW


318  
	`__butš_¡r¡r
 (
__hay¡ack
, 
__ÃedË
);

321 
__ex‹º_®ways_šlše
 const *

322 
	`¡r¡r
 (cÚ¡ *
__hay¡ack
, cÚ¡ *
__ÃedË
è
__THROW


324  
	`__butš_¡r¡r
 (
__hay¡ack
, 
__ÃedË
);

327 
	}
}

329 *
	$¡r¡r
 (cÚ¡ *
__hay¡ack
, cÚ¡ *
__ÃedË
)

330 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

335 *
	$¡¹ok
 (*
__»¡riù
 
__s
, cÚ¡ *__»¡riù 
__d–im
)

336 
__THROW
 
	`__nÚnuÎ
 ((2));

340 *
	$__¡¹ok_r
 (*
__»¡riù
 
__s
,

341 cÚ¡ *
__»¡riù
 
__d–im
,

342 **
__»¡riù
 
__§ve_±r
)

343 
__THROW
 
	`__nÚnuÎ
 ((2, 3));

344 #ifdeà
__USE_POSIX


345 *
	$¡¹ok_r
 (*
__»¡riù
 
__s
, cÚ¡ *__»¡riù 
__d–im
,

346 **
__»¡riù
 
__§ve_±r
)

347 
__THROW
 
	`__nÚnuÎ
 ((2, 3));

350 #ifdeà
__USE_GNU


352 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


353 "C++" *
	$¡rÿ£¡r
 (*
__hay¡ack
, cÚ¡ *
__ÃedË
)

354 
__THROW
 
	`__asm
 ("¡rÿ£¡r"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

355 "C++" cÚ¡ *
	$¡rÿ£¡r
 (cÚ¡ *
__hay¡ack
,

356 cÚ¡ *
__ÃedË
)

357 
__THROW
 
	`__asm
 ("¡rÿ£¡r"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

359 *
	$¡rÿ£¡r
 (cÚ¡ *
__hay¡ack
, cÚ¡ *
__ÃedË
)

360 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

364 #ifdeà
__USE_GNU


368 *
	$memmem
 (cÚ¡ *
__hay¡ack
, 
size_t
 
__hay¡ackËn
,

369 cÚ¡ *
__ÃedË
, 
size_t
 
__ÃedËËn
)

370 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 3));

374 *
	$__mempıy
 (*
__»¡riù
 
__de¡
,

375 cÚ¡ *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

376 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

377 *
	$mempıy
 (*
__»¡riù
 
__de¡
,

378 cÚ¡ *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

379 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

384 
size_t
 
	$¡¾’
 (cÚ¡ *
__s
)

385 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

387 #ifdef 
__USE_XOPEN2K8


390 
size_t
 
	$¡ºËn
 (cÚ¡ *
__¡ršg
, 
size_t
 
__maxËn
)

391 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

396 *
	$¡»¼Ü
 (
__”ºum
è
__THROW
;

397 #ifdeà
__USE_XOPEN2K


405 #ià
defšed
 
__USE_XOPEN2K
 && !defšed 
__USE_GNU


408 #ifdeà
__REDIRECT_NTH


409 
	`__REDIRECT_NTH
 (
¡»¼Ü_r
,

410 (
__”ºum
, *
__buf
, 
size_t
 
__buæ’
),

411 
__xpg_¡»¼Ü_r
è
	`__nÚnuÎ
 ((2));

413 
	$__xpg_¡»¼Ü_r
 (
__”ºum
, *
__buf
, 
size_t
 
__buæ’
)

414 
__THROW
 
	`__nÚnuÎ
 ((2));

415 
	#¡»¼Ü_r
 
__xpg_¡»¼Ü_r


	)

420 *
	$¡»¼Ü_r
 (
__”ºum
, *
__buf
, 
size_t
 
__buæ’
)

421 
__THROW
 
	`__nÚnuÎ
 ((2)è
__wur
;

425 #ifdeà
__USE_XOPEN2K8


427 *
	$¡»¼Ü_l
 (
__”ºum
, 
loÿË_t
 
__l
è
__THROW
;

430 #ifdeà
__USE_MISC


431 
	~<¡ršgs.h
>

435 
	$ex¶ic™_bz”o
 (*
__s
, 
size_t
 
__n
è
__THROW
 
	`__nÚnuÎ
 ((1));

439 *
	$¡r£p
 (**
__»¡riù
 
__¡ršgp
,

440 cÚ¡ *
__»¡riù
 
__d–im
)

441 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

444 #ifdef 
__USE_XOPEN2K8


446 *
	$¡rsigÇl
 (
__sig
è
__THROW
;

449 *
	$__¡pıy
 (*
__»¡riù
 
__de¡
, cÚ¡ *__»¡riù 
__¤c
)

450 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

451 *
	$¡pıy
 (*
__»¡riù
 
__de¡
, cÚ¡ *__»¡riù 
__¤c
)

452 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

456 *
	$__¡²ıy
 (*
__»¡riù
 
__de¡
,

457 cÚ¡ *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

458 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

459 *
	$¡²ıy
 (*
__»¡riù
 
__de¡
,

460 cÚ¡ *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

461 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

464 #ifdef 
__USE_GNU


466 
	$¡rv”scmp
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
)

467 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

470 *
	$¡räy
 (*
__¡ršg
è
__THROW
 
	`__nÚnuÎ
 ((1));

473 *
	$memäob
 (*
__s
, 
size_t
 
__n
è
__THROW
 
	`__nÚnuÎ
 ((1));

475 #iâdeà
ba£Çme


480 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


481 "C++" *
	$ba£Çme
 (*
__f’ame
)

482 
__THROW
 
	`__asm
 ("ba£Çme"è
	`__nÚnuÎ
 ((1));

483 "C++" cÚ¡ *
	$ba£Çme
 (cÚ¡ *
__f’ame
)

484 
__THROW
 
	`__asm
 ("ba£Çme"è
	`__nÚnuÎ
 ((1));

486 *
	$ba£Çme
 (cÚ¡ *
__f’ame
è
__THROW
 
	`__nÚnuÎ
 ((1));

491 #ià
	`__GNUC_PREREQ
 (3,4)

492 #ià
__USE_FORTIFY_LEVEL
 > 0 && 
defšed
 
__fÜtify_funùiÚ


494 
	~<b™s/¡ršg_fÜtif›d.h
>

498 
__END_DECLS


	@/usr/include/strings.h

18 #iâdef 
_STRINGS_H


19 
	#_STRINGS_H
 1

	)

21 
	~<ã©u»s.h
>

22 
	#__Ãed_size_t


	)

23 
	~<¡ddef.h
>

26 #ià
defšed
 
__ılu¥lus
 && 
__GNUC_PREREQ
 (4, 4)

27 
	#__CORRECT_ISO_CPP_STRINGS_H_PROTO


	)

30 
	g__BEGIN_DECLS


32 #ià
defšed
 
__USE_MISC
 || !defšed 
__USE_XOPEN2K8


34 
	$bcmp
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
, 
size_t
 
__n
)

35 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

38 
	$bcİy
 (cÚ¡ *
__¤c
, *
__de¡
, 
size_t
 
__n
)

39 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

42 
	$bz”o
 (*
__s
, 
size_t
 
__n
è
__THROW
 
	`__nÚnuÎ
 ((1));

45 #ifdeà
__CORRECT_ISO_CPP_STRINGS_H_PROTO


48 *
	`šdex
 (*
__s
, 
__c
)

49 
__THROW
 
	`__asm
 ("šdex"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

50 cÚ¡ *
	`šdex
 (cÚ¡ *
__s
, 
__c
)

51 
__THROW
 
	`__asm
 ("šdex"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

53 #ià
defšed
 
__OPTIMIZE__


54 
__ex‹º_®ways_šlše
 *

55 
	`šdex
 (*
__s
, 
__c
è
__THROW


57  
	`__butš_šdex
 (
__s
, 
__c
);

60 
__ex‹º_®ways_šlše
 const *

61 
	`šdex
 (cÚ¡ *
__s
, 
__c
è
__THROW


63  
	`__butš_šdex
 (
__s
, 
__c
);

66 
	}
}

68 *
	$šdex
 (cÚ¡ *
__s
, 
__c
)

69 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

73 #ifdeà
__CORRECT_ISO_CPP_STRINGS_H_PROTO


76 *
	`ršdex
 (*
__s
, 
__c
)

77 
__THROW
 
	`__asm
 ("ršdex"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

78 cÚ¡ *
	`ršdex
 (cÚ¡ *
__s
, 
__c
)

79 
__THROW
 
	`__asm
 ("ršdex"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

81 #ià
defšed
 
__OPTIMIZE__


82 
__ex‹º_®ways_šlše
 *

83 
	`ršdex
 (*
__s
, 
__c
è
__THROW


85  
	`__butš_ršdex
 (
__s
, 
__c
);

88 
__ex‹º_®ways_šlše
 const *

89 
	`ršdex
 (cÚ¡ *
__s
, 
__c
è
__THROW


91  
	`__butš_ršdex
 (
__s
, 
__c
);

94 
	}
}

96 *
	$ršdex
 (cÚ¡ *
__s
, 
__c
)

97 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

101 #ià
defšed
 
__USE_MISC
 || !defšed 
__USE_XOPEN2K8
 || defšed 
__USE_XOPEN2K8XSI


104 
	$ffs
 (
__i
è
__THROW
 
__©Œibu‹_cÚ¡__
;

109 #ifdef 
__USE_MISC


110 
	$ff¦
 (
__l
è
__THROW
 
__©Œibu‹_cÚ¡__
;

111 
__ex‹nsiÚ__
 
	$ff¦l
 (
__Î
)

112 
__THROW
 
__©Œibu‹_cÚ¡__
;

116 
	$¡rÿ£cmp
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
)

117 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

120 
	$¡ºÿ£cmp
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
, 
size_t
 
__n
)

121 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

123 #ifdef 
__USE_XOPEN2K8


125 
	~<b™s/ty³s/loÿË_t.h
>

128 
	$¡rÿ£cmp_l
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
, 
loÿË_t
 
__loc
)

129 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2, 3));

133 
	$¡ºÿ£cmp_l
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
,

134 
size_t
 
__n
, 
loÿË_t
 
__loc
)

135 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2, 4));

138 
__END_DECLS


140 #ià
	`__GNUC_PREREQ
 (3,4è&& 
__USE_FORTIFY_LEVEL
 > 0 \

141 && 
defšed
 
__fÜtify_funùiÚ


143 #ià
defšed
 
__USE_MISC
 || !defšed 
__USE_XOPEN2K8


144 
	~<b™s/¡ršgs_fÜtif›d.h
>

	@/usr/include/features.h

18 #iâdef 
_FEATURES_H


19 
	#_FEATURES_H
 1

	)

119 #undeà
__USE_ISOC11


120 #undeà
__USE_ISOC99


121 #undeà
__USE_ISOC95


122 #undeà
__USE_ISOCXX11


123 #undeà
__USE_POSIX


124 #undeà
__USE_POSIX2


125 #undeà
__USE_POSIX199309


126 #undeà
__USE_POSIX199506


127 #undeà
__USE_XOPEN


128 #undeà
__USE_XOPEN_EXTENDED


129 #undeà
__USE_UNIX98


130 #undeà
__USE_XOPEN2K


131 #undeà
__USE_XOPEN2KXSI


132 #undeà
__USE_XOPEN2K8


133 #undeà
__USE_XOPEN2K8XSI


134 #undeà
__USE_LARGEFILE


135 #undeà
__USE_LARGEFILE64


136 #undeà
__USE_FILE_OFFSET64


137 #undeà
__USE_MISC


138 #undeà
__USE_ATFILE


139 #undeà
__USE_GNU


140 #undeà
__USE_FORTIFY_LEVEL


141 #undeà
__KERNEL_STRICT_NAMES


142 #undeà
__GLIBC_USE_DEPRECATED_GETS


146 #iâdeà
_LOOSE_KERNEL_NAMES


147 
	#__KERNEL_STRICT_NAMES


	)

157 #ià
defšed
 
__GNUC__
 && defšed 
__GNUC_MINOR__


158 
	#__GNUC_PREREQ
(
maj
, 
mš
) \

159 ((
__GNUC__
 << 16è+ 
__GNUC_MINOR__
 >ğ((
maj
è<< 16è+ (
mš
))

	)

161 
	#__GNUC_PREREQ
(
maj
, 
mš
è0

	)

168 #ià
defšed
 
__şªg_majÜ__
 && defšed 
__şªg_mšÜ__


169 
	#__glibc_şªg_´”eq
(
maj
, 
mš
) \

170 ((
__şªg_majÜ__
 << 16è+ 
__şªg_mšÜ__
 >ğ((
maj
è<< 16è+ (
mš
))

	)

172 
	#__glibc_şªg_´”eq
(
maj
, 
mš
è0

	)

176 
	#__GLIBC_USE
(
F
è
__GLIBC_USE_
 ## 
	)
F

182 #ià(
defšed
 
_BSD_SOURCE
 || defšed 
_SVID_SOURCE
) \

183 && !
defšed
 
	g_DEFAULT_SOURCE


185 #undeà
_DEFAULT_SOURCE


186 
	#_DEFAULT_SOURCE
 1

	)

190 #ifdeà
_GNU_SOURCE


191 #undeà
_ISOC95_SOURCE


192 
	#_ISOC95_SOURCE
 1

	)

193 #undeà
_ISOC99_SOURCE


194 
	#_ISOC99_SOURCE
 1

	)

195 #undeà
_ISOC11_SOURCE


196 
	#_ISOC11_SOURCE
 1

	)

197 #undeà
_POSIX_SOURCE


198 
	#_POSIX_SOURCE
 1

	)

199 #undeà
_POSIX_C_SOURCE


200 
	#_POSIX_C_SOURCE
 200809L

	)

201 #undeà
_XOPEN_SOURCE


202 
	#_XOPEN_SOURCE
 700

	)

203 #undeà
_XOPEN_SOURCE_EXTENDED


204 
	#_XOPEN_SOURCE_EXTENDED
 1

	)

205 #undeà
_LARGEFILE64_SOURCE


206 
	#_LARGEFILE64_SOURCE
 1

	)

207 #undeà
_DEFAULT_SOURCE


208 
	#_DEFAULT_SOURCE
 1

	)

209 #undeà
_ATFILE_SOURCE


210 
	#_ATFILE_SOURCE
 1

	)

215 #ià(
defšed
 
_DEFAULT_SOURCE
 \

216 || (!
defšed
 
	g__STRICT_ANSI__
 \

217 && !
defšed
 
	g_ISOC99_SOURCE
 \

218 && !
defšed
 
	g_POSIX_SOURCE
 && !defšed 
	g_POSIX_C_SOURCE
 \

219 && !
defšed
 
	g_XOPEN_SOURCE
))

220 #undeà
_DEFAULT_SOURCE


221 
	#_DEFAULT_SOURCE
 1

	)

225 #ià(
defšed
 
_ISOC11_SOURCE
 \

226 || (
defšed
 
	g__STDC_VERSION__
 && __STDC_VERSION__ >= 201112L))

227 
	#__USE_ISOC11
 1

	)

231 #ià(
defšed
 
_ISOC99_SOURCE
 || defšed 
_ISOC11_SOURCE
 \

232 || (
defšed
 
__STDC_VERSION__
 && __STDC_VERSION__ >= 199901L))

233 
	#__USE_ISOC99
 1

	)

237 #ià(
defšed
 
_ISOC99_SOURCE
 || defšed 
_ISOC11_SOURCE
 \

238 || (
defšed
 
__STDC_VERSION__
 && __STDC_VERSION__ >= 199409L))

239 
	#__USE_ISOC95
 1

	)

242 #ifdeà
__ılu¥lus


244 #ià
__ılu¥lus
 >= 201703L

245 
	#__USE_ISOC11
 1

	)

249 #ià
__ılu¥lus
 >ğ201103L || 
defšed
 
__GXX_EXPERIMENTAL_CXX0X__


250 
	#__USE_ISOCXX11
 1

	)

251 
	#__USE_ISOC99
 1

	)

258 #ifdeà
_DEFAULT_SOURCE


259 #ià!
defšed
 
_POSIX_SOURCE
 && !defšed 
_POSIX_C_SOURCE


260 
	#__USE_POSIX_IMPLICITLY
 1

	)

262 #undeà
_POSIX_SOURCE


263 
	#_POSIX_SOURCE
 1

	)

264 #undeà
_POSIX_C_SOURCE


265 
	#_POSIX_C_SOURCE
 200809L

	)

268 #ià((!
defšed
 
__STRICT_ANSI__
 \

269 || (
defšed
 
_XOPEN_SOURCE
 && (_XOPEN_SOURCE - 0) >= 500)) \

270 && !
defšed
 
_POSIX_SOURCE
 && !defšed 
_POSIX_C_SOURCE
)

271 
	#_POSIX_SOURCE
 1

	)

272 #ià
defšed
 
_XOPEN_SOURCE
 && (_XOPEN_SOURCE - 0) < 500

273 
	#_POSIX_C_SOURCE
 2

	)

274 #–ià
defšed
 
_XOPEN_SOURCE
 && (_XOPEN_SOURCE - 0) < 600

275 
	#_POSIX_C_SOURCE
 199506L

	)

276 #–ià
defšed
 
_XOPEN_SOURCE
 && (_XOPEN_SOURCE - 0) < 700

277 
	#_POSIX_C_SOURCE
 200112L

	)

279 
	#_POSIX_C_SOURCE
 200809L

	)

281 
	#__USE_POSIX_IMPLICITLY
 1

	)

290 #ià((!
defšed
 
_POSIX_C_SOURCE
 || (_POSIX_C_SOURCE - 0) < 199506L) \

291 && (
defšed
 
_REENTRANT
 || defšed 
_THREAD_SAFE
))

292 
	#_POSIX_SOURCE
 1

	)

293 #undeà
_POSIX_C_SOURCE


294 
	#_POSIX_C_SOURCE
 199506L

	)

297 #ià(
defšed
 
_POSIX_SOURCE
 \

298 || (
defšed
 
_POSIX_C_SOURCE
 && _POSIX_C_SOURCE >= 1) \

299 || 
defšed
 
_XOPEN_SOURCE
)

300 
	#__USE_POSIX
 1

	)

303 #ià
defšed
 
_POSIX_C_SOURCE
 && _POSIX_C_SOURCE >ğ2 || defšed 
_XOPEN_SOURCE


304 
	#__USE_POSIX2
 1

	)

307 #ià
defšed
 
_POSIX_C_SOURCE
 && (_POSIX_C_SOURCE - 0) >= 199309L

308 
	#__USE_POSIX199309
 1

	)

311 #ià
defšed
 
_POSIX_C_SOURCE
 && (_POSIX_C_SOURCE - 0) >= 199506L

312 
	#__USE_POSIX199506
 1

	)

315 #ià
defšed
 
_POSIX_C_SOURCE
 && (_POSIX_C_SOURCE - 0) >= 200112L

316 
	#__USE_XOPEN2K
 1

	)

317 #undeà
__USE_ISOC95


318 
	#__USE_ISOC95
 1

	)

319 #undeà
__USE_ISOC99


320 
	#__USE_ISOC99
 1

	)

323 #ià
defšed
 
_POSIX_C_SOURCE
 && (_POSIX_C_SOURCE - 0) >= 200809L

324 
	#__USE_XOPEN2K8
 1

	)

325 #undeà
_ATFILE_SOURCE


326 
	#_ATFILE_SOURCE
 1

	)

329 #ifdef 
_XOPEN_SOURCE


330 
	#__USE_XOPEN
 1

	)

331 #ià(
_XOPEN_SOURCE
 - 0) >= 500

332 
	#__USE_XOPEN_EXTENDED
 1

	)

333 
	#__USE_UNIX98
 1

	)

334 #undeà
_LARGEFILE_SOURCE


335 
	#_LARGEFILE_SOURCE
 1

	)

336 #ià(
_XOPEN_SOURCE
 - 0) >= 600

337 #ià(
_XOPEN_SOURCE
 - 0) >= 700

338 
	#__USE_XOPEN2K8
 1

	)

339 
	#__USE_XOPEN2K8XSI
 1

	)

341 
	#__USE_XOPEN2K
 1

	)

342 
	#__USE_XOPEN2KXSI
 1

	)

343 #undeà
__USE_ISOC95


344 
	#__USE_ISOC95
 1

	)

345 #undeà
__USE_ISOC99


346 
	#__USE_ISOC99
 1

	)

349 #ifdeà
_XOPEN_SOURCE_EXTENDED


350 
	#__USE_XOPEN_EXTENDED
 1

	)

355 #ifdeà
_LARGEFILE_SOURCE


356 
	#__USE_LARGEFILE
 1

	)

359 #ifdeà
_LARGEFILE64_SOURCE


360 
	#__USE_LARGEFILE64
 1

	)

363 #ià
defšed
 
_FILE_OFFSET_BITS
 && _FILE_OFFSET_BITS == 64

364 
	#__USE_FILE_OFFSET64
 1

	)

367 #ià
defšed
 
_DEFAULT_SOURCE


368 
	#__USE_MISC
 1

	)

371 #ifdef 
_ATFILE_SOURCE


372 
	#__USE_ATFILE
 1

	)

375 #ifdef 
_GNU_SOURCE


376 
	#__USE_GNU
 1

	)

379 #ià
defšed
 
_FORTIFY_SOURCE
 && _FORTIFY_SOURCE > 0 \

380 && 
__GNUC_PREREQ
 (4, 1è&& 
defšed
 
	g__OPTIMIZE__
 && __OPTIMIZE__ > 0

381 #ià
_FORTIFY_SOURCE
 > 1

382 
	#__USE_FORTIFY_LEVEL
 2

	)

384 
	#__USE_FORTIFY_LEVEL
 1

	)

387 
	#__USE_FORTIFY_LEVEL
 0

	)

394 #ià
defšed
 
__ılu¥lus
 ? __ılu¥lu >ğ201402L : defšed 
__USE_ISOC11


395 
	#__GLIBC_USE_DEPRECATED_GETS
 0

	)

397 
	#__GLIBC_USE_DEPRECATED_GETS
 1

	)

402 
	~<¡dc-´edef.h
>

410 #undeà
__GNU_LIBRARY__


411 
	#__GNU_LIBRARY__
 6

	)

415 
	#__GLIBC__
 2

	)

416 
	#__GLIBC_MINOR__
 27

	)

418 
	#__GLIBC_PREREQ
(
maj
, 
mš
) \

419 ((
__GLIBC__
 << 16è+ 
__GLIBC_MINOR__
 >ğ((
maj
è<< 16è+ (
mš
))

	)

422 #iâdeà
__ASSEMBLER__


423 #iâdeà
_SYS_CDEFS_H


424 
	~<sys/cdefs.h
>

429 #ià
defšed
 
__USE_FILE_OFFSET64
 && !defšed 
__REDIRECT


430 
	#__USE_LARGEFILE
 1

	)

431 
	#__USE_LARGEFILE64
 1

	)

437 #ià
__GNUC_PREREQ
 (2, 7è&& 
defšed
 
__OPTIMIZE__
 \

438 && !
defšed
 
	g__OPTIMIZE_SIZE__
 && !defšed 
	g__NO_INLINE__
 \

439 && 
defšed
 
	g__ex‹º_šlše


440 
	#__USE_EXTERN_INLINES
 1

	)

448 
	~<gnu/¡ubs.h
>

	@/usr/include/stdc-predef.h

18 #iâdef 
_STDC_PREDEF_H


19 
	#_STDC_PREDEF_H
 1

	)

36 #ifdeà
__GCC_IEC_559


37 #ià
__GCC_IEC_559
 > 0

38 
	#__STDC_IEC_559__
 1

	)

41 
	#__STDC_IEC_559__
 1

	)

44 #ifdeà
__GCC_IEC_559_COMPLEX


45 #ià
__GCC_IEC_559_COMPLEX
 > 0

46 
	#__STDC_IEC_559_COMPLEX__
 1

	)

49 
	#__STDC_IEC_559_COMPLEX__
 1

	)

58 
	#__STDC_ISO_10646__
 201706L

	)

61 
	#__STDC_NO_THREADS__
 1

	)

	@
1
.
1
/usr/include
43
936
core/acknowledged_counter_generator.cc
core/acknowledged_counter_generator.h
core/basic_db.cc
core/basic_db.h
core/client.h
core/const_generator.h
core/core_workload.cc
core/core_workload.h
core/countdown_latch.h
core/counter_generator.h
core/db.h
core/db_factory.cc
core/db_factory.h
core/db_wrapper.h
core/discrete_generator.h
core/generator.h
core/measurements.cc
core/measurements.h
core/properties.h
core/random_byte_generator.h
core/scrambled_zipfian_generator.h
core/skewed_latest_generator.h
core/timer.h
core/uniform_generator.h
core/utils.h
core/ycsbc.cc
core/zipfian_comp_generator.h
core/zipfian_generator.h
lcfdb/rocksdb_db.cc
lcfdb/rocksdb_db.h
leveldb/leveldb_db.cc
leveldb/leveldb_db.h
lmdb/lmdb_db.cc
lmdb/lmdb_db.h
remixdb/remixdb_db.cc
remixdb/remixdb_db.h
rocksdb/rocksdb_db.cc
rocksdb/rocksdb_db.h
/usr/include/stdio.h
/usr/include/string.h
/usr/include/strings.h
/usr/include/features.h
/usr/include/stdc-predef.h
